/*! permutive-javascript-sdk v13.0.0-RC.19 (web) (built 2020-10-16 15:39:17 GMT+0000) */!function(e){function t(t){for(var n,i,s=t[0],o=t[1],a=0,c=[];a<s.length;a++)i=s[a],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&c.push(r[i][0]),r[i]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(u&&u(t);c.length;)c.shift()()}var n={},r={0:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(){return Promise.resolve()},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var s=window.permutiveWebpack=window.permutiveWebpack||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var a=0;a<s.length;a++)t(s[a]);var u=o;i(i.s=33)}([function(e,t,n){"use strict";n.d(t,"l",(function(){return r})),n.d(t,"k",(function(){return i})),n.d(t,"n",(function(){return s})),n.d(t,"o",(function(){return o})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"j",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"h",(function(){return _})),n.d(t,"m",(function(){return m})),n.d(t,"a",(function(){return g})),n.d(t,"f",(function(){return b})),n.d(t,"i",(function(){return v}));n(4);var r=function(e){return"Some"===e._tag},i=function(e){return"None"===e._tag},s={_tag:"None"},o=function(e){return{_tag:"Some",value:e}};function a(e){return null==e?s:o(e)}function u(e){return function(t){return e(t)?o(t):s}}function c(e){return"Right"===e._tag?s:o(e.left)}function l(e){return"Left"===e._tag?s:o(e.right)}var d=function(e){return"Left"===e._tag?s:o(e.right)};function f(e,t){return function(n){return i(n)?e():t(n.value)}}var _=function(e){return function(t){return i(t)?e():t.value}};var h=function(e,t){return i(e)?s:o(t(e.value))},p=function(e,t){return i(e)?s:t(e.value)},m=function(e){return function(t){return h(t,e)}},g=function(e){return function(t){return p(t,e)}};function b(e){return{equals:function(t,n){return t===n||(i(t)?i(n):!i(n)&&e.equals(t.value,n.value))}}}function v(e){return{equals:b(e).equals,compare:function(t,n){return t===n?0:r(t)?r(n)?e.compare(t.value,n.value):1:-1}}}},function(e,t,n){"use strict";n.d(t,"bb",(function(){return o})),n.d(t,"Vb",(function(){return a})),n.d(t,"fb",(function(){return u})),n.d(t,"db",(function(){return l})),n.d(t,"cb",(function(){return d})),n.d(t,"eb",(function(){return f})),n.d(t,"qb",(function(){return _})),n.d(t,"zb",(function(){return h})),n.d(t,"Eb",(function(){return p})),n.d(t,"W",(function(){return m})),n.d(t,"X",(function(){return g})),n.d(t,"ab",(function(){return b})),n.d(t,"Ib",(function(){return v})),n.d(t,"Jb",(function(){return y})),n.d(t,"kb",(function(){return O})),n.d(t,"lb",(function(){return w})),n.d(t,"mb",(function(){return k})),n.d(t,"pb",(function(){return j})),n.d(t,"C",(function(){return E})),n.d(t,"Mb",(function(){return M})),n.d(t,"gb",(function(){return S})),n.d(t,"nb",(function(){return P})),n.d(t,"Rb",(function(){return I})),n.d(t,"hb",(function(){return T})),n.d(t,"Sb",(function(){return C})),n.d(t,"Ub",(function(){return D})),n.d(t,"Tb",(function(){return A})),n.d(t,"Pb",(function(){return q})),n.d(t,"F",(function(){return R})),n.d(t,"H",(function(){return L})),n.d(t,"G",(function(){return N})),n.d(t,"S",(function(){return U})),n.d(t,"Q",(function(){return B})),n.d(t,"R",(function(){return K})),n.d(t,"T",(function(){return W})),n.d(t,"V",(function(){return z})),n.d(t,"U",(function(){return $})),n.d(t,"ib",(function(){return F})),n.d(t,"fc",(function(){return G})),n.d(t,"D",(function(){return J})),n.d(t,"tb",(function(){return H})),n.d(t,"Fb",(function(){return Q})),n.d(t,"Gb",(function(){return V})),n.d(t,"ob",(function(){return Y})),n.d(t,"Nb",(function(){return X})),n.d(t,"jc",(function(){return Z})),n.d(t,"ic",(function(){return ee})),n.d(t,"ec",(function(){return te})),n.d(t,"Hb",(function(){return ne})),n.d(t,"J",(function(){return re})),n.d(t,"ac",(function(){return ie})),n.d(t,"Ob",(function(){return se})),n.d(t,"y",(function(){return oe})),n.d(t,"Qb",(function(){return ae})),n.d(t,"z",(function(){return ue})),n.d(t,"B",(function(){return ce})),n.d(t,"Zb",(function(){return le})),n.d(t,"jb",(function(){return de})),n.d(t,"E",(function(){return fe})),n.d(t,"ub",(function(){return _e})),n.d(t,"o",(function(){return Be})),n.d(t,"p",(function(){return Ke})),n.d(t,"q",(function(){return We})),n.d(t,"s",(function(){return ze})),n.d(t,"v",(function(){return $e})),n.d(t,"x",(function(){return Fe})),n.d(t,"w",(function(){return Ge})),n.d(t,"I",(function(){return Je})),n.d(t,"rb",(function(){return He})),n.d(t,"sb",(function(){return Qe})),n.d(t,"A",(function(){return Ve})),n.d(t,"Kb",(function(){return Ye})),n.d(t,"M",(function(){return Xe})),n.d(t,"N",(function(){return Ze})),n.d(t,"vb",(function(){return et})),n.d(t,"yb",(function(){return tt})),n.d(t,"wb",(function(){return nt})),n.d(t,"xb",(function(){return rt})),n.d(t,"O",(function(){return it})),n.d(t,"P",(function(){return st})),n.d(t,"L",(function(){return ot})),n.d(t,"Y",(function(){return at})),n.d(t,"Z",(function(){return ut})),n.d(t,"Ab",(function(){return ct})),n.d(t,"Db",(function(){return lt})),n.d(t,"Bb",(function(){return dt})),n.d(t,"Cb",(function(){return ft})),n.d(t,"Wb",(function(){return _t})),n.d(t,"Lb",(function(){return ht})),n.d(t,"Xb",(function(){return pt})),n.d(t,"hc",(function(){return mt})),n.d(t,"gc",(function(){return gt})),n.d(t,"Yb",(function(){return bt})),n.d(t,"i",(function(){return yt})),n.d(t,"j",(function(){return Ot})),n.d(t,"c",(function(){return wt})),n.d(t,"k",(function(){return kt})),n.d(t,"a",(function(){return jt})),n.d(t,"b",(function(){return Et})),n.d(t,"d",(function(){return Mt})),n.d(t,"e",(function(){return St})),n.d(t,"f",(function(){return Pt})),n.d(t,"g",(function(){return It})),n.d(t,"h",(function(){return Tt})),n.d(t,"l",(function(){return Ct})),n.d(t,"m",(function(){return Dt})),n.d(t,"n",(function(){return At})),n.d(t,"cc",(function(){return xt})),n.d(t,"dc",(function(){return qt})),n.d(t,"bc",(function(){return Rt})),n.d(t,"K",(function(){return Lt})),n.d(t,"u",(function(){return Nt})),n.d(t,"t",(function(){return Ut})),n.d(t,"r",(function(){return Bt}));var r=n(4),i=n(0),s=n(8);function o(e){var t=e.length;if(0===t)return Lt;for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}function a(e){for(var t=e.length,n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}function u(e){return{show:function(t){return"["+t.map(e.show).join(", ")+"]"}}}var c=function(e,t){var n=e.length;if(0===n)return t;var r=t.length;if(0===r)return e;for(var i=Array(n+r),s=0;s<n;s++)i[s]=e[s];for(s=0;s<r;s++)i[s+n]=t[s];return i};function l(){return{concat:c,empty:Lt}}function d(e){return{equals:function(t,n){return t===n||t.length===n.length&&t.every((function(t,r){return e.equals(t,n[r])}))}}}function f(e){return Object(s.b)((function(t,n){for(var r=t.length,i=n.length,o=Math.min(r,i),a=0;a<o;a++){var u=e.compare(t[a],n[a]);if(0!==u)return u}return s.i.compare(r,i)}))}function _(e,t){for(var n=[],r=0;r<e;r++)n.push(t(r));return n}function h(e,t){return _(t-e+1,(function(t){return e+t}))}function p(e,t){return _(e,(function(){return t}))}function m(e){for(var t=0,n=e.length,r=0;r<n;r++)t+=e[r].length;var i=Array(t),s=0;for(r=0;r<n;r++){for(var o=e[r],a=o.length,u=0;u<a;u++)i[u+s]=o[u];s+=a}return i}function g(e,t){return function(n){return O(n)?e():t(n[0],n.slice(1))}}function b(e,t){return function(n){return O(n)?e():t(n.slice(0,n.length-1),n[n.length-1])}}function v(e,t){return function(n){var r=n.length,i=new Array(r+1);i[0]=e;for(var s=0;s<r;s++)i[s+1]=t(i[s],n[s]);return i}}function y(e,t){return function(n){var r=n.length,i=new Array(r+1);i[r]=e;for(var s=r-1;s>=0;s--)i[s]=t(n[s],i[s+1]);return i}}function O(e){return 0===e.length}function w(e){return e.length>0}function k(e,t){return e<0||e>=t.length}function j(e,t){return void 0===t?function(t){return j(e,t)}:k(e,t)?i.n:Object(i.o)(t[e])}function E(e,t){if(void 0===t)return function(t){return E(e,t)};for(var n=t.length,r=Array(n+1),i=0;i<n;i++)r[i+1]=t[i];return r[0]=e,r}function M(e,t){for(var n=e.length,r=Array(n+1),i=0;i<n;i++)r[i]=e[i];return r[n]=t,r}function S(e){return O(e)?i.n:Object(i.o)(e[0])}function P(e){return j(e.length-1,e)}function I(e){return O(e)?i.n:Object(i.o)(e.slice(1))}function T(e){var t=e.length;return 0===t?i.n:Object(i.o)(e.slice(0,t-1))}function C(e){return function(t){return t.slice(0,e)}}function D(e){return function(t){return 0===e?Lt:t.slice(-e)}}function A(e){return function(t){for(var n=x(t,e),r=Array(n),i=0;i<n;i++)r[i]=t[i];return r}}var x=function(e,t){for(var n=e.length,r=0;r<n&&t(e[r]);r++);return r};function q(e){return function(t){for(var n=x(t,e),r=Array(n),i=0;i<n;i++)r[i]=t[i];var s=t.length,o=Array(s-n);for(i=n;i<s;i++)o[i-n]=t[i];return{init:r,rest:o}}}function R(e){return function(t){return t.slice(e,t.length)}}function L(e){return function(t){return t.slice(0,t.length-e)}}function N(e){return function(t){for(var n=x(t,e),r=t.length,i=Array(r-n),s=n;s<r;s++)i[s-n]=t[s];return i}}function U(e){return function(t){for(var n=t.length,r=0;r<n;r++)if(e(t[r]))return Object(i.o)(r);return i.n}}function B(e){return function(t){for(var n=t.length,r=0;r<n;r++)if(e(t[r]))return Object(i.o)(t[r]);return i.n}}function K(e){return function(t){for(var n=t.length,r=0;r<n;r++){var s=e(t[r]);if(Object(i.l)(s))return s}return i.n}}function W(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return Object(i.o)(t[n]);return i.n}}function z(e){return function(t){for(var n=t.length-1;n>=0;n--){var r=e(t[n]);if(Object(i.l)(r))return r}return i.n}}function $(e){return function(t){for(var n=t.length-1;n>=0;n--)if(e(t[n]))return Object(i.o)(n);return i.n}}function F(e,t){return function(n){return e<0||e>n.length?i.n:Object(i.o)(xt(e,t,n))}}function G(e,t){return function(n){return k(e,n)?i.n:Object(i.o)(qt(e,t,n))}}function J(e){return function(t){return k(e,t)?i.n:Object(i.o)(Rt(e,t))}}function H(e,t){return function(n){return k(e,n)?i.n:Object(i.o)(qt(e,t(n[e]),n))}}function Q(e){return O(e)?e:e.slice().reverse()}function V(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r];"Right"===i._tag&&t.push(i.right)}return t}function Y(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e[r];"Left"===i._tag&&t.push(i.left)}return t}var X=function(e){return function(t){return O(t)?t:t.slice().sort(e.compare)}};function Z(e,t,n){for(var r=[],i=Math.min(e.length,t.length),s=0;s<i;s++)r[s]=n(e[s],t[s]);return r}function ee(e,t){return void 0===t?function(t){return ee(t,e)}:Z(e,t,(function(e,t){return[e,t]}))}function te(e){for(var t=[],n=[],r=0;r<e.length;r++)t[r]=e[r][0],n[r]=e[r][1];return[t,n]}function ne(e){return function(t){var n=t.length;return 0===e||n<=1||n===Math.abs(e)?t:e<0?ne(n+e)(t):t.slice(-e).concat(t.slice(0,n-e))}}function re(e){return function(t,n){if(void 0===n){var r=re(e);return function(e){return r(t,e)}}for(var i,s=0,o=n.length;s<o;s++)if(i=n[s],e.equals(i,t))return!0;return!1}}function ie(e){var t=re(e);return function(e){for(var n=[],r=e.length,i=0;i<r;i++){var s=e[i];t(s,n)||n.push(s)}return r===n.length?e:n}}function se(e){var t=Object(s.d)();return X(e.reduce(t.concat,t.empty))}var oe=function(e){return function(t){for(var n=[],r=t;w(r);){var i=e(r),s=i[0],o=i[1];n.push(s),r=o}return n}};function ae(e){return function(t){return[t.slice(0,e),t.slice(e)]}}function ue(e){var t=oe(ae(e));return function(n){return 0===n.length?Lt:k(e-1,n)?[n]:t(n)}}function ce(e,t,n){void 0===n&&(n=function(){return!0});var r=function(e,i){return 0===i.length?n.apply(void 0,e)?[t.apply(void 0,e)]:Lt:ve(i[0],(function(t){return r(M(e,t),i.slice(1))}))};return r(Lt,e)}function le(e){var t=re(e);return function(n,r){if(void 0===r){var i=le(e);return function(e){return i(e,n)}}return c(n,r.filter((function(e){return!t(e,n)})))}}function de(e){var t=re(e);return function(n,r){if(void 0===r){var i=de(e);return function(e){return i(e,n)}}return n.filter((function(e){return t(e,r)}))}}function fe(e){var t=re(e);return function(n,r){if(void 0===r){var i=fe(e);return function(e){return i(e,n)}}return n.filter((function(e){return!t(e,r)}))}}var _e=function(e){return[e]},he=function(){return Lt},pe=function(e,t){return e.map((function(e){return t(e)}))},me=function(e,t){return e.map((function(e,n){return t(n,e)}))},ge=function(e,t){return m(pe(e,(function(e){return pe(t,e)})))},be=function(e,t){for(var n=0,r=e.length,i=new Array(r),s=0;s<r;s++){n+=(u=t(s,e[s])).length,i[s]=u}var o=Array(n),a=0;for(s=0;s<r;s++){for(var u,c=(u=i[s]).length,l=0;l<c;l++)o[l+a]=u[l];a+=c}return o},ve=function(e,t){return be(e,(function(e,n){return t(n)}))},ye=function(e,t){return Ae(e,(function(e,n){return t(n)}))},Oe=function(e,t){return e.filter(t)},we=function(e,t){for(var n=[],r=[],i=0;i<e.length;i++){var s=e[i];t(i,s)?r.push(s):n.push(s)}return{left:n,right:r}},ke=function(e,t){return we(e,(function(e,n){return t(n)}))},je=function(e,t){return Ee(e,(function(e,n){return t(n)}))},Ee=function(e,t){for(var n=[],r=[],i=0;i<e.length;i++){var s=t(i,e[i]);"Left"===s._tag?n.push(s.left):r.push(s.right)}return{left:n,right:r}},Me=function(e,t){return c(e,t())},Se=function(e,t,n){return Te(e,t,(function(e,t,r){return n(t,r)}))},Pe=function(e){var t=Ce(e);return function(e,n){return t(e,(function(e,t){return n(t)}))}},Ie=function(e,t,n){return De(e,t,(function(e,t,r){return n(t,r)}))},Te=function(e,t,n){for(var r=e.length,i=t,s=0;s<r;s++)i=n(s,i,e[s]);return i},Ce=function(e){return function(t,n){return t.reduce((function(t,r,i){return e.concat(t,n(i,r))}),e.empty)}},De=function(e,t,n){return e.reduceRight((function(e,t,r){return n(r,t,e)}),t)},Ae=function(e,t){for(var n=[],r=0;r<e.length;r++){var s=t(r,e[r]);Object(i.l)(s)&&n.push(s.value)}return n},xe=function(e,t){return e.filter((function(e,n){return t(n,e)}))},qe=function(e,t){return e.map((function(e,n,r){return t(r.slice(n))}))},Re=function(e){var t=Le(e);return function(e,n){return t(e,(function(e,t){return n(t)}))}},Le=function(e){return function(t,n){return Te(t,e.of(he()),(function(t,r,i){return e.ap(e.map(r,(function(e){return function(t){return M(e,t)}})),n(t,i))}))}},Ne=function(e){var t=Re(e);return function(n,r){return e.map(t(n,r),Ve)}},Ue=function(e){var t=Re(e);return function(n,r){return e.map(t(n,r),Ye)}},Be=function(e){return function(t){return Me(t,e)}},Ke=function(e){return function(t){return ge(t,e)}},We=function(e){return function(t){return ge(pe(t,(function(e){return function(){return e}})),e)}},ze=function(e){return function(t){return ge(pe(t,(function(){return function(e){return e}})),e)}},$e=function(e){return function(t){return ve(t,e)}},Fe=function(e){return function(t){return be(t,e)}},Ge=function(e){return function(t){return ve(t,(function(t){return pe(e(t),(function(){return t}))}))}},Je=function(e){return qe(e,r.e)},He=function(e){return function(t){return pe(t,e)}},Qe=function(e){return function(t){return me(t,e)}},Ve=function(e){return ye(e,r.e)},Ye=function(e){for(var t=[],n=[],r=0,i=e;r<i.length;r++){var s=i[r];"Left"===s._tag?t.push(s.left):n.push(s.right)}return{left:t,right:n}},Xe=function(e){return function(t){return Oe(t,e)}},Ze=function(e){return function(t){return ye(t,e)}},et=function(e){return function(t){return ke(t,e)}},tt=function(e){return function(t){return we(t,e)}},nt=function(e){return function(t){return je(t,e)}},rt=function(e){return function(t){return Ee(t,e)}},it=function(e){return function(t){return Ae(t,e)}},st=function(e){return function(t){return xe(t,e)}},ot=function(e){return function(t){return qe(t,e)}},at=function(e){var t=Pe(e);return function(e){return function(n){return t(n,e)}}},ut=function(e){var t=Ce(e);return function(e){return function(n){return t(n,e)}}},ct=function(e,t){return function(n){return Se(n,e,t)}},lt=function(e,t){return function(n){return Te(n,e,t)}},dt=function(e,t){return function(n){return Ie(n,e,t)}},ft=function(e,t){return function(n){return De(n,e,t)}},_t=function(e){var t=Re(e);return function(e){return function(n){return t(n,e)}}},ht=function(e){return function(t){return Se(t,e.of(he()),(function(t,n){return e.ap(e.map(t,(function(e){return function(t){return M(e,t)}})),n)}))}},pt=function(e){var t=Le(e);return function(e){return function(n){return t(n,e)}}},mt=function(e){var t=Ne(e);return function(e){return function(n){return t(n,e)}}},gt=function(e){var t=Ue(e);return function(e){return function(n){return t(n,e)}}},bt=function(e,t){for(var n=[],r=e;;){var s=t(r);if(!Object(i.l)(s))break;var o=s.value,a=o[0],u=o[1];n.push(a),r=u}return n},vt="ReadonlyArray",yt={URI:vt,map:pe},Ot={URI:vt,map:pe,mapWithIndex:me},wt={URI:vt,map:pe,ap:ge,of:_e},kt={URI:vt,map:pe,ap:ge,of:_e,chain:ve},jt={URI:vt,map:pe,alt:Me},Et={URI:vt,map:pe,ap:ge,of:_e,alt:Me,zero:he},Mt={URI:vt,map:pe,extend:qe},St={URI:vt,map:pe,compact:Ve,separate:Ye,filter:Oe,filterMap:ye,partition:ke,partitionMap:je},Pt={URI:vt,map:pe,mapWithIndex:me,compact:Ve,separate:Ye,filter:Oe,filterMap:ye,partition:ke,partitionMap:je,partitionMapWithIndex:Ee,partitionWithIndex:we,filterMapWithIndex:Ae,filterWithIndex:xe},It={URI:vt,reduce:Se,foldMap:Pe,reduceRight:Ie},Tt={URI:vt,reduce:Se,foldMap:Pe,reduceRight:Ie,reduceWithIndex:Te,foldMapWithIndex:Ce,reduceRightWithIndex:De},Ct={URI:vt,map:pe,reduce:Se,foldMap:Pe,reduceRight:Ie,traverse:Re,sequence:ht},Dt={URI:vt,map:pe,mapWithIndex:me,reduce:Se,foldMap:Pe,reduceRight:Ie,reduceWithIndex:Te,foldMapWithIndex:Ce,reduceRightWithIndex:De,traverse:Re,sequence:ht,traverseWithIndex:Le},At={URI:vt,map:pe,compact:Ve,separate:Ye,filter:Oe,filterMap:ye,partition:ke,partitionMap:je,reduce:Se,foldMap:Pe,reduceRight:Ie,traverse:Re,sequence:ht,wither:Ne,wilt:Ue};function xt(e,t,n){var r=n.slice();return r.splice(e,0,t),r}function qt(e,t,n){if(n[e]===t)return n;var r=n.slice();return r[e]=t,r}function Rt(e,t){var n=t.slice();return n.splice(e,1),n}var Lt=[],Nt=function(e){return He(Object(r.a)(e))},Ut=function(e,t){return $e((function(n){return Object(r.f)(t(n),He((function(t){return Object(r.b)(n,e,t)})))}))},Bt=function(e,t){return Object(r.d)(He((function(t){return function(n){return Object(r.b)(t,e,n)}})),Ke(t))}},function(e,t,n){"use strict";n.d(t,"j",(function(){return r})),n.d(t,"m",(function(){return i})),n.d(t,"k",(function(){return s})),n.d(t,"i",(function(){return o})),n.d(t,"l",(function(){return a})),n.d(t,"h",(function(){return u})),n.d(t,"a",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"o",(function(){return d})),n.d(t,"q",(function(){return f})),n.d(t,"s",(function(){return _})),n.d(t,"c",(function(){return h})),n.d(t,"r",(function(){return p})),n.d(t,"g",(function(){return m})),n.d(t,"n",(function(){return g})),n.d(t,"p",(function(){return b})),n.d(t,"d",(function(){return v})),n.d(t,"f",(function(){return y})),n.d(t,"b",(function(){return O}));const r=()=>({kind:"null",value:null}),i=e=>({kind:"string",value:e}),s=e=>({kind:"number",value:e}),o=e=>({kind:"array",value:e}),a=e=>({kind:"object",value:e}),u=e=>e,c=()=>({kind:"bottom"}),l=e=>({kind:"inner",a:e}),d=e=>({kind:"top",error:e}),f=e=>({kind:"unbounded",group:e}),_=(e,t)=>({kind:"windowed",key:t,group:e}),h=(e,t,n)=>({kind:"countLimit",n:n,limit:t,group:e}),p=(e,t,n)=>({kind:"uniqueLimit",n:n,limit:t,group:e}),m=e=>({kind:"numberGroup",group:e}),g=e=>({kind:"stringGroup",group:e}),b=e=>({kind:"tuple",tuple:e}),v=e=>({state:e}),y=(e,t)=>({commands:e,payload:t}),O=e=>e},function(e,t,n){"use strict";n.d(t,"m",(function(){return r})),n.d(t,"n",(function(){return i})),n.d(t,"o",(function(){return s})),n.d(t,"r",(function(){return o})),n.d(t,"g",(function(){return a})),n.d(t,"t",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"j",(function(){return l})),n.d(t,"s",(function(){return d})),n.d(t,"p",(function(){return j})),n.d(t,"c",(function(){return E})),n.d(t,"q",(function(){return M})),n.d(t,"b",(function(){return S})),n.d(t,"a",(function(){return P})),n.d(t,"d",(function(){return C})),n.d(t,"k",(function(){return x})),n.d(t,"i",(function(){return q})),n.d(t,"l",(function(){return R})),n.d(t,"h",(function(){return L})),n.d(t,"e",(function(){return N}));n(4);var r=function(e){return"Left"===e._tag},i=function(e){return"Right"===e._tag},s=function(e){return{_tag:"Left",left:e}},o=function(e){return{_tag:"Right",right:e}};function a(e){return function(t){return null==t?s(e):o(t)}}function u(e,t){try{return o(e())}catch(e){return s(t(e))}}function c(e,t){return function(n){return r(n)?e(n.left):t(n.right)}}var l=function(e){return function(t){return r(t)?e(t.left):t.right}};function d(e){return r(e)?o(e.left):s(e.right)}var f=function(e,t){return r(e)?e:o(t(e.right))},_=function(e,t){return r(e)?e:r(t)?t:o(e.right(t.right))},h=function(e,t){return r(e)?e:t(e.right)},p=function(e,t,n){return r(e)?t:n(t,e.right)},m=function(e){return function(t,n){return r(t)?e.empty:n(t.right)}},g=function(e,t,n){return r(e)?t:n(e.right,t)},b=function(e){return function(t,n){return r(t)?e.of(s(t.left)):e.map(n(t.right),o)}},v=function(e,t,n){return r(e)?s(t(e.left)):o(n(e.right))},y=function(e,t){return r(e)?s(t(e.left)):e},O=function(e,t){return r(e)?t():e},w=function(e,t){return r(e)?e:o(t(e))},k=function(e,t){return function(e,t){for(var n=t(e);"Left"===n._tag;)n=t(n.left);return n.right}(t(e),(function(e){return r(e)?o(s(e.left)):r(e.right)?s(t(e.right.left)):o(o(e.right.right))}))},j=function(e){return function(t){return f(t,e)}},E=function(e,t){return function(n){return v(n,e,t)}},M=function(e){return function(t){return y(t,e)}},S=function(e){return function(t){return _(t,e)}},P=S,I=o,T=function(e){return function(t){return h(t,e)}},C=T,D=function(e){return function(t){return r(t)?e.of(s(t.left)):e.map(t.right,o)}},A="Either";function x(e){return{concat:function(t,n){return r(n)?t:r(t)?n:o(e.concat(t.right,n.right))}}}function q(e){return{concat:function(t,n){return r(t)?t:r(n)?n:o(e.concat(t.right,n.right))}}}function R(e){var t=function(e){var t=s(e.empty);return{URI:A,_E:void 0,map:f,compact:function(e){return r(e)?e:"None"===e.right._tag?t:o(e.right.value)},separate:function(e){return r(e)?{left:e,right:e}:r(e.right)?{left:o(e.right.left),right:t}:{left:t,right:o(e.right.right)}},filter:function(e,n){return r(e)||n(e.right)?e:t},filterMap:function(e,n){if(r(e))return e;var i=n(e.right);return"None"===i._tag?t:o(i.value)},partition:function(e,n){return r(e)?{left:e,right:e}:n(e.right)?{left:t,right:o(e.right)}:{left:o(e.right),right:t}},partitionMap:function(e,n){if(r(e))return{left:e,right:e};var i=n(e.right);return r(i)?{left:o(i.left),right:t}:{left:t,right:o(i.right)}}}}(e);return{URI:A,_E:void 0,map:f,compact:t.compact,separate:t.separate,filter:t.filter,filterMap:t.filterMap,partition:t.partition,partitionMap:t.partitionMap,traverse:b,sequence:D,reduce:p,foldMap:m,reduceRight:g,wither:function(e){var n=b(e);return function(r,i){return e.map(n(r,i),t.compact)}},wilt:function(e){var n=b(e);return function(r,i){return e.map(n(r,i),t.separate)}}}}function L(e){return{URI:A,_E:void 0,map:f,ap:function(t,n){return r(t)?r(n)?s(e.concat(t.left,n.left)):t:r(n)?n:o(t.right(n.right))},of:I}}var N={URI:A,map:f,of:o,ap:_,chain:h,reduce:p,foldMap:m,reduceRight:g,traverse:b,sequence:D,bimap:v,mapLeft:y,alt:O,extend:w,chainRec:k,throwError:s}},function(e,t,n){"use strict";function r(e){return e}n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"g",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return c}));var i=function(){};function s(e,t,n,r,i,s,o,a,u){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return i(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return s(i(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return o(s(i(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return a(o(s(i(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return u(a(o(s(i(r(n(t(e.apply(this,arguments)))))))))}}}function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}function a(e,t,n,r,i,s,o,a,u,c){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return i(r(n(t(e))));case 6:return s(i(r(n(t(e)))));case 7:return o(s(i(r(n(t(e))))));case 8:return a(o(s(i(r(n(t(e)))))));case 9:return u(a(o(s(i(r(n(t(e))))))));case 10:return c(u(a(o(s(i(r(n(t(e)))))))))}}var u=function(e,t,n){var r;return Object.assign({},e,((r={})[t]=n,r))},c=function(e){return function(t){var n;return(n={})[e]=t,n}}},function(e,t,n){"use strict";n.d(t,"k",(function(){return a})),n.d(t,"i",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"e",(function(){return f})),n.d(t,"c",(function(){return _})),n.d(t,"l",(function(){return h})),n.d(t,"n",(function(){return p})),n.d(t,"o",(function(){return m})),n.d(t,"h",(function(){return g})),n.d(t,"j",(function(){return b})),n.d(t,"m",(function(){return v})),n.d(t,"d",(function(){return y})),n.d(t,"g",(function(){return O}));var r=n(6),i=n(0),s=n(11),o=n(7);function a(...e){return e.reduce((e,t)=>Object.assign(Object.assign({},e),t),{})}function u(e,...t){return t.reduce((e,t)=>e?e[t]:void 0,e)}function c(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function l(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),reject:t,resolve:e}}function d(e,t,n=!1,s=20){let o=0;const a=u=>new Promise(c=>Promise.resolve(t()).then(t=>t?Promise.resolve(e()).then(e=>c(Object(i.o)(e))):Object(r.a)(o++,e=>e<s?setTimeout(()=>c(a(u*(n?2:1))),u):c(i.n))));return a(50)}function f(...e){return t=>e.reduce((e,t)=>Promise.resolve(e).then(t),t)}function _(e){const t={equals:(t,n)=>t[0]===n[0]&&e.equals(t[1],n[1])},n=Object(o.i)(t);return Object(s.a)(e=>Object.entries(e))(n)}function h(e){if("string"==typeof e){const t=+e;if(!isNaN(t))return t}return e}function p(e,t){const n=t=>{if(!r&&t)return r=!0,e()};let r=!1;["blur","visibilitychange"].forEach(e=>{window.addEventListener(e,()=>n(document.hidden&&function(e){return/Mobi|Android/i.test(e)}(t)))}),["beforeunload","pagehide"].forEach(e=>{window.addEventListener(e,()=>n(!0))})}function m(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^(window.crypto||window.msCrypto).getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function g(e){return 36===e.length&&/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i.test(e)}function b(e,t){return Object.keys(e).reduce((n,r)=>{const s=t(r,e[r]);return Object.assign(Object.assign({},n),Object(i.l)(s)?{[r]:s.value}:{})},{})}function v(...e){return e.reduce((e,[t,n])=>Object.assign(Object.assign({},e),{[t]:n}),{})}function y(e,t){return b(e,(e,n)=>t(e)?Object(i.o)(n):i.n)}function O(e){return/^((?!chrome|android).)*safari/i.test(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4),i=r.f},function(e,t,n){"use strict";n.d(t,"i",(function(){return i})),n.d(t,"j",(function(){return s})),n.d(t,"h",(function(){return o})),n.d(t,"o",(function(){return a})),n.d(t,"n",(function(){return u})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"l",(function(){return f})),n.d(t,"m",(function(){return _})),n.d(t,"q",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"k",(function(){return m})),n.d(t,"c",(function(){return g})),n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return v})),n.d(t,"p",(function(){return y}));var r=n(1),i=(r.fb,r.db,r.cb),s=r.eb,o=(r.qb,r.zb,r.Eb,r.W),a=(r.X,r.ab,r.Ib,r.Jb,r.kb,r.lb,r.mb,r.pb,r.C,r.Mb,r.gb,r.nb,r.Rb,r.hb,r.Sb);r.Ub;function u(e){return r.Pb(e)}var c=r.F,l=(r.H,r.G);r.S;function d(e){return r.Q(e)}r.R;r.V,r.U,r.Vb,r.ib,r.fc,r.D,r.tb;var f=r.Fb,_=(r.Gb,r.ob,r.Nb),h=r.jc,p=(r.ic,r.ec,r.Hb,r.J);r.ac,r.Ob,r.y,r.Qb,r.z;r.Zb;var m=r.jb,g=r.E,b=(r.ub,r.k.map,r.k.ap,r.k.chain,r.j.mapWithIndex,r.e.filter,r.e.filterMap,r.e.partition,r.e.partitionMap,r.f.filterWithIndex,r.f.filterMapWithIndex,r.f.partitionWithIndex,r.f.partitionMapWithIndex,r.g.reduce,r.g.foldMap,r.g.reduceRight,r.l.traverse,r.b.alt,r.h.reduceWithIndex,r.h.foldMapWithIndex,r.h.reduceRightWithIndex,r.m.traverseWithIndex,r.d.extend,r.n.wither,r.n.wilt,r.rb,r.p,r.q,r.s,r.v),v=(r.x,r.w,r.sb,r.A),y=(r.Kb,r.M,r.N,r.vb,r.yb,r.wb,r.xb,r.o,r.O,r.P,r.L,r.I,r.Y,r.Z,r.Ab,r.Db,r.Bb,r.Cb,r.Wb);r.Lb,r.Xb,r.hc,r.gc,r.Yb,r.b.zero,r.cc,r.dc,r.bc,r.u,r.t,r.r},function(e,t,n){"use strict";n.d(t,"j",(function(){return o})),n.d(t,"i",(function(){return a})),n.d(t,"f",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"h",(function(){return d})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return _})),n.d(t,"d",(function(){return h})),n.d(t,"a",(function(){return m}));var r=n(18);function i(e,t){return e<t?-1:e>t?1:0}function s(e,t){return e===t}var o={equals:s,compare:i},a={equals:s,compare:i};function u(e){return function(t,n){return-1===e.compare(t,n)}}function c(e){return function(t,n){return 1===e.compare(t,n)}}function l(e){return function(t,n){return-1!==e.compare(t,n)}}function d(e){return function(t,n){return 1===e.compare(t,n)?n:t}}function f(e){return function(t,n){return-1===e.compare(t,n)?n:t}}function _(e){var t=function(t,n){return t===n?0:e(t,n)};return{equals:function(e,n){return 0===t(e,n)},compare:t}}function h(){return{concat:{concat:function(e,t){return _((function(n,i){return r.b.concat(e.compare(n,i),t.compare(n,i))}))}}.concat,empty:_((function(){return 0}))}}var p=function(e,t){return _((function(n,r){return e.compare(t(n),t(r))}))},m=function(e){return function(t){return p(t,e)}}},function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"g",(function(){return a})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"f",(function(){return f})),n.d(t,"a",(function(){return h}));var r=n(3);n(0);var i=n(4),s=n(10),o=Object(i.d)(r.o,s.h),a=Object(i.d)(r.r,s.h),u=(r.r,r.o,s.e,function(e){return r.m(e)?o(e.left):a(e.right)}),c=function(e){return function(t){return"None"===t._tag?o(e()):a(t.value)}};function l(e,t){return function(){return e().then(r.r,(function(e){return r.o(t(e))}))}}r.f,s.d;var d=function(e){return function(t){return Object(i.f)(t,s.d(r.f(e,s.h)))}};r.s;var f=function(e){return s.g(r.p(e))},_=(r.c,s.g,function(e){return function(t){return Object(i.f)(t,s.d(r.f(o,e)))}}),h=_;i.e},function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"g",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"f",(function(){return _})),n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return p}));var r=n(4),i=function(e){return function(){return Promise.resolve(e())}};var s=function(e,t){return function(){return e().then(t)}},o=function(e,t){return function(){return Promise.all([e(),t()]).then((function(e){return(0,e[0])(e[1])}))}},a=function(e,t){return function(){return e().then((function(e){return t(e)()}))}},u=function(e){return function(t){return s(t,e)}},c=function(e){return function(t){return o(t,e)}},l=function(e){return function(){return Promise.resolve(e)}},d=function(e){return function(t){return a(t,e)}},f=(r.e,"Task");function _(e){return{concat:function(t,n){return function(){return t().then((function(t){return n().then((function(n){return e.concat(t,n)}))}))}}}}var h={URI:f,map:s,ap:o,of:l},p={URI:f,map:s,of:l,ap:o,chain:a}},function(e,t,n){"use strict";function r(e){return{equals:function(t,n){return t===n||e(t,n)}}}n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"e",(function(){return l}));var i=function(e){return function(t){return s(t,e)}},s=function(e,t){return r((function(n,r){return e.equals(t(n),t(r))}))},o={equals:function(e,t){return e===t}};var a=o,u=o,c=o;function l(e){return r((function(t,n){for(var r in e)if(!e[r].equals(t[r],n[r]))return!1;return!0}))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return a}));const r=e=>Object.assign({id:e.id,name:e.name,time:new Date(e.time),properties:e.properties||{}},u(e)),i=e=>Object.assign({id:e.id||null,name:e.name,time:(c(e.time)?e.time:new Date).toISOString(),properties:e.properties||{}},u(e)),s=(e,t)=>Object.assign({id:e.id,time:new Date(e.time),name:t.name,properties:t.properties},u(t)),o=e=>void 0!==e.request_id,a=e=>void 0!==e.properties,u=e=>Object.assign(Object.assign({},e.session_id?{session_id:e.session_id}:{}),e.view_id?{view_id:e.view_id}:{}),c=e=>isFinite(e)&&e instanceof Date},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return a})),n.d(t,"f",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l}));var r=n(5),i=n(0);const s=(e,t)=>e in t,o=e=>Object.entries(e).filter(([e,t])=>{var n;return!0===(null===(n=t.result)||void 0===n?void 0:n.result)}).map(([e,t])=>parseInt(e,10)),a=e=>e.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:!0}),{}),u=e=>Object(r.j)(e,(e,t)=>t.state?Object(i.o)({[t.checksum]:t.state}):i.n),c=(e,t,n)=>e.filter(e=>{var r,i,s,o;return(null===(i=null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.client)||void 0===i?void 0:i.type)===t&&(null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.client)||void 0===o?void 0:o.domain)===n}),l=(e,t=100)=>{const n={SegmentEntry:1,SegmentExit:1,ThirdPartySegments:1,PageviewEngagement:1,SlotClicked:1,SlotRendered:1,SlotViewable:1,Reaction:1,PrebidBid:1,PrebidBids:1,rtaBid:1};return e.filter(e=>!n[e.name]).slice(-1*t)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return w}));var r,i=n(3),s=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=function(){function e(e,t,n,r){this.name=e,this.is=t,this.validate=n,this.encode=r,this.decode=this.decode.bind(this)}return e.prototype.pipe=function(t,n){var r=this;return void 0===n&&(n="pipe("+this.name+", "+t.name+")"),new e(n,t.is,(function(e,n){var s=r.validate(e,n);return Object(i.m)(s)?s:t.validate(s.right,n)}),this.encode===a&&t.encode===a?a:function(e){return r.encode(t.encode(e))})},e.prototype.asDecoder=function(){return this},e.prototype.asEncoder=function(){return this},e.prototype.decode=function(e){return this.validate(e,[{key:"",type:this,actual:e}])},e}(),a=function(e){return e},u=i.o,c=function(e,t,n){return u([{value:e,context:t,message:n}])},l=i.r,d=(new(function(e){function t(){var t=e.call(this,"null",(function(e){return null===e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="NullType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"undefined",(function(e){return void 0===e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="UndefinedType",t}return s(t,e),t}(o))),f=(new(function(e){function t(){var t=e.call(this,"void",d.is,d.validate,a)||this;return t._tag="VoidType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"unknown",(function(e){return!0}),l,a)||this;return t._tag="UnknownType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"string",(function(e){return"string"==typeof e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="StringType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"number",(function(e){return"number"==typeof e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="NumberType",t}return s(t,e),t}(o))),_=(new(function(e){function t(){var t=e.call(this,"bigint",(function(e){return"bigint"==typeof e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="BigIntType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"boolean",(function(e){return"boolean"==typeof e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="BooleanType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"UnknownArray",Array.isArray,(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="AnyArrayType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"UnknownRecord",(function(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Window]"===t}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="AnyDictionaryType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"Function",(function(e){return"function"==typeof e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="FunctionType",t}return s(t,e),t}(o)),function(e){function t(t,n,r,i,s,o){var a=e.call(this,t,n,r,i)||this;return a.type=s,a.predicate=o,a._tag="RefinementType",a}return s(t,e),t}(o)),h=(m(f,(function(e){return Number.isInteger(e)}),"Int"),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.value=s,o._tag="LiteralType",o}s(t,e)}(o),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.keys=s,o._tag="KeyofType",o}s(t,e)}(o),Object.prototype.hasOwnProperty,function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.runDefinition=s,o._tag="RecursiveType",o}return s(t,e),t}(o));Object.defineProperty(h.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});(function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.type=s,o._tag="ArrayType",o}s(t,e)})(o),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.props=s,o._tag="InterfaceType",o}s(t,e)}(o),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.props=s,o._tag="PartialType",o}s(t,e)}(o),function(e){function t(t,n,r,i,s,o){var a=e.call(this,t,n,r,i)||this;return a.domain=s,a.codomain=o,a._tag="DictionaryType",a}s(t,e)}(o);var p=function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.types=s,o._tag="UnionType",o}return s(t,e),t}(o);!function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.types=s,o._tag="IntersectionType",o}s(t,e)}(o);!function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.types=s,o._tag="TupleType",o}s(t,e)}(o);(function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.type=s,o._tag="ReadonlyType",o}s(t,e)})(o),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.type=s,o._tag="ReadonlyArrayType",o}s(t,e)}(o),function(e){function t(t,n,r,i,s,o){var a=e.call(this,t,n,r,i,s)||this;return a.tag=o,a}s(t,e)}(p),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.type=s,o._tag="ExactType",o}s(t,e)}(o),new(function(e){function t(){var t=e.call(this,"never",(function(e){return!1}),(function(e,t){return c(e,t)}),(function(){throw new Error("cannot encode never")}))||this;return t._tag="NeverType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"any",(function(e){return!0}),l,a)||this;return t._tag="AnyType",t}return s(t,e),t}(o)),new(function(e){function t(){var t=e.call(this,"object",(function(e){return null!==e&&"object"==typeof e}),(function(e,n){return t.is(e)?l(e):c(e,n)}),a)||this;return t._tag="ObjectType",t}return s(t,e),t}(o));function m(e,t,n){var r;return void 0===n&&(n="("+e.name+" | "+(((r=t).displayName||r.name||"<function"+r.length+">")+")")),new _(n,(function(n){return e.is(n)&&t(n)}),(function(n,r){var s=e.validate(n,r);if(Object(i.m)(s))return s;var o=s.right;return t(o)?l(o):c(o,r)}),e.encode,e,t)}m(f,Number.isInteger,"Integer"),function(e){function t(t,n,r,i,s){var o=e.call(this,t,n,r,i)||this;return o.props=s,o._tag="StrictType",o}s(t,e)}(o);var g=n(2),b=n(7),v=n(6),y=n(4);function O(e){switch(e.kind){case"null":return k.encode(e);case"string":return j.encode(e);case"number":return E.encode(e);case"array":return M.encode(e);case"object":return S.encode(e)}}function w(e){return null===e?k.decode(e):"number"==typeof e?E.decode(e):"string"==typeof e?j.decode(e):Array.isArray(e)?M.decode(e):S.decode(e)}const k=new o("simpleNullCodec",e=>{const t=e;return"null"===t.kind&&null===t.value},(e,t)=>null===e?l(Object(g.j)()):c(e,t),e=>e.value),j=new o("simpleStringCodec",e=>{const t=e;return"string"===t.kind&&"string"==typeof t.value},(e,t)=>"string"==typeof e?l(Object(g.m)(e)):c(e,t),e=>e.value),E=new o("simpleNumberCodec",e=>{const t=e;return"number"===t.kind&&"number"==typeof t.value},(e,t)=>"number"==typeof e?l(Object(g.k)(e)):c(e,t),e=>e.value),M=new o("simpleArrayCodec",e=>{const t=e;return"array"===t.kind&&Array.isArray(t.value)},(e,t)=>{if(Array.isArray(e)){const t=Object(b.p)(i.e)(w)(e);return Object(i.p)(g.i)(t)}return c(e,t)},e=>e.value.map(O)),S=new o("simpleObjectCodec",e=>"object"===e.kind,(e,t)=>{if(e&&e.constructor===Object){const t=Object(b.p)(i.e)(([e,t])=>Object(v.a)(w(t),Object(i.p)(t=>Object(y.g)(e,t))))(Object.entries(e));return Object(i.p)(e=>Object(g.l)(new Map([...e])))(t)}return c(e,t)},e=>{const t=[...e.value.entries()];return Object.assign({},...Array.from(t,([e,t])=>({[e]:O(t)})))});new o("simpleJsonCodec",e=>k.is(e)||E.is(e)||j.is(e)||M.is(e)||S.is(e),w,O)},function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return c}));var r=n(0),i=n(7),s=n(6),o=n(4),a=n(11);class u{constructor(e,t,n){this._internals=e,this.permutive=t,this.network=n,this.providers={},this.identities=this._internals.state.getPermutiveData("identities")||{},this.aliases=this._internals.state.getPermutiveData("aliases")||{}}prepareThirdPartyIdentities(){const e=this._internals.metrics.startTimer("sdk_get_third_party_identities_task_duration_seconds",{}),t=[];return Promise.all(t).then(e=>Promise.all(e.map(e=>e.make(this._internals,this.network,this.permutive)))).then(e=>Object(s.a)(Object(i.b)(e),e=>Promise.all(e.map(e=>this.shouldAskForNewIdentity(e)?this.retrieveIdentity(e):Promise.resolve(Object(o.g)(e,this.getCachedIdentity(e.tag))))))).then(e=>e.map(([e,t])=>(this.providers[e.tag]=e,this.setIdentityAndAliasIfPresent(e.tag,t,e.ttlInSeconds)))).then(()=>this._internals.metrics.stopTimer("sdk_get_third_party_identities_task_duration_seconds",e))}getIdentities(e=!1){const t=t=>this.identities[t].value&&(!e||this.providers[t].usedForThirdPartyData);return Object.keys(this.identities).reduce((e,n)=>Object.assign(Object.assign({},e),t(n)?{[n]:this.identities[n].value}:{}),{})}getAliasesFromIdentifyArg(e){if("string"!=typeof e&&"object"!=typeof e||null===e||""===e)throw new Error("Identify must be passed a non-empty string or list of aliases, value passed was '"+e+"'");return"string"==typeof e?[{id:e,tag:"default"}]:e}aliasMapToPrioritizedList(e){const t={default:0},n=e=>Object(r.k)(this._internals.identities.getCachedIdentity(e))?0:e in t?t[e]+1:1;return Object.keys(e).map(t=>({id:e[t],tag:t,priority:n(t)}))}shouldAskForNewIdentity(e){const t=Object(r.d)(this.identities[e.tag]);return Object(r.b)(()=>!0,t=>this.isIdentityExpired(e.tag))(t)}getCachedIdentity(e){return this.identities[e]?Object(r.d)(this.identities[e].value):r.n}setIdentityAndAliasIfPresent(e,t,n=86400){return Object(r.b)(()=>{this.identities[e]={expiry:Date.now()+Math.floor(1e3*n)},this._internals.state.setPermutiveData("identities",this.identities)},t=>{this.identities[e]={value:t,expiry:Date.now()+Math.floor(1e3*n)},this.setAlias(t,e),this._internals.state.setPermutiveData("identities",this.identities)})(t)}setAlias(e,t){this.aliases[t]=e,this._internals.state.setPermutiveData("aliases",this.aliases)}retrieveIdentity(e){return e.getId().then(t=>"skipped"===t.type?Object(o.g)(e,r.n):Object(s.a)(t.result,t=>this._internals.metrics.track({name:Object(r.l)(t)?"sdk_third_party_identity_present_count":"sdk_third_party_identity_missing_count",value:1,labels:{identity_tag:e.tag}}),n=>Object(o.g)(e,t.result)))}isIdentityExpired(e){return Date.now()>=this.identities[e].expiry}}const c=(e,t,n,r)=>{const s={"e43c8a90-d17b-4790-bfda-81b069b3b8c2":(e,t,n)=>["thestudentroom.co.uk"].some(e=>n.indexOf(e)>-1)&&Object(i.k)(a.d)(t,["tsr-"]).length>0,"5d79bce7-5d2b-427e-a6c4-b89b6c7bf048":(e,t)=>{const n=["(null)"];return n.indexOf(e)>-1||!!l[e]||Object(i.k)(a.d)(t,n).length>0}}[e];return!!s&&s(r,t,n)},l={}},function(e,t,n){"use strict";n.d(t,"b",(function(){return H})),n.d(t,"a",(function(){return Q}));var r=n(2),i=n(8);const s=(e,t)=>{switch(e.kind){case"bottom":return Object(r.a)();case"inner":return Object(r.e)(t(e.a));case"top":return Object(r.o)(e.error)}},o=e=>Object(i.b)((t,n)=>{if("bottom"===t.kind&&"bottom"===n.kind)return 0;if("bottom"===t.kind)return-1;if("bottom"===n.kind)return 1;if("top"===t.kind&&"top"===n.kind)return i.j.compare(t.error,n.error);if("top"===t.kind)return 1;if("top"===n.kind)return-1;if("inner"===t.kind&&"inner"===n.kind)return e.compare(t.a,n.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")});var a=n(0),u=(n(4),n(1));var c=u.C;u.Mb;function l(e){return u.lb(e)?Object(a.o)(e):a.n}u.fb;u.Fb;var d=u.cb;u.ub;u.jc,u.ic,u.ec,u.i.map,u.j.mapWithIndex,u.c.ap,u.k.chain,u.d.extend,u.g.reduce,u.g.foldMap,u.g.reduceRight,u.l.traverse,u.a.alt,u.h.reduceWithIndex,u.h.foldMapWithIndex,u.h.reduceRightWithIndex,u.m.traverseWithIndex,u.o,u.p,u.q,u.s,u.v,u.w,u.I,u.L,u.W,u.rb,u.sb,u.Ab,u.Db,u.Bb,u.Cb,u.Wb,u.Lb,u.Xb;var f=c,_=function(e){return l(u.bb(e))},h=d;var p=n(7),m=n(3),g=n(18);function b(e,t){return Object(p.b)(e.map(t))}function v(e,t,n,r){const s=(e,t)=>{if(0===e.length)return Object(p.b)(t.map(e=>Object(a.o)({1:e[1],2:n(a.n,Object(a.o)(e[2]))})));if(0===t.length)return Object(p.b)(e.map(e=>Object(a.o)({1:e[1],2:n(Object(a.o)(e[2]),a.n)})));if(e.length>0&&t.length>0&&Object(i.f)(r)(e[0][1],t[0][1])){const[r,...i]=e,o=r[1],u=r[2];return f({1:o,2:n(Object(a.o)(u),a.n)},s(i,t))}if(e.length>0&&t.length>0&&Object(i.e)(r)(e[0][1],t[0][1])){const[r,...i]=t,o=r[1],u=r[2];return f({1:o,2:n(a.n,Object(a.o)(u))},s(e,i))}if(e.length>0&&t.length>0){const[r,...i]=e,[o,...u]=t,c=r[1],l=r[2],d=o[2];return f({1:c,2:n(Object(a.o)(l),Object(a.o)(d))},s(i,u))}throw new Error("Non exhaustive match in mapOption2")},o=Object(i.a)(e=>e[1])(r),u=(e=>{const t=b(e,e=>Object(a.l)(e[2])?Object(a.o)({1:e[1],2:e[2].value}):a.n);return 0===t.length?a.n:Object(a.o)(t)})(s(Object(p.m)(o)([...e].map(e=>({1:e[0],2:e[1]}))),Object(p.m)(o)([...t].map(e=>({1:e[0],2:e[1]})))));return Object(a.m)(e=>new Map(e.map(e=>[e[1],e[2]])))(u)}function y(e,t,n,r){const s=Object(i.a)(e=>e[0])(r),o=Object(p.m)(s)([...t]).reduceRight((e,t)=>{if(Object(m.m)(e)){const r=n(t[1],e.left);return Object(a.l)(r)?Object(m.o)(r.value):Object(m.r)(t[0])}return e},Object(m.o)(e));return Object(a.c)(o)}function O(e,t){return new Map([...e].map(t))}function w(e,t){return new Map([...e].filter(t))}var k=n(11),j=n(6);function E(e){return Object(a.m)(C)(function(e){switch(e.state.kind){case"top":return Object(a.o)(Object(r.m)(e.state.error));case"bottom":return a.n;case"inner":return function(e){return function(e){switch(e.kind){case"numberGroup":case"stringGroup":return M(e.group);case"tuple":return e.tuple.length>0}}(e.payload)?Object(a.o)(Object(r.i)(function(e,t){const n=Object(a.m)(e=>f(e,t))(e);return Object(a.h)(()=>t)(n)}(Object(a.m)(e=>Object(r.m)(function(e){const t=e=>{switch(e){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}};return e.map(e=>1===e[2]?t(e[1]):t(e[1])+JSON.stringify(e[2])).join("")}(e)))(e.commands),function(e){const t=e=>{switch(e.kind){case"bottom":return Object(r.j)();case"top":return Object(r.m)(e.error);case"inner":return Object(r.k)(e.a)}};switch(e.kind){case"tuple":return e.tuple.map(t);case"stringGroup":return n=e.group,b([S,P,e=>Object(j.a)(e,T,r.l,a.o)],e=>e(n));case"numberGroup":return(e=>b([S,I,e=>Object(j.a)(e,T,e=>O(e,([e,t])=>[JSON.stringify(e),t]),r.l,a.o)],t=>t(e)))(e.group)}var n}(e.payload)))):a.n}(e.state.a)}}(e))}function M(e){switch(e.kind){case"unbounded":return e.group.size>0;case"windowed":return e.group.size>0||Object(a.l)(e.key);case"countLimit":case"uniqueLimit":return e.group.size>0||Object(a.l)(e.limit)}}function S(e){switch(e.kind){case"unbounded":return a.n;case"windowed":return Object(a.o)(Object(r.m)("w"));case"countLimit":return Object(a.o)(Object(r.m)(1===e.n?"x":"x"+e.n));case"uniqueLimit":return Object(a.o)(Object(r.m)(1===e.n?"u":"u"+e.n))}}function P(e){switch(e.kind){case"unbounded":return a.n;case"windowed":return Object(a.o)(Object(r.m)(Object(a.l)(e.key)?e.key.value:""));case"countLimit":case"uniqueLimit":return Object(a.o)(Object(r.m)(Object(a.l)(e.limit)?e.limit.value:""))}}function I(e){switch(e.kind){case"unbounded":return a.n;case"windowed":return Object(a.l)(e.key)?Object(a.o)(Object(r.k)(e.key.value)):Object(a.o)(Object(r.j)());case"countLimit":case"uniqueLimit":return Object(a.l)(e.limit)?Object(a.o)(Object(r.k)(e.limit.value)):Object(a.o)(Object(r.j)())}}function T(e){switch(e.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return e.group}}function C(e){switch(e.kind){case"array":return 0===e.value.length?Object(r.j)():1===e.value.length?C(e.value[0]):Object(r.i)(e.value.map(C));case"object":return Object(j.a)(w(e.value,([e,t])=>"null"!==t.kind),e=>O(e,e=>[e[0],C(e[1])]),r.l);default:return e}}function D(e){const t=e=>{if(0===e.length)return Object(r.a)();const t=(e=>{if(4!==e.length)return a.n;const[t,n,r,i]=e;if("string"===t.kind&&"string"===n.kind&&"object"===i.kind){const e=Object(a.e)(e=>A(e[1].value)&&x(e[2].value))({1:t,2:n});return Object(a.m)(e=>({prim:e[1].value,grp:e[2].value,cutoff:r,m:i.value}))(e)}return a.n})(e);if(Object(a.l)(t)){const{prim:e,grp:n,cutoff:i,m:s}=t.value,o=q(i,s,R(n));return"string"==typeof o?Object(r.o)(o):Object(r.e)(Object(r.f)(L(e),o))}const n=(e=>{if(3!==e.length)return a.n;const[t,n,r]=e;if("string"===t.kind&&"object"===r.kind){const e=Object(a.e)(e=>x(e.value))(t);return Object(a.m)(e=>({grp:e.value,cutoff:n,m:r.value}))(e)}return a.n})(e);if(Object(a.l)(n)){const{grp:e,cutoff:t,m:i}=n.value,s=q(t,i,R(e));return"string"==typeof s?Object(r.o)(s):Object(r.e)(Object(r.f)(a.n,s))}const i=(e=>{if(2!==e.length)return a.n;const[t,n]=e;if("string"===t.kind&&"object"===n.kind){const e=Object(a.e)(e=>A(e.value))(t);return Object(a.m)(e=>({prim:e.value,m:n.value}))(e)}return a.n})(e);if(Object(a.l)(i)){const{prim:e,m:t}=i.value;return Object(r.e)(Object(r.f)(L(e),Object(r.n)(Object(r.q)(t))))}const s=(e=>{if(1!==e.length)return a.n;const[t]=e;return"object"===t.kind?Object(a.o)({m:t.value}):a.n})(e);if(Object(a.l)(s)){const{m:e}=s.value;return Object(r.e)(Object(r.f)(a.n,Object(r.n)(Object(r.q)(e))))}const o=(e=>{if(e.length<1)return a.n;const[t,...n]=e;if("string"===t.kind){const e=Object(a.e)(e=>A(e.value))(t);return Object(a.m)(e=>({prim:e.value,rest:n}))(e)}return a.n})(e);if(Object(a.l)(o)){const{prim:e,rest:t}=o.value;return Object(r.e)(Object(r.f)(L(e),N(t)))}return Object(r.e)(Object(r.f)(a.n,N(e)))},n=e=>{switch(e.kind){case"array":return Object(p.a)(n)(e.value);default:return[e]}};switch(e.kind){case"null":return Object(r.d)(Object(r.a)());default:return Object(r.d)(t(n(e)))}}function A(e){const t=e.split("");switch(!0){case 0===t.length:return!1;default:{const[e,...n]=t;return-1!=="pmvn".indexOf(e)&&n.every(e=>-1!=="pmvn0123456789".indexOf(e))}}}function x(e){const t=e.split("");switch(!0){case 0===t.length:return!1;case"w"===t[0]&&void 0===t[1]:return!0;default:{const[e,...n]=t;return-1!=="ux".indexOf(e)&&-1===n.map(e=>!isNaN(parseInt(e))).indexOf(!1)}}}function q(e,t,n){switch(e.kind){case"string":return Object(r.n)(n({1:Object(a.o)(e.value),2:t}));case"number":case"null":return Object(r.g)(n({1:"null"===e.kind?a.n:Object(a.o)(e.value),2:w(O(t,([e,t])=>[Number(e),t]),e=>!isNaN(e[0]))}));default:return"{bad cutoff}"}}function R(e){const t=e=>t=>Object(r.r)(t[2],t[1],e),n=e=>t=>Object(r.c)(t[2],t[1],e),i=e.split("");switch(!0){case"w"===i[0]&&void 0===i[1]:return e=>Object(r.s)(e[2],e[1]);case"u"===i[0]&&void 0===i[1]:return t(1);case"u"===i[0]&&void 0!==i[1]:return t(parseInt(i.slice(1).join("")));case"x"===i[0]&&void 0===i[1]:return n(1);case"x"===i[0]&&void 0!==i[1]:return n(parseInt(i.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function L(e){return Object(a.m)(r.h)(_(function e(t,n){const r=n(t);return Object(a.h)(()=>[])(Object(a.m)(t=>[t[1]].concat(e(t[2],n)))(r))}(e,e=>{const t=e.split("");if(0===t.length)return a.n;const[n,...r]=t,i=(e=>{switch(e){case"p":return Object(a.o)("add");case"m":return Object(a.o)("mul");case"v":return Object(a.o)("max");case"n":return Object(a.o)("min");default:return a.n}})(n);return Object(a.m)(e=>{const{init:t,rest:n}=Object(p.n)(e=>{return"number"==typeof(t=parseInt(e))&&isFinite(t)&&Math.floor(t)===t;var t})(r);return{1:{1:e,2:0===t.length?1:parseInt(t.join(""))},2:n.join("")}})(i)})))}function N(e){return Object(r.p)(e.map(U))}function U(e){switch(e.kind){case"number":return Object(r.e)(e.value);case"string":return Object(r.o)(e.value);case"null":return Object(r.a)();case"object":return Object(r.o)("{object}");case"array":return Object(r.o)("{array}")}}const B=Object(r.b)({strategy:(e,t,n)=>r=>{if(Object(a.k)(n))return t;if("delta"===e&&Object(a.k)(t))return a.n;if(Object(a.k)(t))return n;if(Object(a.l)(t)&&Object(a.l)(n))return r(t.value,n.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(e,t,n,s,a,u)=>{const c=Object(p.j)(o(u));if("append"===e&&"add"===t)return Object(p.q)(n,s,J(a.plus));if("append"===e&&"mul"===t)return Object(p.q)(n,s,J(a.times));if("append"===e&&"max"===t)return Object(i.g)(c)(n,s);if("join"===e&&"add"===t)return Object(p.q)(n,s,J(Object(i.g)(u)));if("join"===e&&"mul"===t)return Object(p.q)(n,s,J(Object(i.g)(u)));if("join"===e&&"max"===t)return Object(i.g)(c)(n,s);if("min"===t)return B.operation(e,"max",n,s,a,function(e){return Object(i.b)((t,n)=>Object(g.a)(e.compare(t,n)))}(u));if("delta"===e&&"max"===t)return Object(i.e)(c)(n,s)?n:s.map(r.a);if("delta"===e)return Object(p.q)(n,s,(e,t)=>Object(i.e)(o(u))(e,t)?e:Object(r.a)());throw new Error("Non exhaustive match in combineCommand.operation")}}),K={plus:(e,t)=>e+t,times:(e,t)=>e*t};function W(e,t,n,s){if("unbounded"===e.kind&&"unbounded"===t.kind){const i=e.group,o=t.group;return Object(a.h)(r.a)(Object(a.m)(e=>Object(r.e)(Object(r.q)(e)))(v(i,o,n,s)))}if("windowed"===e.kind&&"windowed"===t.kind){const o=e.key,u=e.group,c=t.key,l=t.group,d=Object(i.g)(Object(a.i)(s))(o,c);return Object(a.h)(r.a)(Object(a.m)(e=>Object(r.e)(Object(r.s)(e,d)))(v(u,l,n,s)))}if("countLimit"===e.kind&&"countLimit"===t.kind){const o=e.n,u=t.n;if(o===u){const u=e.limit,c=e.group,l=t.limit,d=t.group,f=Object(i.g)(Object(a.i)(s))(u,l);return Object(a.h)(r.a)(Object(a.m)(e=>Object(r.e)(Object(r.c)(e,f,o)))(v(c,d,n,s)))}return Object(r.o)("Non matching counts")}if("uniqueLimit"===e.kind&&"uniqueLimit"===t.kind){const o=e.n,u=t.n;if(o===u){const u=e.limit,c=e.group,l=t.limit,d=t.group,f=Object(i.g)(Object(a.i)(s))(u,l);return Object(a.h)(r.a)(Object(a.m)(e=>Object(r.e)(Object(r.r)(e,f,o)))(v(c,d,n,s)))}return Object(r.o)("Non matching counts")}return Object(r.o)("Non matching group types")}function z(e,t,n){return Object(a.h)(r.j)(function e(t,n){const o=n=>(r,i)=>B.strategy(t,r,i)(e(t,n)),u=(e,n,u)=>{if("stringGroup"===n.kind&&"stringGroup"===u.kind){const t=W(n.group,u.group,o(e),i.j);return s(t,e=>Object(r.n)(F(e,i.j)))}if("numberGroup"===n.kind&&"numberGroup"===u.kind){const t=W(n.group,u.group,o(e),i.i);return s(t,e=>Object(r.g)(F(e,i.i)))}if("tuple"===n.kind&&"tuple"===u.kind){const s=Object(a.l)(e)?e.value:[];return Object(r.e)(Object(r.p)(function(e,t,n,i,s,o){const a=(e,t)=>({1:Object(p.o)(e)(t).concat([...Array(Math.max(0,e-t.length))].map(r.a)),2:Object(p.d)(e)(t)}),u=(t,n,r)=>{if(0===t.length)return B.operation(e,"max",n,r,s,o);if(0===n.length)return r;if(0===r.length)return n;if(t.length>0){const[i,...c]=t,l=a(i[2],n),d=l[1],f=l[2],_=a(i[2],r),h=_[1],p=_[2];return B.operation(e,i[1],d,h,s,o).concat(u(c,f,p))}throw new Error("Non exhaustive match in recurse")};return Object(p.l)(Object(p.e)(e=>"bottom"===e.kind)(Object(p.l)(u(t,n,i))))}(t,s,n.tuple,u.tuple,K,i.i)))}throw new Error(`Non matching payload. Got ${n.kind} and ${u.kind}`)},c=(e,t)=>{if(Object(a.f)(h(Object(k.e)({1:k.d,2:k.c}))).equals(e.commands,t.commands)){const i=Object(a.k)(e.commands)?n:e.commands,o=u(i,e.payload,t.payload);return s(o,t=>Object(r.f)(e.commands,t))}throw new Error(`Non matching primitive strings. Got ${JSON.stringify(e)} and ${JSON.stringify(t)}`)};return(e,t)=>E(Object(r.d)(G(c,D(e).state,D(t).state)))}(e,a.n)(t,n))}function $(e,t,n){const r=Object(a.m)(t=>w(e,([e,r])=>Object(i.c)(n)(e,t)))(t);return Object(a.h)(()=>e)(r)}function F(e,t){switch(e.kind){case"unbounded":return e;case"windowed":return Object(a.k)(e.key)?e:Object(r.s)($(e.group,e.key,t),e.key);case"countLimit":{const n=e.limit,s=e.n,o=e.group,u=y(s,o,(e,t)=>t<=1?a.n:Object(a.o)(t-1),t),c=Object(i.g)(Object(a.i)(t))(n,u);return Object(r.c)($(o,c,t),c,s)}case"uniqueLimit":{const n=e.limit,s=e.n,o=e.group,u=(e,t)=>{switch(e.kind){case"object":{const n=[...e.value.keys(),...t.keys()],r=new Set(n);return r.size>=s?a.n:Object(a.o)(r)}default:return a.n}},c=y(new Set,o,u,t),l=Object(i.g)(Object(a.i)(t))(n,c);return Object(r.r)($(o,l,t),l,s)}}}function G(e,t,n){if("inner"===t.kind&&"inner"===n.kind)return e(t.a,n.a);if("bottom"===t.kind)return n;if("bottom"===n.kind)return t;if("top"===t.kind&&"top"===n.kind)return Object(r.o)(Object(i.g)(i.j)(t.error,n.error));if("top"===t.kind)return t;if("top"===n.kind)return n;throw new Error("Non exhaustive match in extend")}function J(e){return(t,n)=>G((t,n)=>Object(r.e)(e(t,n)),t,n)}function H(e,t){return z("join",e,t)}function Q(e,t){return z("delta",e,t)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var r=n(5);class i{track(e){}trackTimeSinceInit(e,t){}startTimer(e,t){return""}stopTimer(e,t){}}class s{constructor(e,t,n){this.sdkInitTimestamp=e,this._internals=t,this.permutive=n,this.sendFrequencyInSeconds=5,this.pendingMetrics=[],this.pendingTimers={},this.permutive.ready(()=>{window.setInterval(this.processPending.bind(this),1e3*this.sendFrequencyInSeconds),Object(r.n)(()=>{this.processPending.bind(this)},navigator.userAgent)}),this.track({name:"sdk_initialisation_start_time_seconds",value:e/1e3,labels:{}})}track(e){this.pendingMetrics.push(e)}trackTimeSinceInit(e,t){const n=performance.now();this.track({name:e,value:(n-this.sdkInitTimestamp)/1e3,labels:t})}startTimer(e,t){const n=performance.now(),r=this.generateRandomKey(e);return this.pendingTimers[r]={startTime:n,labels:t},r}stopTimer(e,t){const n=this.pendingTimers[t];if(n){const r=performance.now();this.track({name:e,value:(r-n.startTime)/1e3,labels:n.labels}),delete this.pendingTimers[t]}}processPending(){this.pendingMetrics.length>0&&(this._internals.api.metrics({context:{environment:"web",events_count:this._internals.state.eventsCache.all().length,segments_count:this._internals.queryManager.userSegments.length},items:this.pendingMetrics}),this.pendingMetrics=[])}generateRandomKey(e){return`${e}-${[...Array(24)].map(()=>Math.random().toString(36)[2]).join("")}`}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var r={concat:function(e,t){return 0!==e?e:t},empty:0};function i(e){switch(e){case-1:return 1;case 1:return-1;default:return 0}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));class r{}class i{constructor(){this.replacementMap={}}register(e){this.replacementMap=Object.assign(Object.assign({},this.replacementMap),e.replacementMap)}enrich(e){const t=[{},!0];for(let n=0;n<Object.keys(e[0]).length;n++){const r=Object.keys(e[0])[n],i=e[0][r];switch(!0){case"string"==typeof i&&"$"===i[0]:const[e,n]=this.isPropertyReplaceable(i);t[0][r]=e?n:i,t[1]=!!e&&t[1];break;case null!==i&&"object"==typeof i&&i.constructor===Object:const s=this.enrich([i,t[1]]);t[0][r]=s[0],t[1]=t[1]&&s[1];break;default:t[0][r]=i}}return t}isPropertyReplaceable(e){const t=this.replacementMap[e];return[this.replacementMap.hasOwnProperty(e)&&t!==e,t]}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.config=e,this.clientErrorsSent=0}getEndpointUrl(e,t){return`${this.config.apiProtocol}://${this.config.apiHost}/${t||this.config.apiVersion}${e}`}req(e,t){const n=-1===e.url.indexOf("?")?"?":"&",r=`${e.url}${n}k=${this.config.apiKey}`,i=e.method||"GET",s=e.data?JSON.stringify(e.data):"",o=e.contentType?e.contentType:"application/json";if(t&&navigator.sendBeacon){if(navigator.sendBeacon(r,s))return e.success&&e.success(s),Promise.resolve();{const t="Failed to queue beacon";return e.error&&e.error(t),Promise.reject(t)}}return this.ajax({type:i,url:r,contentType:o,dataType:e.dataType?e.dataType:"json",data:s,timeout:this.config.requestTimeout,xhrFields:e.xhrFields}).then(t=>(e.success&&e.success(t),t),t=>{throw e.error&&e.error(t),new Error(t)})}ajax(e){return new Promise((t,n)=>{const r={},i=e.dataType?e.dataType:"json",s=new XMLHttpRequest;var o,a;if(e.contentType&&(o="Content-Type",a=e.contentType,r[o.toLowerCase()]=[o,a]),"binary"===e.dataType&&(s.responseType="arraybuffer"),s.onload=function(){const e=s.getResponseHeader("content-type");if(this.status>=400){const e="text"===this.responseType||""===this.responseType?this.responseText:"Couldn't access response text";n(`Failed ajax request. Status code was ${this.status}. ${e}`)}else if("application/octet-stream"===e){const e=this.responseText?JSON.parse(window.atob(this.responseText)):null;t(e)}else if("json"===i){const e=this.responseText?JSON.parse(this.responseText):null;t(e)}else t("text"===i?this.responseText:this.response)},s.onerror=()=>{this.error("Failed AJAX request"),n(new TypeError("Network request failed"))},s.ontimeout=()=>{this.error("AJAX request timed out"),n(new TypeError("Network request timed out"))},s.open(e.type?e.type:"GET",e.url,!0),e.timeout&&(s.timeout=e.timeout),e.xhrFields)for(const t in e.xhrFields)s[t]=e.xhrFields[t];Object.keys(r).forEach(e=>{const t=r[e];s.setRequestHeader(t[0],t[1])}),s.send(e.data?e.data:null)})}error(e,t){if(this.config.sendClientErrors){if(this.clientErrorsSent>3)return;this.clientErrorsSent+=1;const n={user_id:t||"",domain:window.location.hostname?window.location.hostname:"",url:window.location.href?window.location.href:"",referrer:document.referrer?document.referrer:"",user_agent:navigator.userAgent?navigator.userAgent:"",error_message:"",stack_trace:"",additional_details:""};e instanceof Error?(void 0!==e.message&&(n.error_message=e.message.toString()),void 0!==e.stack&&(n.stack_trace=e.stack.toString())):n.additional_details=e.toString(),this.req({url:this.getEndpointUrl("/internal/errors"),method:"POST",data:n,contentType:"text/plain",dataType:"text"},!1)}else window.console&&(window.console.error?window.console.error("[Permutive]",e):window.console.log&&window.console.log("[Permutive]",e))}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(15);class i{constructor(e,t){this.userId=e,this.aliases=t,this.resource="userIdentify",this.query=()=>{const e=this.aliases.map(({id:e,tag:t,priority:n})=>`{id: "${e}", tag: "${t}", priority: ${n}}`).join(",");return Object(r.b)("e488cdb0-e7cb-4d91-9648-60d437d8e491",this.aliases.map(e=>e.id),window.location.hostname,this.userId)?"":`\n      userIdentify: user(user_id: "${this.userId}") {\n        identity(aliases: [${e}]) {\n          identify {\n            id\n          }\n        }\n      }\n    `}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(5);const i={default:{environment:"default",apiHost:"api.permutive.com",apiKey:"",cdnBaseUrl:"cdn.permutive.com",apiVersion:"v2.0",apiProtocol:"https",loggingEnabled:!1,requestTimeout:5e3,cookieDomain:"."+function(e){const t=e.match(/\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/),n=e.match(/[a-z0-9][a-z0-9-]+\.[a-z.]{2,24}$/i),r=e.match(/localhost/);if((null==n?void 0:n.length)>0){const t=e.split(".").reverse();return t.length>=3&&t[1].match(/^(com|edu|gov|net|mil|org|nom|co|ac|name|info|biz)$/i)?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]}return(null==t?void 0:t.length)>0?t[0]:(null==r?void 0:r.length)>0?"localhost":""}(window.location.hostname),cookieName:"permutive-id",cookieExpiry:function(){const e=new Date;return e.setFullYear(e.getFullYear()+3),e.toUTCString()}(),permutiveDataKey:"permutive-data",stateNamespace:"",sendClientErrors:!0,metricsSamplingPercentage:20,eventsCacheLimitBytes:25e5,segmentSyncApiHost:"e488cdb0-e7cb-4d91-9648-60d437d8e491.partner.permutive.app",consentRequired:!1},production:{},development:{apiProtocol:"http",loggingEnabled:!0,sendClientErrors:!1}};const s=e=>Object(r.k)(i.default,i[e.environment]||{},e)},function(e,t,n){"use strict";var r=window.URL||window.webkitURL;e.exports=function(e,t,n,i){try{try{var s;try{s=new window.Blob([e])}catch(t){(s=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),s=s.getBlob()}var o=r.createObjectURL(s),a=new window[t](o,n);return r.revokeObjectURL(o),a}catch(r){return new window[t]("data:application/javascript,".concat(encodeURIComponent(e)),n)}}catch(e){if(!i)throw Error("Inline worker is not supported");return new window[t](i,n)}}},function(e,t,n){"use strict";var r=0;function i(e,t){var n=t.data;if(Array.isArray(n)&&!(n.length<2)){var r=n[0],i=n[1],s=n[2],o=e._callbacks[r];o&&(delete e._callbacks[r],o(i,s))}}function s(e){var t=this;t._worker=e,t._callbacks={},e.addEventListener("message",(function(e){i(t,e)}))}s.prototype.postMessage=function(e){var t=this,n=r++,s=[n,e];return new Promise((function(e,r){if(t._callbacks[n]=function(t,n){if(t)return r(new Error(t.message));e(n)},void 0!==t._worker.controller){var o=new MessageChannel;o.port1.onmessage=function(e){i(t,e)},t._worker.controller.postMessage(s,[o.port2])}else t._worker.postMessage(s)}))},e.exports=s},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(3),i=n(6),s=n(16),o=n(14),a=n(2),u=n(5),c=n(13),l=n(4);class d{constructor(e){this._internals=e,this.fetchedUnseenState=!1,this.stateOffset=this._internals.state.getPermutiveData("state_offset")||0,this.lastSentStateMap=Object(c.f)(this._internals.state.getPermutiveData("internal_query_states")||{})}sync(e,t=this._internals.queryManager.stateMap.value,n=this.stateOffset,u=!this.fetchedUnseenState){const l=Object(i.a)(Object(c.f)(t),o.a,Object(r.j)(e=>Object(a.l)(new Map))),d=Object(i.a)(Object(o.a)(this.lastSentStateMap),Object(r.j)(e=>Object(a.l)(new Map))),f=Object(i.a)(Object(s.a)(l,d),e=>Object(o.b)(e))||{};return u||Object.keys(f).length>0?(()=>this._internals.api.state(f,n,e,u).then(e=>this.isStateResponse(e)?this.handleStateResponse(e):{},e=>(this._internals.network.error(e,this._internals.state.userId),{})).then(e=>(this.fetchedUnseenState=!0,this.lastSentStateMap=Object(c.f)(this._internals.queryManager.stateMap.value),e)))():Promise.resolve({})}resetSync(){return Promise.all([this.sync(!1,{},0,!0),this._internals.thirdParty.segments(),this._internals.models.getModels()]).then(([e,t,n])=>this._internals.queryManager.bootstrap([]).then(e=>this._internals.queryManager.updateEnvironment({segments:Object(u.k)({"1p":this._internals.queryManager.userSegmentsMap},t),lookalikeModels:n})))}reset(){this.lastSentStateMap={}}handleStateResponse(e){const t=Object(r.t)(()=>JSON.parse(e.state),e=>this._internals.network.error("Failed to parse State API response, got "+e,this._internals.state.userId)),n=e=>e?this._internals.queryManager.updateExternalState(e):Object(l.c)();return Object(r.n)(t)?Object(i.a)(e.state_offset,e=>this.stateOffset=e,e=>this._internals.state.setPermutiveData("state_offset",e),e=>n(t.right),e=>t.right):{}}isStateResponse(e){return!!e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.userId=e,this.resource="outOfSdkUserEvents",this.query=()=>`\n    outOfSdkUserEvents: user(user_id: "${this.userId}") {\n      out_of_sdk_events {\n          id\n          name\n          time\n          session_id\n          view_id\n          properties\n        }\n      }\n    `}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(4);function i(e,t,n){return function(r){for(var s=Array(n.length+1),o=0;o<n.length;o++)s[o]=n[o];return s[n.length]=r,0===t?e.apply(null,s):i(e,t-1,s)}}var s={1:function(e){return[e]},2:function(e){return function(t){return[e,t]}},3:function(e){return function(t){return function(n){return[e,t,n]}}},4:function(e){return function(t){return function(n){return function(r){return[e,t,n,r]}}}},5:function(e){return function(t){return function(n){return function(r){return function(i){return[e,t,n,r,i]}}}}}};function o(e){return s.hasOwnProperty(e)||(s[e]=i(r.g,e-1,[])),s[e]}function a(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=t.length,i=o(r),s=e.map(t[0],i),a=1;a<r;a++)s=e.ap(s,t[a]);return s}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return L}));class r{constructor(e,t,n,r,i,s,o){this.permutive=e,this._internals=t,this.id=n,this.segmentCode=r,this.triggerType=i,this.config=s,this.workspaceLevelConfig=o}activateEveryTime(){return"EveryTime"===this.triggerType}activateOnEntry(){return"OnEntry"===this.triggerType}activateOnExit(){return"OnExit"===this.triggerType}trackImpression(e){const t={reaction_id:this.id,type:"impression"};this.permutive.track("Reaction",t,e),this._internals.log("impression: ",t)}trackConversion(e){const t={reaction_id:this.id,type:"conversion"};this.permutive.track("Reaction",t,e),this._internals.log("conversion: ",t)}}class i{constructor(e,t,n){this._internals=e,this.permutive=t,this.context=n,this.addons={overlays:{workspaces:[{activations:[]}],auto_init:!0,activationConfigs:[]},web:{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]},scriptrunner:{workspaces:[{activations:[]}],auto_init:!0,activationConfigs:[]},dfp:{workspaces:[{activations:[],networks:[{name:"BBC.COM - World - DFP EMEA",network_code:"4817"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0}],auto_init:!0,networks:[{name:"BBC.COM - World - DFP EMEA",network_code:"4817"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,activationConfigs:[]}},this.optimisedActivationsConfig={dfp:{dfp:[40294,40292,40289,40285,40286],dfp_legacy:{}},eyeota_pixel:[],dbm:{omitted:0},appnexus:{},appnexus_adserver:[],nativo:[]}}getSpecializedActivations(e){return this.optimisedActivationsConfig[e]}getActivations(e){return(this.addons[e]?this.addons[e].activationConfigs:[]).filter(e=>this.areContextCriteriaSatisfied(e)).map(e=>new r(this.permutive,this._internals,e.id,e.segment_code,e.trigger_type,e.config,e.workspaceLevelConfig))}areContextCriteriaSatisfied(e){const t=e.context_criteria,n=e=>{const t=this.context[e.key];switch(e.comparison){case"EQUALS":return t===e.value;case"NOT_EQUALS":return t!==e.value;case"CONTAINS":return"string"==typeof t&&t.indexOf(e.value)>=0;case"NOT_CONTAINS":return"string"==typeof t&&t.indexOf(e.value)<0}};return!t||("AND"===(r=t).operator?r.criteria.every(n):r.criteria.some(n));var r}}var s=n(12),o=n(3),a=n(0),u=n(9),c=n(6);class l{constructor(e){this._internals=e}put(e,t){return Object(c.a)(this._internals.getNamespacedStorageKey(String(t)),t=>window.localStorage.setItem(t,JSON.stringify(e)),e=>Promise.resolve(t))}get(e){return Object(c.a)(this._internals.getNamespacedStorageKey(String(e)),e=>JSON.parse(window.localStorage.getItem(e)),e=>Promise.resolve(e))}delete(e){return Object(c.a)(this._internals.getNamespacedStorageKey(String(e)),e=>Promise.resolve(window.localStorage.removeItem(e)))}deleteStore(){return Promise.resolve()}migrateIfRequired(){return Promise.resolve()}}let d,f;const _=new WeakMap,h=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap;let b={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return O(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(w(this),t),O(_.get(this))}:function(...t){return O(e.apply(w(this),t))}:function(t,...n){const r=e.call(w(this),t,...n);return p.set(r,t.sort?t.sort():[t]),O(r)}}function y(e){return"function"==typeof e?v(e):(e instanceof IDBTransaction&&function(e){if(h.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});h.set(e,t)}(e),t=e,(d||(d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,b):e);var t}function O(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(O(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&_.set(t,e)}).catch(()=>{}),g.set(t,e),t}(e);if(m.has(e))return m.get(e);const t=y(e);return t!==e&&(m.set(e,t),g.set(t,e)),t}const w=e=>g.get(e);function k(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=O(o);return r&&o.addEventListener("upgradeneeded",e=>{r(O(o.result),e.oldVersion,e.newVersion,O(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}const j=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],M=new Map;function S(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(M.get(t))return M.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!j.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;r&&(o=o.index(t.shift()));const a=await o[n](...t);return i&&await s.done,a};return M.set(t,s),s}b=(e=>({...e,get:(t,n,r)=>S(t,n)||e.get(t,n,r),has:(t,n)=>!!S(t,n)||e.has(t,n)}))(b);var P=n(7),I=n(5);class T{constructor(e,t,n,r,i,s){this._internals=e,this.cryptoAlg=t,this.idb=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=s,this.MAX_CONSECUTIVE_PUTS=30,this.puts=1,this.cryptoKey=this.getOrGenerateKey()}static initialise(e,t,n,r,i,s,a){const c=["development"===e.config.environment?window.isSecureContext:"https:"===window.location.protocol,!(Object(I.g)(navigator.userAgent)&&["f036e56c-2514-4246-bf83-1659326fe3f8"].indexOf("e488cdb0-e7cb-4d91-9648-60d437d8e491")>-1)].every(e=>!0===e)?Object(o.t)(()=>k(n,a,{upgrade:e=>{e.createObjectStore(r),e.createObjectStore(i)}}),e=>String(e)):Object(o.o)("Connection not attempted. Default to localStorage");return Object(o.f)(e=>Object(u.e)(e),n=>Object(u.h)(()=>n.then(n=>new T(e,t,n,r,i,s)),e=>String(e)))(c)}put(e,t){return this.cryptoKey.then(n=>Object(c.a)(JSON.stringify(e),e=>new Promise((r,i)=>{this.cryptoAlg.encrypt(n,e).then(e=>Object(c.a)(this._internals.getNamespacedStorageKey(String(t)),n=>this.resetIfRequired(this.puts++).then(i=>this.idb.put(this.mainObjectStore,e,n).then(e=>r(t)))),e=>i(e))})))}get(e){return this.cryptoKey.then(t=>Object(c.a)(this._internals.getNamespacedStorageKey(String(e)),e=>this.idb.get(this.mainObjectStore,e).then(e=>e?this.cryptoAlg.decrypt(t,e):null).then(JSON.parse)))}delete(e){return Object(c.a)(this._internals.getNamespacedStorageKey(String(e)),e=>this.idb.delete(this.mainObjectStore,e))}migrateIfRequired(){const e=Object(c.a)(this._internals.getExternalData(x),e=>e?Object(u.g)(JSON.parse(e)):Object(u.e)(null)),t=Object(u.h)(()=>this.idb.get("events","permutive-events-cache"),e=>{});return Promise.all([e(),t()]).then(e=>e.filter(o.n).map(e=>e.right).filter(e=>e)).then(P.h).then(e=>Object(c.a)(e,e=>e.forEach(e=>this._internals.state.eventsCache.add(Object(s.a)(e),{persistOnDisk:!1})),e=>this._internals.removeExternalData(x))).then(e=>-1!==[...this.idb.objectStoreNames].indexOf("events")?this.idb.delete("events","permutive-events-cache"):Promise.resolve())}deleteStore(){return Promise.resolve(this.idb.close()).then(e=>function(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),O(n).then(()=>{})}(this.idb.name))}getOrGenerateKey(){return Object(c.a)(this._internals.getNamespacedStorageKey(this.keyObjectKey),e=>this.idb.get(this.keyObjectStore,e).then(e=>e||this.storeGivenOrGeneratedKey()))}storeGivenOrGeneratedKey(e){return(e||this.cryptoAlg.generateKey(!1)).then(e=>Object(c.a)(this._internals.getNamespacedStorageKey(this.keyObjectKey),t=>this.idb.put(this.keyObjectStore,e,t),t=>e),e=>Promise.reject(e))}resetIfRequired(e){const t=this.idb.name,n=this.idb.version;return Object(I.g)(navigator.userAgent)&&e%this.MAX_CONSECUTIVE_PUTS==0?this.deleteStore().then(e=>k(t,n,{upgrade:e=>{e.createObjectStore(this.mainObjectStore),e.createObjectStore(this.keyObjectStore)}})).then(e=>{this.idb=e,this.storeGivenOrGeneratedKey(this.cryptoKey)}):Promise.resolve()}}class C{constructor(e,t,n,r,i,s,a){this._internals=e,this.cryptoAlg=t,this.dbName=n,this.mainObjectStore=r,this.keyObjectStore=i,this.keyObjectKey=s,this.version=a,this.db=T.initialise(this._internals,this.cryptoAlg,this.dbName,this.mainObjectStore,this.keyObjectStore,this.keyObjectKey,this.version)().then(Object(o.j)(e=>new l(this._internals)))}put(e,t){return Object(u.h)(()=>this.db.then(n=>n.put(e,t)),e=>String(e))}get(e){return Object(u.h)(()=>this.db.then(t=>t.get(e)).then(a.d),e=>String(e))}delete(e){return Object(u.h)(()=>this.db.then(t=>t.delete(e)),e=>String(e))}deleteStore(){return Object(u.h)(()=>this.db.then(e=>e.deleteStore()),e=>String(e))}migrateIfRequired(){return Object(u.h)(()=>this.db.then(e=>e.migrateIfRequired()),e=>String(e))}}class D{constructor(){this.crypto=window.crypto||window.msCrypto,this.ALG_NAME="AES-GCM"}generateKey(e=!1){return this.crypto.subtle.generateKey({name:this.ALG_NAME,length:256},e,["encrypt","decrypt"])}encrypt(e,t){const[n,r]=this._encrypt(e,this.str2bytes(t));return n.then(e=>{const t=new Uint8Array(16+e.byteLength);return t.set(r,0),t.set(new Uint8Array(Uint32Array.of(e.byteLength).buffer),12),t.set(new Uint8Array(e),16),t.buffer})}decrypt(e,t){const n=new Uint8Array(t,0,12),r=new Uint32Array(t,12,1)[0],i=t.slice(16,16+r);return this._decrypt(e,n,i).then(this.bytes2str)}_encrypt(e,t){const n=this.crypto.getRandomValues(new Uint8Array(12));return[this.crypto.subtle.encrypt({name:this.ALG_NAME,iv:n},e,t),n]}_decrypt(e,t,n){return this.crypto.subtle.decrypt({name:this.ALG_NAME,iv:t},e,n)}str2bytes(e){return(new TextEncoder).encode(e).buffer}bytes2str(e){return(new TextDecoder).decode(e)}}var A=n(4);const x="permutive-events-cache";class q{constructor(e,t){this.state=e,this._internals=t,this.EVENTS_CACHE_OBJECT_STORE="events",this.CRYPTO_KEY_OBJECT_STORE="keys",this.CRYPTO_KEY_OBJECT_KEY="events",this.eventPutQueue=Promise.resolve(),this.eventsCache=[],this.eventCacheSizeInBytes=0,this.eventStore=new C(this._internals,new D,"e488cdb0-e7cb-4d91-9648-60d437d8e491",`${this.EVENTS_CACHE_OBJECT_STORE}_${this.state.userId}`,`${this.CRYPTO_KEY_OBJECT_STORE}_${this.state.userId}`,this.CRYPTO_KEY_OBJECT_KEY,2)}all(){return this.eventsCache}add(e,t){const{persistOnDisk:n}=t;return Object(c.a)(this.eventsCache.push(e),e=>n?this.flush():Object(A.c)(),t=>e)}loadFromDisk(){const e=[];return this.eventStore.migrateIfRequired()().then(Object(o.f)(t=>(this._internals.network.error("Failed to migrate events cache. Got "+JSON.stringify(t)),this.reset().then(t=>e)),()=>{const t=this._internals.metrics.startTimer("sdk_load_events_cache_task_duration_seconds",{});return this.eventStore.get(x)().then(n=>{this._internals.metrics.stopTimer("sdk_load_events_cache_task_duration_seconds",t);const r=Object(a.b)(()=>Promise.resolve(e),e=>Object(c.a)(this.eventCacheSizeInBytes=2*JSON.stringify(e).length,t=>{this._internals.metrics.track({name:"sdk_events_cache_byte_total",value:this.eventCacheSizeInBytes,labels:{}}),this._internals.metrics.track({name:"sdk_events_cache_size_total",value:e.length,labels:{}})},t=>e.map(e=>this.deserializeAndAdd(e,{persistOnDisk:!1})),e=>Promise.resolve(e)));return Object(o.f)(t=>(this._internals.network.error("Error fetching data from store. Got "+t),this.reset().then(t=>e)),r)(n)})}))}processUnseenEvents(e){this._internals.log("Got out-of-SDK events from the API",e);const t=Object(c.a)(e,e=>e.map(e=>this.deserializeAndAdd(e,{persistOnDisk:!1}))),n=t.length>0?this.flush.bind(this):A.c;return Object(c.a)(n(),e=>t)}reset(){return this._internals.log("Resetting Events Cache"),this.eventsCache=[],this.eventCacheSizeInBytes=0,this.eventStore.deleteStore()().then(()=>(this.eventStore=new C(this._internals,new D,"e488cdb0-e7cb-4d91-9648-60d437d8e491",`${this.EVENTS_CACHE_OBJECT_STORE}_${this.state.userId}`,`${this.CRYPTO_KEY_OBJECT_STORE}_${this.state.userId}`,this.CRYPTO_KEY_OBJECT_KEY,2),this.flush()))}flush(){let e=JSON.stringify(this.eventsCache),t=1;for(;e.length>this._internals.config.eventsCacheLimitBytes/2;)this.eventsCache.splice(0,t),t*=2,e=JSON.stringify(this.eventsCache);this._internals.log("Writing cache (#e)",this.eventsCache.length),this.eventCacheSizeInBytes=2*e.length,this.eventPutQueue=this.eventPutQueue.then(e=>this.eventStore.put(this.eventsCache.map(s.e),x)().then(A.c))}deserializeAndAdd(e,t){const{persistOnDisk:n}=t;return Object(c.a)(e,s.a,e=>this.add(e,{persistOnDisk:n}))}getStateSizeInBytes(){return this.eventCacheSizeInBytes}}class R{constructor(e){this._internals=e,this.queue=[],this.nextNotify=null,e.messages.on("permutive:taskQueue:update",()=>{this.execute()})}add(e){this.queue.push(e),this.notify()}notify(){const e=()=>{this._internals.messages.emit("permutive:taskQueue:update")},t=(new Date).getTime();null===this.nextNotify||this.nextNotify<t-50?(this.nextNotify=t,e()):this.nextNotify<=t&&(this.nextNotify=t+50,window.setTimeout(e,50))}execute(){if(0===this.queue.length)return;let e=!1,t=!1,n=0;for(let r=0;r<this.queue.length;r++){const i=this.queue[r];if(i.complete)n+=1;else if(i.started)t=!0,e=e||i.blocks();else{if(i.waits()&&t)break;e||(t=!0,e=e||i.blocks(),i.execute(()=>{this.notify()}))}}this.queue.splice(0,n)}size(){return this.queue.length}}class L{constructor(e,t,n){this._internals=e,this.permutive=t,this.context=n,this.taskQueue=new R(this._internals);const r=this._internals.getNamespacedStorageKey(e.config.permutiveDataKey),s=localStorage.getItem(r);this.permutiveDataByteSize=null===s?0:2*s.length,this.permutiveData=null===s?{}:JSON.parse(s);const o=Object(a.h)(()=>Object(a.h)(I.o)(this.getUserIdFromLocalStorage()))(this.getUserIdFromCookie());this.setUserId(o),this.viewId=Object(I.o)(),this.context.view_id=this.viewId,this.eventSourceId=this.getPermutiveData("event-source-id")||this.generateAndStoreEventSourceId(),this.eventsCache=new q(this,this._internals),this.activationManager=new i(this._internals,this.permutive,this.context)}setUserId(e){this._internals.setCookie(this._internals.config.cookieName,e,!0),this._internals.setExternalData(this._internals.config.cookieName,e),this.userId=e}getPermutiveData(e){return this.permutiveData[e]}setPermutiveData(e,t){this.permutiveData[e]=t;const n=this._internals.getNamespacedStorageKey(this._internals.config.permutiveDataKey),r=JSON.stringify(this.permutiveData);this.permutiveDataByteSize=2*r.length,this._internals.makeSafe(()=>{localStorage.setItem(n,r)})()}getClient(){let e="";return e=document.title?document.title:"",{type:"web",user_agent:navigator.userAgent||"",url:window.location.href||"",domain:window.location.hostname||"",title:e,referrer:document.referrer||""}}getStateSizeInBytes(){return this.permutiveDataByteSize+this.eventsCache.getStateSizeInBytes()}reset(){return this._internals.log("Resetting State"),Promise.resolve(Object(c.a)(this._internals.deleteCookie(this._internals.config.cookieName),e=>this._internals.removeExternalData(this._internals.config.cookieName),e=>this._internals.queryManager.reset(),e=>this.permutiveData={},e=>this.permutiveDataByteSize=0,e=>localStorage.removeItem(this._internals.config.permutiveDataKey)))}generateAndStoreEventSourceId(){const e=Object(I.o)();return this.setPermutiveData("event-source-id",e),e}getUserIdFromStorageIfValid(e){const t=Object(a.e)(I.h);return Object(c.a)("cookie"===e?this._internals.getCookie(this._internals.config.cookieName):this._internals.getExternalData(this._internals.config.cookieName),a.d,Object(a.a)(t))}getUserIdFromCookie(){return this.getUserIdFromStorageIfValid("cookie")}getUserIdFromLocalStorage(){return this.getUserIdFromStorageIfValid("localStorage")}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(5);class i{constructor(e,t){this._internals=e,(t=t||{}).timeout_seconds=t.timeout_seconds||1800,t.session_data_key=t.session_data_key||"permutive-session",this.options=t,this.session_id=null,this.initialize()}getSessionId(){return this.session_id}newSession(e){return{session_id:Object(r.o)(),last_updated:e}}initialize(){const e=new Date,t=this._internals.getCookie(this.options.session_data_key);let n=this.decodeSessionData(t);if(null===n)n=this.newSession(e);else{const t=this.options.timeout_seconds;e>new Date(n.last_updated.getTime()+1e3*t)?n=this.newSession(e):n.last_updated=e}this.persistSessionData(n),this.session_id=n.session_id}decodeSessionData(e){let t=null;try{t=JSON.parse(e)}catch(e){return null}return null!==t&&"object"==typeof t&&t.hasOwnProperty("session_id")&&t.hasOwnProperty("last_updated")&&(t.last_updated=new Date(t.last_updated),!isNaN(t.last_updated.getTime()))?t:null}persistSessionData(e){e.last_updated=e.last_updated.toISOString(),this._internals.setCookie(this.options.session_data_key,JSON.stringify(e))}}const s={success:e=>{},error:(e,t)=>{}};class o{constructor(e){this._internals=e}graphql(e,t=s){return this._internals.network.req({url:`${this._internals.config.apiProtocol}://${this._internals.config.apiHost}/graphql`,method:"POST",success:t.success,error:t.error,data:{query:e},contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)}identify(e,t=s){const n=this._internals.identities.aliasMapToPrioritizedList(this._internals.identities.aliases);return this._internals.network.req({url:this._internals.network.getEndpointUrl("/identify"),method:"POST",data:{user_id:this._internals.state.userId,aliases:n.concat(e.map(e=>Object.assign(Object.assign({},e),{priority:0})))},success:t.success,error:t.error,contentType:"text/plain",xhrFields:{withCredentials:!0}},!1)}metrics(e,t=s){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/internal/metrics"),method:"POST",data:e,contentType:"text/plain",dataType:"text",success:t.success,error:t.error},!1)}track(e,t,n){return this._internals.network.req({url:[""+this._internals.network.getEndpointUrl((Array.isArray(e)?"/batch":"")+"/events"),"?enrich="+!!t.includeResponseBody,"&sdkp="+!n].join(""),method:"POST",data:e,success:t.success,error:t.error,contentType:"text/plain"},n)}tpdUsage(e,t=s){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/tpd/usage"),method:"POST",data:e,success:t.success,error:t.error,contentType:"text/plain"},!1)}reset(){return this._internals.network.req({url:this._internals.network.getEndpointUrl("/reset"),method:"POST",xhrFields:{withCredentials:!0},contentType:"text/plain"},!1)}segmentSync(e,t){return this._internals.network.ajax({url:`https://${this._internals.config.segmentSyncApiHost}/sync/${e}`,type:"POST",data:"value="+encodeURIComponent(t),contentType:"application/x-www-form-urlencoded",xhrFields:{withCredentials:!0}})}models(e){const t="binary"===e?"bin":"json";return this._internals.network.ajax({url:`https://${this._internals.config.cdnBaseUrl}/models/e488cdb0-e7cb-4d91-9648-60d437d8e491-models.${t}`,dataType:e})}state(e,t,n,r,i=!1){return this._internals.network.req({url:`${this._internals.network.getEndpointUrl(""+(i?"/state/legacy":"/state"),"v1.0")}?fetch_unseen=${r}`,method:"POST",data:{group_id:this._internals.state.userId,event_source_id:this._internals.state.eventSourceId,state:JSON.stringify(e),last_seen_offset:t},contentType:"text/plain"},n)}migrateOutOfSDKEvents(e,t,n=s){return this._internals.network.req({url:`${this._internals.network.getEndpointUrl("/out-of-sdk-events/delete")}?user_id=${e}`,method:"POST",data:t,success:n.success,error:n.error,contentType:"text/plain"},!1)}inferDemographicSegments(e,t=s){return this._internals.network.req({url:""+this._internals.network.getEndpointUrl("/demographic/infer"),method:"POST",contentType:"text/plain",data:e,success:t.success,error:t.error},!1)}}class a{constructor(){this.promises={}}addPromise(e,t,n,r){e in this.promises||(this.promises[e]={}),this.promises[e][t]=r,window.setTimeout(()=>{this.resolvePromise(e,t)},n)}createPromise(e,t,n){this.addPromise(e,t,n,Object(r.b)())}getPromise(e,t){return Object(r.i)(this.promises,e,t)}resolvePromise(e,t){const n=this.getPromise(e,t);return void 0!==n?(n.resolve(),n):void 0}getPromisesByCategory(e){const t=Object(r.i)(this.promises,e)||{};return Object.keys(t).map(e=>t[e])}}var u=n(19);class c{constructor(e){this._internals=e,this.queries={},this.promises={}}register(e){const t=Object(r.b)();return this.queries[e.resource]=e.query(),this.promises[e.resource]=t,t.promise}run(){if(0===Object.keys(this.queries).length)return Promise.resolve();const e=Object(r.b)();return this._internals.api.graphql(this.toQueryString(this.queries),{success:t=>{Object.keys(this.promises).forEach(e=>{const n=t.data[e];n?this.promises[e].resolve(n):this.promises[e].reject("Could not find a graphql response for resource "+e)}),e.resolve()},error:t=>{console.error(t),Object.keys(this.promises).forEach(e=>this.promises[e].reject()),e.reject()}}),e.promise}toQueryString(e){return`{ ${Object.keys(e).map(t=>e[t]).join(" ")} }`}}class l{constructor(){this.events=[],this.listeners=[]}newEvent(e,t){this.events.push([e,t]),this.listeners.forEach(n=>{this.handle(e,t,n)})}addListener(e){this.listeners.push(e);const t={replay:()=>(this.replay(e),t),remove:()=>(this.remove(e),t)};return t}handle(e,t,n){const r="string"==typeof n.name&&e.name===n.name,i=n.name.test&&n.name.test(e.name),s=r||i;if(s)try{n.callback(e,t)}catch(e){window.console&&window.console.error&&window.console.error("callback error: ",e)}s&&n.once&&this.remove(n)}replay(e){let t=-1!==this.listeners.indexOf(e);for(let n=0;n<this.events.length&&t;n++)this.handle(this.events[n][0],this.events[n][1],e),t=-1!==this.listeners.indexOf(e)}remove(e){const t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}}function d(e){var t={},n=[];(e=e||this).on=function(n,r,i){return(t[n]=t[n]||[]).push([r,i]),e},e.off=function(r,i){r||(t={});for(var s=t[r]||n,o=s.length=i?s.length:0;o--;)i==s[o][0]&&s.splice(o,1);return e},e.once=function(t,r){var i=n.slice.call(arguments,2),s=function(){r(i),e.off(t,s)};return e.on(t,s),e},e.emit=function(r){for(var i,s=t[r]||n,o=s.length>0?s.slice(0,s.length):s,a=0;i=o[a++];)i[0].apply(i[1],n.slice.call(arguments,1));return e}}var f=n(12);class _{constructor(e){this._internals=e,this.timeoutDuration=500,this.maxWaitTime=5e3,this.requests=[],setInterval(()=>{this.requests.length>0&&this.flush()},this.maxWaitTime),Object(r.n)(()=>{this.requests.length>0&&this.flush(!0)},navigator.userAgent)}add(e,t,n){this.resetTimeout(),this.requests.push([e,t,n])}flush(e=!1){const t=[...this.requests];e||this.trackMetrics(t),this._internals.stateSync.sync(e),this._internals.api.track(t.map(e=>e[0]),{},e).then(e=>this.isBatchResponse(e)?this.handleBatchResponse(e,t):null,e=>this._internals.network.error(e)).catch(e=>this._internals.network.error(e)),this.requests=[]}handleBatchResponse(e,t){e.map(e=>e.body).forEach((e,n)=>{const r=t.map(e=>e[0])[n],i=t[n][1],s=t[n][2];Object(f.c)(e)?this.handleTrackError(e,r,i.error):this.handleTrackResponse(e,r,i.success,s)})}handleTrackResponse(e,t,n,r){const i=Object(f.b)(e,t);n(i),"never"!==r&&(this._internals.state.eventsCache.add(i,{persistOnDisk:!0}),this._internals.eventHandler.newEvent(Object(f.e)(i),null))}handleTrackError(e,t,n){const r={name:t.name,session_id:t.session_id,view_id:t.view_id,properties:t.properties,id:null,time:(new Date).toISOString()};n(e.error.message),this._internals.eventHandler.newEvent(r,e),console.error(e)}setTimeout(e){return window.setTimeout(()=>this.flush(),e)}resetTimeout(){clearTimeout(this.timeout),this.timeout=this.setTimeout(this.timeoutDuration)}trackMetrics(e){this._internals.metrics.track({name:"sdk_events_batch_size_total",value:e.length,labels:{}}),this._internals.metrics.track({name:"sdk_events_batch_size_bytes",value:2*JSON.stringify(e.map(e=>e[0])).length,labels:{}})}isBatchResponse(e){return!!e}}class h{constructor(e,t,n=[],r={},s=new l,f=new a,h=new d,p=new u.a){this.config=e,this.network=t,this.blockers=n,this.addons=r,this.eventHandler=s,this.promises=f,this.messages=h,this.enrichers=p,this.isReady=!1,this.isRealtime=!1,this.listenForBlockers=!0,this.sessionManager=new i(this),this.eventsBatch=new _(this),this.api=new o(this),this.graphql=new c(this),this.models={getModels:()=>Promise.resolve({})}}makeSafe(e){return(...t)=>{try{return e(...t)}catch(e){this.network.error(e,this.state.userId)}}}utcNow(){const e=new Date;return new Date(e.toUTCString())}log(...e){this.config.loggingEnabled&&window.console&&window.console.log&&(e.splice(0,0,"[Permutive]"),console.log(...e))}setAsReady(){this.isReady=!0,this.metrics.trackTimeSinceInit("sdk_initialisation_task_duration_seconds",{sdk_version:"v13.0.0-RC.19"}),window.performance&&window.performance.memory&&(this.metrics.track({name:"sdk_heap_memory_bytes_used",value:window.performance.memory.usedJSHeapSize,labels:{}}),this.metrics.track({name:"sdk_heap_memory_limit_fraction_used",value:window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit,labels:{}})),this.messages.emit("permutive:ready")}setAsRealtime(){this.isRealtime=!0,this.metrics.trackTimeSinceInit("sdk_realtime_targeting_set_task_duration_seconds",{})}addBlocker(e){this.blockers.push(e),this.log("<blockers> added blocker "+e),this.messages.on(e,()=>{if(this.listenForBlockers){const t=this.blockers.indexOf(e);t>=0&&(this.blockers.splice(t,1),this.log("<blockers> removed blocker "+e)),0===this.blockers.length&&(this.listenForBlockers=!1,this.messages.emit("permutive:blockers:empty"),this.log("<blockers> complete"))}})}getNamespacedStorageKey(e){return`${this.config.stateNamespace}${e}`}setCookie(e,t,n=!1){if(!(t&&e&&this.config.cookieExpiry&&this.config.cookieDomain))return!1;const r=this.getNamespacedStorageKey(e);document.cookie=[encodeURIComponent(r),"=",encodeURIComponent(t),"; expires=",this.config.cookieExpiry,"; domain=",this.config.cookieDomain,"; path=/",n?"; samesite=none; secure":""].join("")}getCookie(e,t=!1){const n=t?e:this.getNamespacedStorageKey(e),r=new RegExp(encodeURIComponent(n)+"=([^;]+)").exec(document.cookie);return null!==r?decodeURIComponent(r[1]):null}deleteCookie(e){if(!e||!this.config.cookieDomain)return!1;const t=this.getNamespacedStorageKey(e);return document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+this.config.cookieDomain+"; path=/",!0}getExternalData(e){const t=this.getNamespacedStorageKey(e);return localStorage.getItem(t)}setExternalData(e,t){const n=this.getNamespacedStorageKey(e);this.makeSafe(()=>{localStorage.setItem(n,t)})()}removeExternalData(e){const t=this.getNamespacedStorageKey(e);localStorage.removeItem(t)}arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(5),i=n(15);class s{constructor(e,t={}){this.wait_prev=t.wait_prev||!1,this.block_next=t.block_next||!1,this.description=t.description||"",this.started=!1,this.complete=!1,this.task=e}waits(){return this.wait_prev}blocks(){return this.block_next}execute(e){this.started=!0,this.task(()=>{this.complete=!0,e()})}}var o=n(12),a=n(6),u=n(0);const c=(e,t)=>new Promise(n=>{e(t,2,e=>{n(e)})}),l={tradedesk:21,ddp:755,appnexus:32,pubmatic:76,lotame:95};var d=n(4);class f{constructor(e,t,n){this._internals=e,this.network=t,this.context=n,this.initialisedAddons=[]}identify(e){this._internals.log("<call> identify",e);const t=this._internals.identities.getAliasesFromIdentifyArg(e),n=Object(r.b)(),o=t.map(e=>e.id).concat(Object.entries(this._internals.identities.aliases).map(e=>e[1]));if("string"==typeof e&&Object(i.b)("e488cdb0-e7cb-4d91-9648-60d437d8e491",o,window.location.hostname,this._internals.state.userId))return n.resolve(),n.promise;return this._internals.state.taskQueue.add(new s(e=>{this._internals.log("<task> identify ",t);const r=this._internals.state.userId;this._internals.api.identify(t).then(i=>i.user_id===r?Object(a.a)(this._internals.log("<done> identify ",t),t=>e(),e=>n.resolve()):this._internals.state.reset().then(e=>Object(a.a)(this._internals.state.setUserId(i.user_id),e=>this._internals.state.eventsCache.reset(),e=>this._internals.stateSync.resetSync())).then(r=>{this._internals.log("<done> identify",t),e(),n.resolve()})).then(e=>t.forEach(e=>this._internals.identities.setAlias(e.id,e.tag)))},{wait_prev:!0,block_next:!0})),n.promise}on(e,t){return this._internals.eventHandler.addListener({name:e,callback:t,once:!1})}once(e,t){return this._internals.eventHandler.addListener({name:e,callback:t,once:!0})}track(...e){const[t,n,i]=[e[0],e[1]||{},e[2]||{}];this._internals.log("<call> track",t);const a=Object(r.b)();if(!this._internals.api)return this.network.error("The API hasn't been loaded."),a.reject(),a.promise;const u=!!i.isAnalyticsOnly,c=this._internals.sessionManager.getSessionId(),l=this._internals.state.viewId,d={success:i.success||(e=>{}),error:i.error||((e,t)=>{})};return this._internals.state.taskQueue.add(new s(e=>{this._internals.log("<task> track",t);const s=u?null:this._internals.metrics.startTimer("sdk_events_api_roundtrip_seconds",{}),f=u?null:this._internals.metrics.startTimer("sdk_events_overall_processing_seconds",{}),[_,h]=this._internals.enrichers.enrich([n,!0]);this._internals.metrics.track({name:h?"sdk_event_enrichment_success_count":"sdk_event_enrichment_fail_count",value:1,labels:{}});const p=Object.assign(Object.assign({},_),{client:this._internals.state.getClient()}),m=function(e,t){return e.isMemoryOnly?"memoryOnly":e.useBeacon?"deferred":e.isAnalyticsOnly?"never":t?"immediate":"onResponse"}(i,h),g={user_id:this._internals.state.userId,name:t,segments:this._internals.queryManager.userSegments,properties:p,session_id:c,view_id:l},b={name:t,properties:p,session_id:c,view_id:l,time:new Date},v=e=>{const t=this._internals.metrics.startTimer("sdk_events_querylanguage_seconds",{});return this._internals.queryManager.process([e]).then(()=>{this._internals.metrics.stopTimer("sdk_events_querylanguage_seconds",t),this._internals.metrics.stopTimer("sdk_events_overall_processing_seconds",f)})},y=e=>(this._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",s),Object(o.c)(e)?O(e):w(e)),O=e=>{this._internals.log("Tracking failed with reason",e);const t={name:g.name,session_id:g.session_id,view_id:g.view_id,properties:g.properties,id:null,time:new Date};return Promise.resolve({event:t,error:e})},w=e=>{const t=Object(o.d)(e)?Object(o.a)(Object.assign(Object.assign({},e),{session_id:g.session_id,view_id:g.view_id})):Object(o.b)(e,g);return Promise.resolve({event:t,error:null})},k=e=>Promise.resolve(e.error?d.error(e.error.error.message):d.success(e.event)),j=e=>(e.error||this._internals.state.eventsCache.add(e.event,{persistOnDisk:!0}),Promise.resolve(e)),E=e=>(this._internals.eventHandler.newEvent(Object(o.e)(e.event),e.error),Promise.resolve(e.event));let M;switch(m){case"immediate":M=Object(r.e)(([e,t])=>Promise.all([v(e),this._internals.eventsBatch.add(t,d,m),Promise.resolve(e)]),([e,t,n])=>Promise.resolve(n));break;case"memoryOnly":M=([e,t])=>v(e).then(t=>e);break;case"onResponse":M=Object(r.e)(([e,t])=>this._internals.api.track(t,{includeResponseBody:!0},!1),e=>y(e),e=>Promise.all([k(e),j(e),v(e.event),E(e)]),([e,t,n,r])=>Promise.resolve(r));break;case"deferred":M=Object(r.e)(([e,t])=>Promise.all([this._internals.api.track(t,{includeResponseBody:!h},!0),Promise.resolve(e)]),([e,t])=>E({event:t,error:null}));break;case"never":M=([e,t])=>(this._internals.eventsBatch.add(t,d,m),Promise.resolve(e))}M([b,g]).then(t=>(a.resolve(t),this._internals.log("<done> track",t.name),e(),Promise.resolve(t))).catch(e=>{this._internals.metrics.stopTimer("sdk_events_api_roundtrip_seconds",s),d.error(e),this.network.error(e,this._internals.state.userId)})})),a.promise}trigger(e,t,n){const i=Object(r.b)();this._internals.log("<call> trigger",e),this._internals.triggerListeners=this._internals.triggerListeners||[];return this._internals.state.taskQueue.add(new s(t=>{this._internals.log("<task> trigger",e);const r=this._internals.messages.on("permutive:query:changed",(function(t){t.queryCode===e&&(n(t.result),i.resolve(t.result))}));this._internals.triggerListeners.push(r),this._internals.log("<done> trigger",e),t()})),i.promise}query(){return Promise.resolve({result:!1})}segment(e,t){const n=Object(r.b)();this._internals.log("<call> segment",e);return this._internals.state.taskQueue.add(new s(r=>{this._internals.log("<task> segment",e);const i=this._internals.queryManager.stateMap.value[e];i&&(t(i.result.result),n.resolve()),this._internals.log("<done> segment",e),r()})),n.promise}segments(e,t="all"){const n=Object(r.b)();this._internals.log("<call> segments");return this._internals.state.taskQueue.add(new s(r=>{this._internals.log("<task> segments ("+t+")");const i=i=>{e(i),n.resolve(i),this._internals.log("<done> segments ("+t+")"),r()};"dfp"===t?this._internals.messages.once("permutive:dfp:ready",()=>{i(this._internals.addons.dfp.liveSegments)}):i(this._internals.queryManager.userSegments)})),n.promise}reset(){return Promise.all([this._internals.api.reset(),this._internals.state.reset(),this._internals.stateSync.reset(),this._internals.queryManager.bootstrap([])]).then(([e])=>{this._internals.state.setUserId(e.id),this._internals.state.eventsCache.reset(),this._internals.messages.emit("permutive:reset")})}addon(e,t){if(-1===this.initialisedAddons.indexOf(e)){this.initialisedAddons.push(e);const r=Object.assign(Object.assign({},t),{_internals:this._internals,permutive:this,network:this.network,context:this.context});switch(e){case"web":Promise.resolve().then(n.bind(null,37)).then(e=>this._internals.addons.web=new e.WebAddon(r));break;case"publishers":0;break;case"overlays":Promise.resolve().then(n.bind(null,35)).then(e=>this._internals.addons.overlays=new e.OverlaysAddon(r));break;case"scriptrunner":Promise.resolve().then(n.bind(null,36)).then(e=>this._internals.addons.scriptrunner=new e.ScriptRunnerAddon(r));break;case"dfp":Promise.resolve().then(n.bind(null,34)).then(e=>this._internals.addons.dfp=new e.DFPAddon(r));break;case"smart":case"nativo":case"freewheel":case"facebook_pixel":case"facebook_pixel_v2":case"eyeota_pixel":case"rubicon":case"rubicon_ssp":case"aol":case"tracking_pixel":case"twitter_pixel":case"pinterest_pixel":case"local_storage":case"appnexus_adserver":case"prebid":case"tradedesk":0;break;case"ddp":case"dbm":case"appnexus":case"pubmatic":case"lotame":0}}else"web"===e&&!0!==t.auto_init&&this._internals.addons.web.reset(t)}addonIfTCFConsent(e,t){const n=()=>{switch(e.key){case"tradedesk":this._internals.addons.tradedesk=new e.Addon(t);break;case"ddp":this._internals.addons.ddp=new e.Addon(t);break;case"appnexus":this._internals.addons.appnexus=new e.Addon(t);break;case"pubmatic":this._internals.addons.pubmatic=new e.Addon(t);break;case"lotame":this._internals.addons.lotame=new e.Addon(t)}},i=t=>t[l[e.key]]?n():Object(d.c)();return(e=>{const t=e.__tcfapi,n={type:"aborted"},i=["tcloaded","useractioncomplete"];return t?Object(r.a)(()=>c(t,"getTCData"),()=>c(t,"getTCData").then(e=>"loaded"===(null==e?void 0:e.cmpStatus)&&i.includes(null==e?void 0:e.eventStatus))).then(Object(u.b)(()=>n,e=>({type:"loaded",data:e}))):Promise.resolve({type:"missing"})})(window).then(e=>{switch(e.type){case"missing":return n();case"aborted":return Object(d.c)();case"loaded":return Object(a.a)((t=e.data).gdprApplies?Object(u.o)(t.vendor.consents):u.n,Object(u.b)(n,i))}var t})}ready(e,t="initialised"){const n=Object(r.b)(),i=()=>{e(),n.resolve()};switch(t){case"initialised":this._internals.isReady?i():this._internals.messages.on("permutive:ready",i);break;case"realtime":this._internals.isRealtime?i():this._internals.messages.once("permutive:ready",i)}return n.promise}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(5),i=n(23),s=n.n(i),o=function(){return s()('/*! permutive-javascript-sdk v13.0.0-RC.19 (web) (built 2020-10-16 15:39:06 GMT+0000) */!function(n){var e={};function t(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return n[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=n,t.c=e,t.d=function(n,e,r){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:r})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var i in n)t.d(r,i,function(e){return n[e]}.bind(null,i));return r},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=1)}([function(n,e,t){"use strict";n.exports=function(n){function e(n,e,t,r){function i(e){"function"!=typeof self.postMessage?n.ports[0].postMessage(e):self.postMessage(e)}t?("undefined"!=typeof console&&"error"in console&&console.error("Worker caught an error:",t),i([e,{message:t.message}])):i([e,null,r])}self.addEventListener("message",(function(t){var r=t.data;if(Array.isArray(r)&&2===r.length){var i=r[0],u=r[1];"function"!=typeof n?e(t,i,new Error("Please pass a function into register().")):function(n,t,r,i){var u,o=function(n,e){try{return{res:n(e)}}catch(n){return{err:n}}}(t,i);o.err?e(n,r,o.err):!(u=o.res)||"object"!=typeof u&&"function"!=typeof u||"function"!=typeof u.then?e(n,r,null,o.res):o.res.then((function(t){e(n,r,null,t)}),(function(t){e(n,r,t)}))}(t,n,i,u)}}))}},function(n,e,t){"use strict";function r(n){return n}t.r(e),t.d(e,"effects",(function(){return ot})),t.d(e,"bootstrap",(function(){return at})),t.d(e,"updateEnvironment",(function(){return ct})),t.d(e,"process",(function(){return st})),t.d(e,"processOne",(function(){return lt})),t.d(e,"migrate",(function(){return ft})),t.d(e,"setSegmentActivationWithStateMap",(function(){return pt}));function i(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n}function u(n,e,t,r,i,u,o,a,c,s){switch(arguments.length){case 1:return n;case 2:return e(n);case 3:return t(e(n));case 4:return r(t(e(n)));case 5:return i(r(t(e(n))));case 6:return u(i(r(t(e(n)))));case 7:return o(u(i(r(t(e(n))))));case 8:return a(o(u(i(r(t(e(n)))))));case 9:return c(a(o(u(i(r(t(e(n))))))));case 10:return s(c(a(o(u(i(r(t(e(n)))))))))}}var o=function(n){return"Left"===n._tag},a=function(n){return{_tag:"Left",left:n}},c=function(n){return{_tag:"Right",right:n}};function s(n,e){try{return c(n())}catch(n){return a(e(n))}}var l=function(n){return function(e){return o(e)?n(e.left):e.right}};var f=function(n,e){return o(n)?n:c(e(n.right))},p=function(n,e){return o(n)?n:o(e)?e:c(n.right(e.right))},d=function(n,e){return o(n)?n:e(n.right)},m=function(n,e,t){return o(n)?e:t(e,n.right)},g=function(n){return function(e,t){return o(e)?n.empty:t(e.right)}},v=function(n,e,t){return o(n)?e:t(n.right,e)},h=function(n){return function(e,t){return o(e)?n.of(a(e.left)):n.map(t(e.right),c)}},b=function(n,e,t){return o(n)?a(e(n.left)):c(t(n.right))},y=function(n,e){return o(n)?a(e(n.left)):n},w=function(n,e){return o(n)?e():n},k=function(n,e){return o(n)?n:c(e(n))},_=function(n,e){return function(n,e){for(var t=e(n);"Left"===t._tag;)t=e(t.left);return t.right}(e(n),(function(n){return o(n)?c(a(n.left)):o(n.right)?a(e(n.right.left)):c(c(n.right.right))}))},j=function(n){return function(e){return f(e,n)}},O=c,A=function(n){return function(e){return o(e)?n.of(a(e.left)):n.map(e.right,c)}},q=a,z="Either";var x={URI:z,map:f,of:O,ap:p,chain:d,reduce:m,foldMap:g,reduceRight:v,traverse:h,sequence:A,bimap:b,mapLeft:y,alt:w,extend:k,chainRec:_,throwError:q};var T,M=(T=function(n,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])})(n,e)},function(n,e){function t(){this.constructor=n}T(n,e),n.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),N=function(){function n(n,e,t,r){this.name=n,this.is=e,this.validate=t,this.encode=r,this.decode=this.decode.bind(this)}return n.prototype.pipe=function(e,t){var r=this;return void 0===t&&(t="pipe("+this.name+", "+e.name+")"),new n(t,e.is,(function(n,t){var i=r.validate(n,t);return o(i)?i:e.validate(i.right,t)}),this.encode===S&&e.encode===S?S:function(n){return r.encode(e.encode(n))})},n.prototype.asDecoder=function(){return this},n.prototype.asEncoder=function(){return this},n.prototype.decode=function(n){return this.validate(n,[{key:"",type:this,actual:n}])},n}(),S=function(n){return n},I=a,P=function(n,e,t){return I([{value:n,context:e,message:t}])},C=c,E=(new(function(n){function e(){var e=n.call(this,"null",(function(n){return null===n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="NullType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"undefined",(function(n){return void 0===n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="UndefinedType",e}return M(e,n),e}(N))),L=(new(function(n){function e(){var e=n.call(this,"void",E.is,E.validate,S)||this;return e._tag="VoidType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"unknown",(function(n){return!0}),C,S)||this;return e._tag="UnknownType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"string",(function(n){return"string"==typeof n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="StringType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"number",(function(n){return"number"==typeof n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="NumberType",e}return M(e,n),e}(N))),U=(new(function(n){function e(){var e=n.call(this,"bigint",(function(n){return"bigint"==typeof n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="BigIntType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"boolean",(function(n){return"boolean"==typeof n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="BooleanType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"UnknownArray",Array.isArray,(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="AnyArrayType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"UnknownRecord",(function(n){var e=Object.prototype.toString.call(n);return"[object Object]"===e||"[object Window]"===e}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="AnyDictionaryType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"Function",(function(n){return"function"==typeof n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="FunctionType",e}return M(e,n),e}(N)),function(n){function e(e,t,r,i,u,o){var a=n.call(this,e,t,r,i)||this;return a.type=u,a.predicate=o,a._tag="RefinementType",a}return M(e,n),e}(N)),G=(R(L,(function(n){return Number.isInteger(n)}),"Int"),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.value=u,o._tag="LiteralType",o}M(e,n)}(N),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.keys=u,o._tag="KeyofType",o}M(e,n)}(N),Object.prototype.hasOwnProperty,function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.runDefinition=u,o._tag="RecursiveType",o}return M(e,n),e}(N));Object.defineProperty(G.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0});(function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.type=u,o._tag="ArrayType",o}M(e,n)})(N),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.props=u,o._tag="InterfaceType",o}M(e,n)}(N),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.props=u,o._tag="PartialType",o}M(e,n)}(N),function(n){function e(e,t,r,i,u,o){var a=n.call(this,e,t,r,i)||this;return a.domain=u,a.codomain=o,a._tag="DictionaryType",a}M(e,n)}(N);var F=function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.types=u,o._tag="UnionType",o}return M(e,n),e}(N);!function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.types=u,o._tag="IntersectionType",o}M(e,n)}(N);!function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.types=u,o._tag="TupleType",o}M(e,n)}(N);(function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.type=u,o._tag="ReadonlyType",o}M(e,n)})(N),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.type=u,o._tag="ReadonlyArrayType",o}M(e,n)}(N),function(n){function e(e,t,r,i,u,o){var a=n.call(this,e,t,r,i,u)||this;return a.tag=o,a}M(e,n)}(F),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.type=u,o._tag="ExactType",o}M(e,n)}(N),new(function(n){function e(){var e=n.call(this,"never",(function(n){return!1}),(function(n,e){return P(n,e)}),(function(){throw new Error("cannot encode never")}))||this;return e._tag="NeverType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"any",(function(n){return!0}),C,S)||this;return e._tag="AnyType",e}return M(e,n),e}(N)),new(function(n){function e(){var e=n.call(this,"object",(function(n){return null!==n&&"object"==typeof n}),(function(n,t){return e.is(n)?C(n):P(n,t)}),S)||this;return e._tag="ObjectType",e}return M(e,n),e}(N));function R(n,e,t){var r;return void 0===t&&(t="("+n.name+" | "+(((r=e).displayName||r.name||"<function"+r.length+">")+")")),new U(t,(function(t){return n.is(t)&&e(t)}),(function(t,r){var i=n.validate(t,r);if(o(i))return i;var u=i.right;return e(u)?C(u):P(u,r)}),n.encode,n,e)}R(L,Number.isInteger,"Integer"),function(n){function e(e,t,r,i,u){var o=n.call(this,e,t,r,i)||this;return o.props=u,o._tag="StrictType",o}M(e,n)}(N);const V=()=>({kind:"null",value:null}),D=n=>({kind:"string",value:n}),J=n=>({kind:"number",value:n}),Y=n=>({kind:"array",value:n}),$=n=>({kind:"object",value:n}),W=n=>n,B=()=>({kind:"bottom"}),K=n=>({kind:"inner",a:n}),H=n=>({kind:"top",error:n}),Q=n=>({kind:"unbounded",group:n}),X=(n,e)=>({kind:"windowed",key:e,group:n}),Z=(n,e,t)=>({kind:"countLimit",n:t,limit:e,group:n}),nn=(n,e,t)=>({kind:"uniqueLimit",n:t,limit:e,group:n}),en=n=>({kind:"numberGroup",group:n}),tn=n=>({kind:"stringGroup",group:n}),rn=n=>({kind:"tuple",tuple:n}),un=n=>({state:n}),on=(n,e)=>({commands:n,payload:e});var an=function(n){return"Some"===n._tag},cn=function(n){return"None"===n._tag},sn={_tag:"None"},ln=function(n){return{_tag:"Some",value:n}};function fn(n){return function(e){return n(e)?ln(e):sn}}var pn=function(n){return function(e){return cn(e)?n():e.value}};var dn=function(n,e){return cn(n)?sn:ln(e(n.value))},mn=function(n){return function(e){return dn(e,n)}};function gn(n){return{equals:function(e,t){return e===t||(cn(e)?cn(t):!cn(t)&&n.equals(e.value,t.value))}}}function vn(n){return{equals:gn(n).equals,compare:function(e,t){return e===t?0:an(e)?an(t)?n.compare(e.value,t.value):1:-1}}}function hn(n,e){return n<e?-1:n>e?1:0}function bn(n,e){return n===e}var yn={equals:bn,compare:hn},wn={equals:bn,compare:hn};function kn(n){return function(e,t){return-1===n.compare(e,t)}}function _n(n){return function(e,t){return 1===n.compare(e,t)}}function jn(n){return function(e,t){return-1===n.compare(e,t)?t:e}}function On(n){var e=function(e,t){return e===t?0:n(e,t)};return{equals:function(n,t){return 0===e(n,t)},compare:e}}var An=function(n,e){return On((function(t,r){return n.compare(e(t),e(r))}))},qn=function(n){return function(e){return An(e,n)}};var zn=function(n,e){var t=n.length;if(0===t)return e;var r=e.length;if(0===r)return n;for(var i=Array(t+r),u=0;u<t;u++)i[u]=n[u];for(u=0;u<r;u++)i[u+t]=e[u];return i};function xn(n){return{equals:function(e,t){return e===t||e.length===t.length&&e.every((function(e,r){return n.equals(e,t[r])}))}}}function Tn(n){return 0===n.length}function Mn(n){return n.length>0}function Nn(n,e){if(void 0===e)return function(e){return Nn(n,e)};for(var t=e.length,r=Array(t+1),i=0;i<t;i++)r[i+1]=e[i];return r[0]=n,r}function Sn(n,e){for(var t=n.length,r=Array(t+1),i=0;i<t;i++)r[i]=n[i];return r[t]=e,r}var In=function(n,e){for(var t=n.length,r=0;r<t&&e(n[r]);r++);return r};function Pn(n){return Tn(n)?n:n.slice().reverse()}var Cn=function(n){return function(e){return Tn(e)?e:e.slice().sort(n.compare)}};function En(n,e,t){for(var r=[],i=Math.min(n.length,e.length),u=0;u<i;u++)r[u]=t(n[u],e[u]);return r}function Ln(n){return function(e,t){if(void 0===t){var r=Ln(n);return function(n){return r(e,n)}}for(var i,u=0,o=t.length;u<o;u++)if(i=t[u],n.equals(i,e))return!0;return!1}}var Un=function(){return Kn},Gn=function(n,e){for(var t=0,r=n.length,i=new Array(r),u=0;u<r;u++){t+=(c=e(u,n[u])).length,i[u]=c}var o=Array(t),a=0;for(u=0;u<r;u++){for(var c,s=(c=i[u]).length,l=0;l<s;l++)o[l+a]=c[l];a+=s}return o},Fn=function(n,e){return Gn(n,(function(n,t){return e(t)}))},Rn=function(n,e){return Dn(n,(function(n,t){return e(t)}))},Vn=function(n,e,t){for(var r=n.length,i=e,u=0;u<r;u++)i=t(u,i,n[u]);return i},Dn=function(n,e){for(var t=[],r=0;r<n.length;r++){var i=e(r,n[r]);an(i)&&t.push(i.value)}return t},Jn=function(n){var e=Yn(n);return function(n,t){return e(n,(function(n,e){return t(e)}))}},Yn=function(n){return function(e,t){return Vn(e,n.of(Un()),(function(e,r,i){return n.ap(n.map(r,(function(n){return function(e){return Sn(n,e)}})),t(e,i))}))}},$n=function(n){return function(e){return Fn(e,n)}},Wn=function(n){return Rn(n,r)},Bn=function(n){var e=Jn(n);return function(n){return function(t){return e(t,n)}}};var Kn=[],Hn=function(n){return On((function(e,t){for(var r=e.length,i=t.length,u=Math.min(r,i),o=0;o<u;o++){var a=n.compare(e[o],t[o]);if(0!==a)return a}return wn.compare(r,i)}))},Qn=function(n){return function(e){return e.slice(0,n)}};function Xn(n){return function(n){return function(e){for(var t=In(e,n),r=Array(t),i=0;i<t;i++)r[i]=e[i];var u=e.length,o=Array(u-t);for(i=t;i<u;i++)o[i-t]=e[i];return{init:r,rest:o}}}(n)}var Zn=function(n){return function(e){return e.slice(n,e.length)}},ne=function(n){return function(e){for(var t=In(e,n),r=e.length,i=Array(r-t),u=t;u<r;u++)i[u-t]=e[u];return i}};var ee=Pn,te=Cn,re=En;var ie=function n(e){var t=Ln(e);return function(r,i){if(void 0===i){var u=n(e);return function(n){return u(n,r)}}return zn(r,i.filter((function(n){return!t(n,r)})))}},ue=$n,oe=Wn,ae=Bn,ce=u;function se(n){switch(n.kind){case"null":return fe.encode(n);case"string":return pe.encode(n);case"number":return de.encode(n);case"array":return me.encode(n);case"object":return ge.encode(n)}}function le(n){return null===n?fe.decode(n):"number"==typeof n?de.decode(n):"string"==typeof n?pe.decode(n):Array.isArray(n)?me.decode(n):ge.decode(n)}const fe=new N("simpleNullCodec",n=>{const e=n;return"null"===e.kind&&null===e.value},(n,e)=>null===n?C({kind:"null",value:null}):P(n,e),n=>n.value),pe=new N("simpleStringCodec",n=>{const e=n;return"string"===e.kind&&"string"==typeof e.value},(n,e)=>"string"==typeof n?C(D(n)):P(n,e),n=>n.value),de=new N("simpleNumberCodec",n=>{const e=n;return"number"===e.kind&&"number"==typeof e.value},(n,e)=>"number"==typeof n?C(J(n)):P(n,e),n=>n.value),me=new N("simpleArrayCodec",n=>{const e=n;return"array"===e.kind&&Array.isArray(e.value)},(n,e)=>{if(Array.isArray(n)){const e=ae(x)(le)(n);return j(Y)(e)}return P(n,e)},n=>n.value.map(se)),ge=new N("simpleObjectCodec",n=>"object"===n.kind,(n,e)=>{if(n&&n.constructor===Object){const e=ae(x)(([n,e])=>ce(le(e),j(e=>i(n,e))))(Object.entries(n));return j(n=>$(new Map([...n])))(e)}return P(n,e)},n=>{const e=[...n.value.entries()];return Object.assign({},...Array.from(e,([n,e])=>({[n]:se(e)})))});new N("simpleJsonCodec",n=>fe.is(n)||de.is(n)||pe.is(n)||me.is(n)||ge.is(n),le,se);var ve=t(0),he=t.n(ve);const be=(n,e)=>{switch(n.kind){case"bottom":return{kind:"bottom"};case"inner":return K(e(n.a));case"top":return H(n.error)}},ye=n=>On((e,t)=>{if("bottom"===e.kind&&"bottom"===t.kind)return 0;if("bottom"===e.kind)return-1;if("bottom"===t.kind)return 1;if("top"===e.kind&&"top"===t.kind)return yn.compare(e.error,t.error);if("top"===e.kind)return 1;if("top"===t.kind)return-1;if("inner"===e.kind&&"inner"===t.kind)return n.compare(e.a,t.a);throw new Error("Non exhaustive match in extendedAlgebraOrd")});function we(n){return Mn(n)?ln(n):sn}var ke=Nn,_e=function(n){return we(function(n){var e=n.length;if(0===e)return Kn;for(var t=Array(e),r=0;r<e;r++)t[r]=n[r];return t}(n))},je=xn;function Oe(n,e){return oe(n.map(e))}function Ae(n,e,t,r){const i=(n,e)=>{if(0===n.length)return oe(e.map(n=>ln({1:n[1],2:t(sn,ln(n[2]))})));if(0===e.length)return oe(n.map(n=>ln({1:n[1],2:t(ln(n[2]),sn)})));if(n.length>0&&e.length>0&&kn(r)(n[0][1],e[0][1])){const[r,...u]=n,o=r[1],a=r[2];return ke({1:o,2:t(ln(a),sn)},i(u,e))}if(n.length>0&&e.length>0&&_n(r)(n[0][1],e[0][1])){const[r,...u]=e,o=r[1],a=r[2];return ke({1:o,2:t(sn,ln(a))},i(n,u))}if(n.length>0&&e.length>0){const[r,...u]=n,[o,...a]=e,c=r[1],s=r[2],l=o[2];return ke({1:c,2:t(ln(s),ln(l))},i(u,a))}throw new Error("Non exhaustive match in mapOption2")},u=qn(n=>n[1])(r),o=(n=>{const e=Oe(n,n=>an(n[2])?ln({1:n[1],2:n[2].value}):sn);return 0===e.length?sn:ln(e)})(i(te(u)([...n].map(n=>({1:n[0],2:n[1]}))),te(u)([...e].map(n=>({1:n[0],2:n[1]})))));return mn(n=>new Map(n.map(n=>[n[1],n[2]])))(o)}function qe(n,e,t,r){const i=qn(n=>n[0])(r),u=te(i)([...e]).reduceRight((n,e)=>{if(o(n)){const r=t(e[1],n.left);return an(r)?a(r.value):c(e[0])}return n},a(n));return"Left"===(s=u)._tag?sn:ln(s.right);var s}function ze(n,e){return new Map([...n].map(e))}function xe(n,e){return new Map([...n].filter(e))}function Te(n){return{equals:function(e,t){return e===t||n(e,t)}}}var Me={equals:function(n,e){return n===e}};var Ne=Me,Se=Me;function Ie(n){return mn(Ge)(function(n){switch(n.state.kind){case"top":return ln(D(n.state.error));case"bottom":return sn;case"inner":return function(n){return function(n){switch(n.kind){case"numberGroup":case"stringGroup":return Pe(n.group);case"tuple":return n.tuple.length>0}}(n.payload)?ln(Y(function(n,e){const t=mn(n=>ke(n,e))(n);return pn(()=>e)(t)}(mn(n=>D(function(n){const e=n=>{switch(n){case"add":return"p";case"mul":return"m";case"max":return"v";case"min":return"n"}};return n.map(n=>1===n[2]?e(n[1]):e(n[1])+JSON.stringify(n[2])).join("")}(n)))(n.commands),function(n){const e=n=>{switch(n.kind){case"bottom":return{kind:"null",value:null};case"top":return D(n.error);case"inner":return J(n.a)}};switch(n.kind){case"tuple":return n.tuple.map(e);case"stringGroup":return t=n.group,Oe([Ce,Ee,n=>ce(n,Ue,$,ln)],n=>n(t));case"numberGroup":return(n=>Oe([Ce,Le,n=>ce(n,Ue,n=>ze(n,([n,e])=>[JSON.stringify(n),e]),$,ln)],e=>e(n)))(n.group)}var t}(n.payload)))):sn}(n.state.a)}}(n))}function Pe(n){switch(n.kind){case"unbounded":return n.group.size>0;case"windowed":return n.group.size>0||an(n.key);case"countLimit":case"uniqueLimit":return n.group.size>0||an(n.limit)}}function Ce(n){switch(n.kind){case"unbounded":return sn;case"windowed":return ln(D("w"));case"countLimit":return ln(D(1===n.n?"x":"x"+n.n));case"uniqueLimit":return ln(D(1===n.n?"u":"u"+n.n))}}function Ee(n){switch(n.kind){case"unbounded":return sn;case"windowed":return ln(D(an(n.key)?n.key.value:""));case"countLimit":case"uniqueLimit":return ln(D(an(n.limit)?n.limit.value:""))}}function Le(n){switch(n.kind){case"unbounded":return sn;case"windowed":return an(n.key)?ln(J(n.key.value)):ln({kind:"null",value:null});case"countLimit":case"uniqueLimit":return an(n.limit)?ln(J(n.limit.value)):ln({kind:"null",value:null})}}function Ue(n){switch(n.kind){case"unbounded":case"windowed":case"countLimit":case"uniqueLimit":return n.group}}function Ge(n){switch(n.kind){case"array":return 0===n.value.length?{kind:"null",value:null}:1===n.value.length?Ge(n.value[0]):Y(n.value.map(Ge));case"object":return ce(xe(n.value,([n,e])=>"null"!==e.kind),n=>ze(n,n=>[n[0],Ge(n[1])]),$);default:return n}}function Fe(n){const e=n=>{if(0===n.length)return{kind:"bottom"};const e=(n=>{if(4!==n.length)return sn;const[e,t,r,i]=n;if("string"===e.kind&&"string"===t.kind&&"object"===i.kind){const n=fn(n=>Re(n[1].value)&&Ve(n[2].value))({1:e,2:t});return mn(n=>({prim:n[1].value,grp:n[2].value,cutoff:r,m:i.value}))(n)}return sn})(n);if(an(e)){const{prim:n,grp:t,cutoff:r,m:i}=e.value,u=De(r,i,Je(t));return"string"==typeof u?H(u):K(on(Ye(n),u))}const t=(n=>{if(3!==n.length)return sn;const[e,t,r]=n;if("string"===e.kind&&"object"===r.kind){const n=fn(n=>Ve(n.value))(e);return mn(n=>({grp:n.value,cutoff:t,m:r.value}))(n)}return sn})(n);if(an(t)){const{grp:n,cutoff:e,m:r}=t.value,i=De(e,r,Je(n));return"string"==typeof i?H(i):K(on(sn,i))}const r=(n=>{if(2!==n.length)return sn;const[e,t]=n;if("string"===e.kind&&"object"===t.kind){const n=fn(n=>Re(n.value))(e);return mn(n=>({prim:n.value,m:t.value}))(n)}return sn})(n);if(an(r)){const{prim:n,m:e}=r.value;return K(on(Ye(n),tn(Q(e))))}const i=(n=>{if(1!==n.length)return sn;const[e]=n;return"object"===e.kind?ln({m:e.value}):sn})(n);if(an(i)){const{m:n}=i.value;return K(on(sn,tn(Q(n))))}const u=(n=>{if(n.length<1)return sn;const[e,...t]=n;if("string"===e.kind){const n=fn(n=>Re(n.value))(e);return mn(n=>({prim:n.value,rest:t}))(n)}return sn})(n);if(an(u)){const{prim:n,rest:e}=u.value;return K(on(Ye(n),$e(e)))}return K(on(sn,$e(n)))},t=n=>{switch(n.kind){case"array":return ue(t)(n.value);default:return[n]}};switch(n.kind){case"null":return un({kind:"bottom"});default:return un(e(t(n)))}}function Re(n){const e=n.split("");switch(!0){case 0===e.length:return!1;default:{const[n,...t]=e;return-1!=="pmvn".indexOf(n)&&t.every(n=>-1!=="pmvn0123456789".indexOf(n))}}}function Ve(n){const e=n.split("");switch(!0){case 0===e.length:return!1;case"w"===e[0]&&void 0===e[1]:return!0;default:{const[n,...t]=e;return-1!=="ux".indexOf(n)&&-1===t.map(n=>!isNaN(parseInt(n))).indexOf(!1)}}}function De(n,e,t){switch(n.kind){case"string":return tn(t({1:ln(n.value),2:e}));case"number":case"null":return en(t({1:"null"===n.kind?sn:ln(n.value),2:xe(ze(e,([n,e])=>[Number(n),e]),n=>!isNaN(n[0]))}));default:return"{bad cutoff}"}}function Je(n){const e=n=>e=>nn(e[2],e[1],n),t=n=>e=>Z(e[2],e[1],n),r=n.split("");switch(!0){case"w"===r[0]&&void 0===r[1]:return n=>X(n[2],n[1]);case"u"===r[0]&&void 0===r[1]:return e(1);case"u"===r[0]&&void 0!==r[1]:return e(parseInt(r.slice(1).join("")));case"x"===r[0]&&void 0===r[1]:return t(1);case"x"===r[0]&&void 0!==r[1]:return t(parseInt(r.slice(1).join("")));default:throw new Error("This should never happen if you use isGroupCommand")}}function Ye(n){return mn(W)(_e(function n(e,t){const r=t(e);return pn(()=>[])(mn(e=>[e[1]].concat(n(e[2],t)))(r))}(n,n=>{const e=n.split("");if(0===e.length)return sn;const[t,...r]=e,i=(n=>{switch(n){case"p":return ln("add");case"m":return ln("mul");case"v":return ln("max");case"n":return ln("min");default:return sn}})(t);return mn(n=>{const{init:e,rest:t}=Xn(n=>{return"number"==typeof(e=parseInt(n))&&isFinite(e)&&Math.floor(e)===e;var e})(r);return{1:{1:n,2:0===e.length?1:parseInt(e.join(""))},2:t.join("")}})(i)})))}function $e(n){return rn(n.map(We))}function We(n){switch(n.kind){case"number":return K(n.value);case"string":return H(n.value);case"null":return{kind:"bottom"};case"object":return H("{object}");case"array":return H("{array}")}}const Be={strategy:(n,e,t)=>r=>{if(cn(t))return e;if("delta"===n&&cn(e))return sn;if(cn(e))return t;if(an(e)&&an(t))return r(e.value,t.value);throw new Error("Non exhaustive match in combineCommand.strategy")},operation:(n,e,t,r,i,u)=>{const o=Hn(ye(u));if("append"===n&&"add"===e)return re(t,r,et(i.plus));if("append"===n&&"mul"===e)return re(t,r,et(i.times));if("append"===n&&"max"===e)return jn(o)(t,r);if("join"===n&&"add"===e)return re(t,r,et(jn(u)));if("join"===n&&"mul"===e)return re(t,r,et(jn(u)));if("join"===n&&"max"===e)return jn(o)(t,r);if("min"===e)return Be.operation(n,"max",t,r,i,function(n){return On((e,t)=>function(n){switch(n){case-1:return 1;case 1:return-1;default:return 0}}(n.compare(e,t)))}(u));if("delta"===n&&"max"===e)return _n(o)(t,r)?t:r.map(B);if("delta"===n)return re(t,r,(n,e)=>_n(ye(u))(n,e)?n:{kind:"bottom"});throw new Error("Non exhaustive match in combineCommand.operation")}},Ke={plus:(n,e)=>n+e,times:(n,e)=>n*e};function He(n,e,t,r){if("unbounded"===n.kind&&"unbounded"===e.kind){const i=n.group,u=e.group;return pn(B)(mn(n=>K(Q(n)))(Ae(i,u,t,r)))}if("windowed"===n.kind&&"windowed"===e.kind){const i=n.key,u=n.group,o=e.key,a=e.group,c=jn(vn(r))(i,o);return pn(B)(mn(n=>K(X(n,c)))(Ae(u,a,t,r)))}if("countLimit"===n.kind&&"countLimit"===e.kind){const i=n.n,u=e.n;if(i===u){const u=n.limit,o=n.group,a=e.limit,c=e.group,s=jn(vn(r))(u,a);return pn(B)(mn(n=>K(Z(n,s,i)))(Ae(o,c,t,r)))}return H("Non matching counts")}if("uniqueLimit"===n.kind&&"uniqueLimit"===e.kind){const i=n.n,u=e.n;if(i===u){const u=n.limit,o=n.group,a=e.limit,c=e.group,s=jn(vn(r))(u,a);return pn(B)(mn(n=>K(nn(n,s,i)))(Ae(o,c,t,r)))}return H("Non matching counts")}return H("Non matching group types")}function Qe(n,e,t){return pn(V)(function n(e,t){const r=t=>(r,i)=>Be.strategy(e,r,i)(n(e,t)),i=(n,t,i)=>{if("stringGroup"===t.kind&&"stringGroup"===i.kind){const e=He(t.group,i.group,r(n),yn);return be(e,n=>tn(Ze(n,yn)))}if("numberGroup"===t.kind&&"numberGroup"===i.kind){const e=He(t.group,i.group,r(n),wn);return be(e,n=>en(Ze(n,wn)))}if("tuple"===t.kind&&"tuple"===i.kind){const r=an(n)?n.value:[];return K(rn(function(n,e,t,r,i,u){const o=(n,e)=>({1:Qn(n)(e).concat([...Array(Math.max(0,n-e.length))].map(B)),2:Zn(n)(e)}),a=(e,t,r)=>{if(0===e.length)return Be.operation(n,"max",t,r,i,u);if(0===t.length)return r;if(0===r.length)return t;if(e.length>0){const[c,...s]=e,l=o(c[2],t),f=l[1],p=l[2],d=o(c[2],r),m=d[1],g=d[2];return Be.operation(n,c[1],f,m,i,u).concat(a(s,p,g))}throw new Error("Non exhaustive match in recurse")};return ee(ne(n=>"bottom"===n.kind)(ee(a(e,t,r))))}(e,r,t.tuple,i.tuple,Ke,wn)))}throw new Error(`Non matching payload. Got ${t.kind} and ${i.kind}`)},u=(n,e)=>{var r;if(gn(je((r={1:Ne,2:Se},Te((function(n,e){for(var t in r)if(!r[t].equals(n[t],e[t]))return!1;return!0}))))).equals(n.commands,e.commands)){const r=cn(n.commands)?t:n.commands,u=i(r,n.payload,e.payload);return be(u,e=>on(n.commands,e))}throw new Error(`Non matching primitive strings. Got ${JSON.stringify(n)} and ${JSON.stringify(e)}`)};return(n,e)=>Ie(un(nt(u,Fe(n).state,Fe(e).state)))}(n,sn)(e,t))}function Xe(n,e,t){const r=mn(e=>xe(n,([n,r])=>{return(i=t,function(n,e){return-1!==i.compare(n,e)})(n,e);var i}))(e);return pn(()=>n)(r)}function Ze(n,e){switch(n.kind){case"unbounded":return n;case"windowed":return cn(n.key)?n:X(Xe(n.group,n.key,e),n.key);case"countLimit":{const t=n.limit,r=n.n,i=n.group,u=qe(r,i,(n,e)=>e<=1?sn:ln(e-1),e),o=jn(vn(e))(t,u);return Z(Xe(i,o,e),o,r)}case"uniqueLimit":{const t=n.limit,r=n.n,i=n.group,u=(n,e)=>{switch(n.kind){case"object":{const t=[...n.value.keys(),...e.keys()],i=new Set(t);return i.size>=r?sn:ln(i)}default:return sn}},o=qe(new Set,i,u,e),a=jn(vn(e))(t,o);return nn(Xe(i,a,e),a,r)}}}function nt(n,e,t){if("inner"===e.kind&&"inner"===t.kind)return n(e.a,t.a);if("bottom"===e.kind)return t;if("bottom"===t.kind)return e;if("top"===e.kind&&"top"===t.kind)return H(jn(yn)(e.error,t.error));if("top"===e.kind)return e;if("top"===t.kind)return t;throw new Error("Non exhaustive match in extend")}function et(n){return(e,t)=>nt((e,t)=>K(n(e,t)),e,t)}function tt(n,e){return Qe("append",n,e)}function rt(n,e){return Object.keys(n).reduce((t,r)=>{const i=e(r,n[r]);return Object.assign(Object.assign({},t),an(i)?{[r]:i.value}:{})},{})}const it={39204:(ut=(()=>{function n(n){switch(n.length){case 0:return null;case 1:return n[0];default:return n}}function e(n,e,t=u){let r=e.reduce((function(n,e){return n&&null!=n[e]?n[e]:null}),n);return null===r?null:t(r)}function t(n,e){var t=e.slice();return t.unshift(n),t}let r=(n,r,i=u)=>e(n,t("properties",r),i);function i(n){const e=Object.keys(n);for(var t=e.length,r=new Array(t);t--;)r[t]=[e[t],n[e[t]]];return r}let u=n=>n,o=n=>!0,a=(n,e)=>t=>n(t)&&e(t),c=(n,e)=>t=>n(t)||e(t),s=n=>e=>!n(e),l=(n,e)=>t=>t>=n&&t<=e,f=n=>new Date(n).getTime(),p=n=>e(n,["time"],f),d=(n,t)=>e(t,n,f),m=(n,t,r,i,u,o)=>a=>{const c=e(a,n,n=>n.filter(i).map(n=>e(n,t)).reduce(u,o));return r(null===c?o:c)},g=n=>e=>"string"==typeof n&&"string"==typeof e&&e.toLowerCase().indexOf(n.toLowerCase())>-1,v=n=>e=>null!=e&&"object"==typeof e&&e.indexOf(n)>=0;function h(n,t,r,i,u){const o=e(n.getSegments(),[t,r])||!1;return u&&(i||o)&&n.setSegmentActivation(t,r,u),o}function b(n,t,r){return e(n.getSegments(),[t,r])||!1}let y=(n,t,r=18e5)=>i=>({a:{m:(n,e)=>[e[0],i.a.m(null!=n[0]&&n[0][0]===e[0][0]?n[1]:i.a.z,e[1])],z:[[],i.a.z]},p:(r,u)=>[[n(r)],e(u,t)===n(r)?i.p(r,u):i.a.z],r:(e,t)=>i.r(e,t[0]!=[]&&t[0][0]===n(e)?t[1]:i.a.z),d:i.d.sq||{l:(u,o)=>{let a=e(u,t),c=n(o);if(a!==c)return null;let s=i.d.l(u,o);if(!(Array.isArray(s)&&s.length>1))return null;let[l,...f]=s,d=+(p(u)||o.getCurrentTime()),m=Math.floor(d/r),g={};return g[m]={},g[m][c]=1===f.length?f[0]:f,[l,"u",null,g]},i:(e,t)=>{if(!Array.isArray(e)||"object"!=typeof e[3])return[[],i.a.z];let r=n(t),u=e[3];return[[r],Object.keys(u).map(n=>u[n][r]).filter(n=>n).map(n=>i.d.i([e[0]].concat(n))).reduce(i.a.m,i.a.z)]}}}),w=y(n=>n.getCurrentSession(),["session_id"],18e5),k=y(n=>n.getCurrentView(),["view_id"],3e5);function _(n,t,r,i=1){return{a:{m:(n,e)=>n.concat(e).slice(-r),z:[]},p:(r,i)=>e(i,["name"])===t?[n.p(r,i)]:[],r:(e,t)=>n.r(e,t.reduce((e,t)=>n.a.m(e,t),n.a.z)),d:n.d.ftn||{l:(t,u)=>{const o=n.d.l(t,u),a=e(t,["time"],f)*i;return o&&[o[0],"x"+r,null,{[a]:2==o.length?o[1]:o.slice(1)}]},i:(e,t)=>e?Object.keys(e[3]||{}).sort().reverse().map(n=>Array.isArray(n)?[e[0],...e[3][n]]:[e[0],e[3][n]]).map(e=>n.d.i(e,t)):[]}}}let j=(n,e)=>null===n?null==e?null:{b:e}:null==e?{a:n}:{a:n,b:e},O=(n,e)=>n&&e?n(e):null,A=(n,e,t)=>t&&t.result&&Array.isArray(t.result)?j(O(n.d&&n.d.m,{result:t.result[0]}),O(e.d&&e.d.m,{result:t.result[1]})):null;return{q:function(n){const e=(e,t)=>({result:n.r(e,t)});return{initial:e=>({result:n.a.z}),update:(e,t,r)=>({result:n.a.m(t.result,n.p(e,r))}),result:(n,t)=>e(n,t.result),lift:(e,t)=>n.d.l(e,t),interpret:(t,r)=>e(r,n.d.i(t,r)),migrate:e=>e&&n.d.m?n.d.m(e):null,m:n.a.m,z:n.a.z,p:n.p,r:n.r,i:n.d.i}},a:n=>n.reduce(a),acq:function(n,e){return{p:(t,r)=>[n.p(t,r),e.p(t,r)],r:(t,r)=>n.r(t,r[0])&&e.r(t,r[1]),a:{z:[n.a.z,e.a.z],m:(t,r)=>[n.a.m(t[0],r[0]),e.a.m(t[1],r[1])]},d:{l:(t,r)=>j(n.d.l(t,r),e.d.l(t,r)),i:(t,r)=>t?[n.d.i(t.a||null,r),e.d.i(t.b||null,r)]:[n.a.z,e.a.z],m:t=>A(n,e,t)}}},af_i:(n,t,r=o)=>i=>e(i,n,n=>n.filter(r).map(t).reduce((n,e)=>n&&e,!0))&&!0,af_l:(n,t,r=o)=>i=>{const u=e(i,n,n=>n.filter(r).length);return t(null===u?0:u)},af_m:(n,t,r,i=o)=>u=>{const o=e(u,n,n=>n.filter(i));return null===o||0===o.length?r(0):r(o.map(n=>e(n,t)).reduce((n,e)=>n+e,0)/o.length)},af_n:(n,e,t,r=o)=>m(n,e,t,r,(n,e)=>Math.min(n,e),Number.POSITIVE_INFINITY),af_p:(n,e,t,r=o)=>m(n,e,t,r,(n,e)=>n*e,1),af_s:(n,e,t,r=o)=>m(n,e,t,r,(n,e)=>n+e,0),af_u:(n,t,r=o)=>i=>e(i,n,n=>n.filter(r).map(t).reduce((n,e)=>n||e,!1))||!1,af_x:(n,e,t,r=o)=>m(n,e,t,r,(n,e)=>Math.max(n,e),Number.NEGATIVE_INFINITY),as:(n,r,i)=>u=>i.reduce((i,o)=>i&&n(o)(e(u,t("properties",r))),!0),c:v,c_:(n,t)=>r=>v(t)(e(r,n)),ctu:function(n,t,r,i){return{a:i?{m:(n,e)=>n.filter(n=>-1===e.indexOf(n)).concat(e).slice(-i),z:[]}:{m:(n,e)=>n.filter(n=>-1===e.indexOf(n)).concat(e),z:[]},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):[],r:(n,e)=>e,d:{l:()=>null,i:()=>[]}}},ctv:function(n,t,r,i){function u(n,e){const t=n=>({k:n.k,c:1+n.c}),r={arr:[],add:{k:e,c:1}};return e?(n=>n.arr.concat(n.add))(n.reduce((n,e)=>n.add.k===e.k?{arr:n.arr,add:t(e)}:{arr:n.arr.concat(e),add:n.add},r)):n}return{a:i?{m:(n,e)=>u(n,e).slice(-i),z:[]}:{m:(n,e)=>u(n,e),z:[]},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):null,r:(n,e)=>e.reduce((n,e)=>Object.assign(Object.assign({},n),{[e.k]:e.c}),{}),d:{l:n=>null,i:n=>[]}}},ctw:function(n,t,r,i){return{a:i?{m:(n,e)=>n.concat(e).slice(-i),z:[]}:{m:(n,e)=>n.concat(e),z:[]},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):[],r:(n,e)=>e,d:{l:()=>null,i:()=>[]}}},cw:function(n,t,r=u){return{a:{m:(n,e)=>n+e,z:0},p:(r,i)=>e(i,["name"])===n&&t(i)?1:0,r:(n,e)=>r(e),d:{l:r=>e(r,["name"])===n&&t(r)?["p",1]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:0,m:n=>n&&n.result?["p",n.result]:null}}},e:n=>e=>e===n,e_:(n,t)=>r=>e(r,n)===t,fm:function(n,e){return{p:e.p,r:(t,r)=>n(e.r(t,r)),a:e.a,d:e.d}},ftn:function(n,t,r){return{a:{m:(n,e)=>n.concat(e.slice(0,r-n.length)),z:[]},p:(r,i)=>e(i,["name"])===t?[n.p(r,i)]:[],r:(e,t)=>n.r(e,t.reduce((e,t)=>n.a.m(e,t),n.a.z)),d:_(n,t,r,-1).d}},fw:function(n,t,r,i=u){return{a:{m:(n,e)=>null===n?e:n,z:null},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):null,r:(n,e)=>e,d:{l:r=>e(r,["name"])===n&&t(r)?["p",1]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:0,m:n=>n&&n.result?["p",n.result]:null}}},g:n=>e=>e>n,g_:(n,t)=>r=>e(r,n)>t,gb:function(n,r,i){return{a:{m:(t,i)=>Object.keys(t).concat(Object.keys(i)).filter((n,e,t)=>t.indexOf(n)===e).sort((n,r)=>Math.max(e(t,[r,1]),e(i,[r,1]))-Math.max(e(t,[n,1]),e(i,[n,1]))).slice(0,r).reduce((r,u)=>{const o=n.a.m(e(t,[u,0])||n.a.z,e(i,[u,0])||n.a.z);return r[u]=[o,Math.max(e(t,[u,1]),e(i,[u,1]))],r},{}),z:{}},p:(r,u)=>{const o=e(u,t("properties",i)),a=n.p(r,u);return null==o||null==(c=a)||"object"==typeof c&&0===Object.keys(c).length||c===n.a.z?{}:{[o]:[a,e(u,["time"],f)]};var c},r:(e,t)=>{const r={};return Object.keys(t).forEach(i=>r[i]=n.r(e,t[i][0])),r},d:{l:()=>null,i:()=>({})}}},ge:n=>e=>e>=n,ge_:(n,t)=>r=>e(r,n)>=t,i_:u,ifp:function(n){let e=(e,t)=>b(e,"1p",n);return{a:{m:(n,e)=>e,z:!1},p:e,r:(n,e)=>e,d:{l:(n,t)=>["v2",+f(p(n)||t.getCurrentTime()),+e(t)],i:n=>Array.isArray(n)&&(!!+n[2]||!1)}}},isp:function(n,e,t,r){return{a:{m:(n,e)=>e,z:!1},p:(t,r)=>b(t,n,e),r:(i,u)=>h(i,n,e,t,r),d:{l:(n,e)=>null,i:n=>Array.isArray(n)&&(!!+n[2]||!1)}}},itp:function(n,e,t,r){return{a:{m:(n,e)=>e,z:!1},p:(t,r)=>b(t,n,e),r:(i,u)=>h(i,n,e,t,r),d:{l:(n,e)=>null,i:n=>Array.isArray(n)&&(!!+n[2]||!1)}}},k:e,l:n=>e=>e<n,l_:(n,t)=>r=>e(r,n)<t,le:n=>e=>e<=n,le_:(n,t)=>r=>e(r,n)<=t,lm:function(n,e){let t=(e,t)=>function(n,e,t){const r=n||{},u=e[t]||{};var o=(u["1p"]||{}).const||0;const a=i(u);for(var c in a){const n=i(a[c][1]);for(var s in n)!0===(r[a[c][0]]||{})[n[s][0]]&&(o+=n[s][1])}return l=o,1/(1+Math.pow(Math.E,-l));var l}(e.getSegments(),e.getLookalikeModels(),n);return{a:{m:(n,e)=>e,z:[]},p:(n,e)=>[t(n)],r:(n,t)=>!!t[0]&&e(t[0]),d:{l:(n,e)=>["v2",+f(p(n)||e.getCurrentTime()),+t(e)],i:n=>Array.isArray(n)?[+n[2]]||!1:[]}}},ltn:_,mnw:function(n,t,r,i=u){var o=Number.POSITIVE_INFINITY;return{a:{m:(n,e)=>n<e?n:e,z:o},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):o,r:(n,e)=>i(e),d:{l:i=>e(i,["name"])===n&&t(i)?["n",e(i,r)]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:o}}},mxw:function(n,t,r,i=u){const o=Number.NEGATIVE_INFINITY;return{a:{m:(n,e)=>n>e?n:e,z:o},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):o,r:(n,e)=>i(e),d:{l:i=>e(i,["name"])===n&&t(i)?["v",e(i,r)]:null,i:n=>n?Array.isArray(n)?n.slice(-1)[0]:n:o}}},n0:s(u),n:n=>e=>e!==n,nt:s,n_:(n,t)=>r=>e(r,n)!==t,o:n=>n.reduce(c),ocq:function(n,e){return{p:(t,r)=>[n.p(t,r),e.p(t,r)],r:(t,r)=>n.r(t,r[0])||e.r(t,r[1]),a:{z:[n.a.z,e.a.z],m:(t,r)=>[n.a.m(t[0],r[0]),e.a.m(t[1],r[1])]},d:{l:(t,r)=>j(n.d.l(t,r),e.d.l(t,r)),i:(t,r)=>t?[n.d.i(t.a||null,r),e.d.i(t.b||null,r)]:[n.a.z,e.a.z],m:t=>A(n,e,t)}}},oe:i,os:(n,r,i)=>u=>i.reduce((i,o)=>i||n(o)(e(u,t("properties",r))),!1),pb:(n,e,t)=>i=>l(e,t)(r(i,n)),pc:(n,r)=>i=>{const u=e(i,t("properties",n));return null!=u&&"object"==typeof u&&u.indexOf(r)>=0},pe:(n,e)=>t=>r(t,n)===e,pg:(n,e)=>t=>r(t,n)>e,pge:(n,e)=>t=>r(t,n)>=e,pl:(n,e)=>t=>r(t,n)<e,ple:(n,e)=>t=>r(t,n)<=e,pn:(n,e)=>t=>r(t,n)!==e,ps:(n,e)=>t=>g(e)(r(t,n)),pw:function(n,t,r,i=u){return{a:{m:(n,e)=>n*e,z:1},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):1,r:(n,e)=>i(e),d:{l:i=>{return e(i,["name"])===n&&t(i)?(u=e(i,r))>=1?["m2p",u]:u>0?["m2p",null,1/u]:0==u?["m2p",0]:u>-1?["m2p",null,1/u,1]:["m2p",u,null,1]:null;var u},i:n=>{return n?Array.isArray(n)?0===(e=n.slice(1))[0]?0:Math.pow(-1,e[2]||0)*(e[0]||1)/(e[1]||1):n:1;var e}}}},s:g,s_:(n,t)=>r=>g(t)(e(r,n)),scq:function(n,e,t=u){return{p:(t,r)=>[n.p(t,r),e.p(t,r)],r:(r,i)=>t(n.r(r,i[0])+e.r(r,i[1])),a:{z:[n.a.z,e.a.z],m:(t,r)=>[n.a.m(t[0],r[0]),e.a.m(t[1],r[1])]},d:{l:(t,r)=>j(n.d.l(t,r),e.d.l(t,r)),i:(t,r)=>t?[n.d.i(t.a||null,r),e.d.i(t.b||null,r)]:[n.a.z,e.a.z],m:t=>A(n,e,t)}}},sq:w,sw:function(n,t,r,i=u){return{a:{m:(n,e)=>n+e,z:0},p:(i,u)=>e(u,["name"])===n&&t(u)?e(u,r):0,r:(n,e)=>i(e),d:{l:i=>{return(r=>e(r,["name"])===n&&t(r))(i)?(u=e(i,r))<0?["p2",null,-u]:["p2",u]:null;var u},i:n=>{return n?Array.isArray(n)?((e=n.slice(1))[0]||0)-(e[1]||0):n:0;var e}}}},t:o,tb:(n,e)=>t=>l(n,e)(p(t)),te:n=>e=>p(e)===n,te_:(n,e)=>t=>d(n,t)===e,tg:n=>e=>p(e)>n,tg_:(n,e)=>t=>d(n,t)>e,tge:n=>e=>p(e)>=n,tge_:(n,e)=>t=>d(n,t)>=e,ti:f,tl:n=>e=>p(e)<n,tl_:(n,e)=>t=>d(n,t)<e,tle:n=>e=>p(e)<n,tle_:(n,e)=>t=>d(n,t)<e,tn:n=>e=>p(e)!==n,tn_:(n,e)=>t=>d(n,t)!==e,tw:function(t,r,i){const u=i||100,o=Math.ceil(r/u),a=n=>Math.floor(n/o),c=(n,e,t)=>[a(n-r),{[a(e)]:t}],s=(n,e)=>{const r=Math.max(n[0],e[0]),i=Object.keys(n[1]).filter(n=>n>=r).concat(Object.keys(e[1]).filter(n=>n>=r)).filter((n,e,t)=>t.indexOf(n)===e).reduce((r,i)=>{const u=t.a.m(n[1][i]||t.a.z,e[1][i]||t.a.z);return u!==t.a.z&&(r[i]=u),r},{});return[r,i]},l=[Number.NEGATIVE_INFINITY,{}],p=n=>{const e=e=>e.map(([e,t,r])=>c(n.t,r,e)).reduce(s,l);return s(e(n.in),e(n.out))},d=e=>{if(void 0!==e.result)return d(e.result);if(void 0!==e.w)return d(p(e));const[r,i]=e;let u=null,o={};for(let e in i){let r=t.d.m({result:i[e]});r&&Array.isArray(r)&&(u=r[0],o[e]=n(r.slice(1)))}return u&&[u,"w",e[0],o]};return{a:{m:(n,e)=>{const t=n.w?p(n):n;return s(t,e)},z:l},p:(n,r)=>c(n.getCurrentTime(),e(r,["time"],f),t.p(n,r)),r:(n,e)=>{const r=(e.w?p(e):e)[1];return t.r(n,Object.keys(r).reduce((n,e)=>t.a.m(n,r[e]),t.a.z))},d:t.d.tw||{l:(n,r)=>{let i=t.d.l(n,r);return i&&[i[0],"w",...c(r.getCurrentTime(),e(n,["time"],f),i.slice(1))]},i:(n,e)=>{let r=Array.isArray(n)?n:[];return[r[2]||null,Object.keys(r[3]||{}).map(n=>({[n]:t.d.i(r[3][n],e)})).reduce((n,e)=>(Object.keys(e).forEach(t=>n[t]=e[t]),n),{})]},m:t.d.m&&d}}},vgw:function(n,t,r,i=u){const o={v:0,k:0};return{a:{m:(n,e)=>{var t=n.k+e.k;return{v:t?n.v+e.k*(e.v-n.v)/t:0,k:t}},z:o},p:(i,u)=>e(u,["name"])===n&&t(u)?{v:e(u,r),k:1}:o,r:(n,e)=>i(e.v),d:{l:i=>{return e(i,["name"])===n&&t(i)?0==(u=e(i,r))?["p3",1]:u<0?["p3",1,null,-u]:["p3",1,u]:null;var u},i:n=>{return n?Array.isArray(n)?{v:(((e=n.slice(1))[1]||0)-(e[2]||0))/(e[0]||1),k:e[0]||0}:void 0:o;var e}}}},vq:k}})()).q(ut.cw("Pageview",ut.t,ut.ge(1))),39372:ut.q(ut.cw("Pageview",ut.o([ut.ps(["article","channel"],"sport"),ut.os(ut.e,["article","sectn"],["all-sports","sport","football","cricket","winter-olympics"])]),ut.ge(2))),40285:ut.q(ut.acq(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit1"],"bbccom.live.site.capital"),ut.ps(["b_app_name"],"worklife"),ut.os(ut.s,["b_site_channel"],["capital","worklife"]),ut.ps(["bbc_site"],"worklife"),ut.os(ut.s,["article","channel"],["capital","worklife"]),ut.ps(["article","prod_name"],"worklife"),ut.os(ut.s,["client","url"],["capital","worklife","business"]),ut.pe(["client","url"],"bbc.com/business"),ut.pe(["dfp_adUnit2"],"news_business_content"),ut.pe(["b_site_section"],"business"),ut.pe(["article","sectn"],"business")]),ut.ge(2)),12096e5),ut.cw("Pageview",ut.pe(["geo_info","country"],"United States"),ut.ge(1)))),40286:ut.q(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit2"],"news_uk_content"),ut.pe(["b_site_section"],"news.uk"),ut.ps(["article","name"],"news.uk"),ut.pe(["article","sectn"],"uk"),ut.ps(["client","url"],"bbc.com/news/uk"),ut.pe(["b_site_subsec1"],"news.uk.england")]),ut.ge(2)),12096e5)),40289:ut.q(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit1"],"bbccom.live.site.travel"),ut.pe(["dfp_adUnit2"],"travel_story_content"),ut.ps(["b_app_name"],"travel"),ut.ps(["b_site_channel"],"travel"),ut.ps(["bbc_site"],"travel"),ut.ps(["article","channel"],"travel"),ut.os(ut.s,["client","url"],["bbc.com/travel","bbc.com/travel/columns","bbc.com/travel/columns/adventure-experience","bbc.com/travel/columns/culinary-roots","bbc.com/travel/columns/food-hospitality","bbc.com/travel/columns/places-that-changed-the-world","bbc.com/travel/columns/why-we-are-what-we-are","bbc.com/travel/destinations","bbc.com/travel/europe","bbc.com/travel/gallery","bbc.com/travel/story","travel","adventure-experience","culinary-roots","europe","why-we-are-what-we-are","food-hospitality"]),ut.os(ut.s,["b_site_section"],["travel","travel.story"])]),ut.ge(2)),12096e5)),40292:ut.q(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit1"],"bbccom.live.site.culture"),ut.pe(["dfp_adUnit2"],"culture_story_content"),ut.pe(["b_app_name"],"culture"),ut.pe(["b_site_channel"],"culture"),ut.pe(["b_site"],"culture"),ut.pe(["article","channel"],"culture"),ut.os(ut.s,["client","url"],["bbc.com/culture","bbc.com/travel/columns/culture-identity"])]),ut.ge(2)),12096e5)),40294:ut.q(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit2"],"news_education_content"),ut.ps(["b_site"],"news.education"),ut.os(ut.c,["article","gsChannels"],["gs_education","gs_education_misc","gs_education_university"]),ut.ps(["article","sectn"],"education"),ut.os(ut.s,["client","url"],["bbc.com/news/education","education"]),ut.pe(["article","channel"],"education"),ut.pe(["b_site_section"],"education")]),ut.ge(2)),12096e5)),41372:ut.q(ut.cw("PageviewEngagement",ut.pg(["engaged_time"],2),ut.ge(1))),41375:ut.q(ut.cw("Pageview",ut.o([ut.ps(["b_site_subsec1"],"drivers-world-championship"),ut.os(ut.s,["article","title"],["f1","motorsport","formula_1","formula_one"])]),ut.ge(1))),41376:ut.q(ut.cw("Pageview",ut.a([ut.o([ut.os(ut.s,["client","user_agent"],["iOs","safari"])]),ut.nt(ut.ps(["client","user_agent"],"chrome"))]),ut.ge(1))),41412:ut.q(ut.cw("PageviewEngagement",ut.o([ut.os(ut.s,["article","sectn"],["future-planet","science-environment"]),ut.pc(["article","gsChannels"],"gs_science_environ"),ut.os(ut.s,["article","name"],["environment","climate","climate change"])]),ut.ge(1))),41413:ut.q(ut.cw("Pageview",ut.o([ut.ps(["article","sectn"],"coronavirus"),ut.os(ut.s,["b_site_subsec1"],["coronavirus","lockdown"]),ut.os(ut.e,["article","title"],["coronavirus","lockdown","covid19"]),ut.pc(["article","gsChannels"],"bbc_coronavirus")]),ut.ge(1))),41414:ut.q(ut.cw("SlotClicked",ut.t,ut.ge(1))),47270:ut.q(ut.acq(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit1"],"bbccom.live.site.capital"),ut.ps(["b_app_name"],"worklife"),ut.os(ut.s,["b_site_channel"],["capital","worklife"]),ut.ps(["bbc_site"],"worklife"),ut.os(ut.s,["article","channel"],["capital","worklife"]),ut.ps(["article","prod_name"],"worklife"),ut.os(ut.s,["client","url"],["capital","worklife","business"]),ut.pe(["client","url"],"bbc.com/business"),ut.pe(["dfp_adUnit2"],"news_business_content"),ut.pe(["b_site_section"],"business"),ut.pe(["article","sectn"],"business")]),ut.ge(2)),12096e5),ut.cw("Pageview",ut.pe(["geo_info","country"],"United States"),ut.ge(1)))),47271:ut.q(ut.acq(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit1"],"bbccom.live.site.capital"),ut.ps(["b_app_name"],"worklife"),ut.os(ut.s,["b_site_channel"],["capital","worklife"]),ut.ps(["bbc_site"],"worklife"),ut.os(ut.s,["article","channel"],["capital","worklife"]),ut.ps(["article","prod_name"],"worklife"),ut.os(ut.s,["client","url"],["capital","worklife","business"]),ut.pe(["client","url"],"bbc.com/business"),ut.pe(["dfp_adUnit2"],"news_business_content"),ut.pe(["b_site_section"],"business"),ut.pe(["article","sectn"],"business")]),ut.ge(2)),12096e5),ut.cw("Pageview",ut.o([ut.os(ut.e,["geo_info","province"],["New York","New Jersey","Florida","Massachusetts"])]),ut.ge(1)))),47784:ut.q(ut.acq(ut.tw(ut.cw("Pageview",ut.o([ut.pe(["dfp_adUnit1"],"bbccom.live.site.capital"),ut.ps(["b_app_name"],"worklife"),ut.os(ut.s,["b_site_channel"],["capital","worklife"]),ut.ps(["bbc_site"],"worklife"),ut.os(ut.s,["article","channel"],["capital","worklife"]),ut.ps(["article","prod_name"],"worklife"),ut.os(ut.s,["client","url"],["capital","worklife","business"]),ut.pe(["client","url"],"bbc.com/business"),ut.pe(["dfp_adUnit2"],"news_business_content"),ut.pe(["b_site_section"],"business"),ut.pe(["article","sectn"],"business")]),ut.ge(2)),12096e5),ut.cw("Pageview",ut.o([ut.os(ut.e,["geo_info","province"],["California","Washington"])]),ut.ge(1))))}||{};var ut;let ot={getCurrentTime:()=>new Date,getCurrentSession:()=>"",getCurrentView:()=>"",getSegments:()=>({}),getLookalikeModels:()=>({}),setSegmentActivation:()=>{}};he()((function(n){switch(n.type){case"bootstrap":return at(n.stateMap,...n.payload);case"updateEnvironment":return ct(n.stateMap,...n.payload);case"process":return st(n.stateMap,...n.payload);case"migrate":return ft(...n.payload)}}));const at=(n,e,t,r,i)=>{ot={getCurrentTime:()=>new Date,getCurrentSession:()=>r.sessionId,getCurrentView:()=>r.viewId,getSegments:()=>r.segments,getLookalikeModels:()=>r.lookalikeModels,setSegmentActivation:(n,e)=>{}};const u=rt(e,(e,[t,r,i])=>{var u;return(null===(u=n[e])||void 0===u?void 0:u.checksum)===t?sn:ln({checksum:t,is_segment:r.indexOf("s")>-1,id:i,state:null,result:it[e].interpret(null,ot),activations:{}})}),o=st(u,t,i);return{stateMap:Object.assign(Object.assign({},n),o.stateMap),errors:o.errors}},ct=(n,e,t,r=!0)=>{const i=t.segments?ot.getSegments():{};return ot=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},ot),t.viewId?{getCurrentView:()=>t.viewId}:{}),t.sessionId?{getCurrentSession:()=>t.sessionId}:{}),t.lookalikeModels?{getLookalikeModels:()=>t.lookalikeModels}:{}),t.segments?{getSegments:()=>Object.assign(Object.assign({},i),t.segments),setSegmentActivation:pt(n)}:{}),r?lt(n,e,{}):{stateMap:n,errors:[]}},st=(n,e,t)=>t.reduce(({stateMap:n,errors:t},r)=>{const i=lt(n,e,r);return{stateMap:i.stateMap,errors:t.concat(i.errors)}},{stateMap:n,errors:[]}),lt=(n,e,t)=>{const r=V,i=(n=>n.reduce((n,e)=>Object.assign(Object.assign({},n),{[e]:!0}),{}))((n=>Object.entries(n).filter(([n,e])=>{var t;return!0===(null===(t=e.result)||void 0===t?void 0:t.result)}).map(([n,e])=>parseInt(n,10)))(n)),u=ct(n,e,{segments:{"1p":i}},!1),a=u.stateMap,c=u.errors,f=rt(a,(n,i)=>{return ce(s(()=>((n,i)=>{const u=it[n],o=u.lift(t,ot),a=ce(le(i.state),l(r)),c=ce(le(o),l(r),n=>tt(a,n)),s=tt(c,e[n]?ce(le(e[n]),l(r)):r());return Object.assign(Object.assign({},i),{state:se(c),result:u.interpret(se(s),ot)})})(n,i),e=>`Failed to interpret query ${n}. Got ${e}`),(u=n=>({errors:[n],queryState:i}),a=n=>({errors:[],queryState:n}),function(n){return o(n)?u(n.left):a(n.right)}),ln);var u,a}),{queryState:p,errors:d}=Object.entries(f).reduce((n,[e,{errors:t,queryState:r}])=>({errors:n.errors.concat(t),queryState:Object.assign(Object.assign({},n.queryState),{[e]:r})}),{errors:[],queryState:{}});return{stateMap:p,errors:d.concat(c)}},ft=(n,e)=>({stateMap:rt(e,(e,t)=>{var r;const i=it[e],u=s(()=>i.migrate(t.state),n=>String(n)),o=ce(u,l(n=>null));return o&&(null===(r=null==n?void 0:n[e])||void 0===r?void 0:r[0])===t.checksum?ln(Object.assign(Object.assign({},t),{state:o})):sn}),errors:[]}),pt=n=>(e,t,r)=>{var u;return ce(null===(u=n[r])||void 0===u?void 0:u.activations,n=>i(e in n,n),([n,r])=>r[e]=n?ie(Ne)(r[e],[t]):[t])}}]);',"Worker",void 0,void 0)},a=n(3),u=n(24),c=n.n(u),l=n(7),d=n(11),f=n(14),_=n(2),h=n(16),p=n(6),m=n(13),g=n(0),b=n(4);class v{constructor(e,t){this._internals=e,this.permutive=t,this.CACHED_SEGMENTS_STORAGE_KEY="_psegs",this.queryMetadata={39204:["0c8b70cdb7",["s"],"21503455-1ac3-418c-ade2-9897dc71a4a2"],39372:["6124f27bc1",["s"],"27ed4533-c5ab-47a3-b288-7e3ac7e20f2d"],40285:["e91d955522",["s"],"df4ec715-f349-4461-867d-8c29ef893e4e"],40286:["b9066cef8c",["s"],"0b2701a0-5439-4f0e-828c-a86b7da9f213"],40289:["24cfaf65b1",["s"],"7a51a16b-cd69-4260-af7a-2184c47ff149"],40292:["9ab69d210a",["s"],"f2253fc9-6126-4e84-a92e-3195ec882086"],40294:["1fa3ae0609",["s"],"363b17a4-8f0d-416b-909c-015d6d8e79a4"],41372:["809c857cf5",["s"],"578125c4-79d9-47f6-b33f-1d16eee4e5c6"],41375:["bc958554e1",["s"],"e3dd5ad9-ea06-4b74-84e1-6e42fd5f8f62"],41376:["4bd77cc3a7",["s"],"f59ff80c-d5cf-4f76-be0b-3feb4bc35056"],41412:["e308408c6d",["s"],"42f1c2ef-492a-41b3-878f-90694174b039"],41413:["de1d0cc309",["s"],"963c3a9e-c55e-444e-a155-e06120e4f294"],41414:["d2f664deef",["s"],"e48eeb36-67ec-40bf-857b-d5d9b0402833"],47270:["e91d955522",["s"],"3378a7d3-52fa-4a90-907b-16c9d693019f"],47271:["3905a89006",["s"],"78d689ec-258a-4882-914a-6d91fcd2d849"],47784:["e399893d92",["s"],"1ef9fc75-b083-4287-a881-302a998b72c2"]},this.isWorkerReady=!1,this.extStateMap={},this.userSegments=[],this.userSegmentsMap={},this.segmentTransitionEdgeOnly="boolean"==typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only&&{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only,this.segmentEntryQueryCodes=new Set,this.segmentExitQueryCodes=new Set;const n=this._internals.getExternalData(this.CACHED_SEGMENTS_STORAGE_KEY);this.userSegments=(JSON.parse(n)||[]).filter(e=>Object(m.c)(e,this.queryMetadata)),this.userSegmentsMap=Object(m.e)(this.userSegments);const i=this._internals.state.getPermutiveData("internal_query_states")||{},s=this._internals.state.getPermutiveData("external_query_states")||{},a=Object(r.d)(i,e=>{var t;return Object(m.c)(e,this.queryMetadata)&&(null===(t=i[e])||void 0===t?void 0:t.checksum)===this.queryMetadata[e][0]});this.extStateMap=Object(r.d)(s,e=>Object(m.c)(e,this.queryMetadata)),this._internals.state.setPermutiveData("external_query_states",this.extStateMap),this.stateMap={value:a,promise:Promise.resolve(a)},this.worker=new c.a(new o)}bootstrap(e){return this.migrateIfRequired(e).then(([e,t,n])=>this.postMessage({type:"bootstrap",payload:[this.queryMetadata,this.extStateMap,{segments:Object.assign({"1p":this.userSegmentsMap},t),sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:n},e]}))}updateEnvironment(e){return this.postMessage({type:"updateEnvironment",payload:[this.extStateMap,e]})}process(e){return this.postMessage({type:"process",payload:[this.extStateMap,e]})}updateExternalState(e){const t=Object(r.j)(e,(e,t)=>{const n=this.queryMetadata[e][0];return t[n]?Object(g.c)(Object(f.a)(t[n])):g.n}),n=Object(r.j)(this.extStateMap,(e,t)=>Object(g.c)(Object(f.a)(t))),i=Object(r.j)(Object.assign(Object.assign({},n),t),(e,t)=>n[e]?Object(g.o)(Object(f.b)(Object(h.b)(t,n[e]))):Object(g.o)(Object(f.b)(t)));this._internals.state.setPermutiveData("external_query_states",i),this.extStateMap=i}postMessage(e){return this.stateMap.promise=this.stateMap.promise.then(t=>this.worker.postMessage(Object.assign(Object.assign({},e),{stateMap:t}))).then(({stateMap:e,errors:t})=>this.onStateChange(e,t)).catch(e=>(this._internals.network.error("Error during query execution. Got "+e,this._internals.state.userId),this.stateMap.value))}onStateChange(e,t){return Object(p.a)(t.length>0?this._internals.network.error("QL error(s). Got "+t.join("; "),this._internals.state.userId):{},t=>this.stateMap.value=e,e=>this.isWorkerReady?this.onStateChangeReady(e):e)}onStateChangeReady(e){const t=Object(m.d)(e),n=[...Object(l.c)(d.c)(t,this.userSegments).map(t=>[t,!0,e[t].id]),...Object(l.c)(d.c)(this.userSegments,t).map(t=>[t,!1,e[t].id])];return this.userSegments=t,this.userSegmentsMap=Object(m.e)(t),this._internals.log("Writing new segment and query state cache",e),this._internals.setExternalData(this.CACHED_SEGMENTS_STORAGE_KEY,JSON.stringify(this.userSegments)),this._internals.state.setPermutiveData("internal_query_states",e),n.forEach(([e,t,n])=>{this.trackTransition(t,n,e),this._internals.messages.emit("permutive:query:changed",{queryCode:e,result:{result:t}})}),Object(p.a)(n.length>0,e=>e?this._internals.messages.emit("permutive:segments:updated"):{},t=>e)}migrateIfRequired(e){const t=this._internals.state.getPermutiveData("query_states"),n=this._internals.metrics.startTimer("sdk_direct_state_migration_seconds",{}),i=()=>this.worker.postMessage({type:"migrate",payload:[this.queryMetadata,Object(r.d)(t,e=>Object(m.c)(e,this.queryMetadata))],stateMap:{}}).then(r=>this.onStateMigrateSuccess(t,e,r.stateMap,n)).catch(t=>this.onStateMigrateError(e,t)),s=()=>this._internals.api.migrateOutOfSDKEvents(this._internals.state.userId,e.map(e=>e.id).filter(e=>e)).catch(e=>this._internals.network.error("Error migrating out-of-SDK events. Got "+String(e),this._internals.state.userId));return t?(()=>Promise.all([this._internals.thirdParty.segments(),this._internals.models.getModels(),i(),s()]).then(([e,t,n,r])=>Object(b.g)(n,e,t)))():Promise.resolve([e,{},{}])}onStateMigrateSuccess(e,t,n,i){this._internals.metrics.stopTimer("sdk_direct_state_migration_seconds",i),this._internals.log("Beginning migration. Migrated query state is",n);const s=Object(m.a)(t,100);return(n=>{const i=this._internals.metrics.startTimer("sdk_cache_replay_migration_seconds",{});return this.worker.postMessage({type:"bootstrap",payload:[this.queryMetadata,{},{segments:{"1p":this.userSegmentsMap},sessionId:this._internals.sessionManager.getSessionId(),viewId:this._internals.state.viewId,lookalikeModels:{}},s],stateMap:{}}).then(s=>{this._internals.metrics.stopTimer("sdk_cache_replay_migration_seconds",i);const o=s.stateMap;this._internals.log("Recreated state via events cache. Got",o);const u=e=>Object(p.a)(Object(r.j)(e,(e,t)=>t.state?Object(g.o)(t.state):g.n),f.a,Object(a.j)(e=>(this._internals.network.error("Failed to decode state. Got "+e,this._internals.state.userId),Object(_.l)(new Map)))),c=u(o),l=u(n),d=Object(p.a)(Object(a.t)(()=>Object(h.b)(l,c),e=>"Failed to join migrated state and state recreated via the events cache. Got "+e),Object(a.j)(e=>Object(p.a)(this._internals.network.error(e,this._internals.state.userId),()=>l)),e=>Object(f.b)(e)),b=Object.entries(e).filter(([e,t])=>Object(m.c)(e,this.queryMetadata)).map(([e,t])=>[e,Object.assign(Object.assign({},t),{state:null})]),v=Object(r.m)(...b);this.stateMap.value=v,this.stateMap.promise=Promise.resolve(this.stateMap.value),this._internals.log("Sending full picture of legacy state to state/legacy/ ",d),this._internals.log("Purging events cache. Current cache is ",t);const y=Object(r.j)(this.queryMetadata,(e,[t])=>(null==d?void 0:d[e])?Object(g.o)({[t]:d[e]}):g.n);return Promise.all([this._internals.api.state(y,0,!1,!1,!0),this._internals.state.eventsCache.reset()]).then(n=>{const r=this.filterCacheAndFlush(t);this._internals.log("Purged cache. New cache is ",r),this._internals.state.setPermutiveData("query_states",null);const i=d?Object(a.t)(()=>this.updateExternalState(y),e=>String(e)):Object(a.r)(null);return Object(a.m)(i)?Object(p.a)(i.left,t=>this._internals.network.error(`\n                  Failed to store migrated state.\n                  Old state was ${JSON.stringify(e)}.\n                  New state was ${JSON.stringify(d)}.\n                  Error was ${t}\n                `,this._internals.state.userId),e=>this._internals.log("Migration failed. Check network tab"),e=>r):Object(p.a)(this._internals.log("Migration completed successfully"),e=>[])})})})(n).catch(e=>this.onStateMigrateError(t,e))}onStateMigrateError(e,t){return this._internals.log("Migration failed. Check network tab"),this._internals.network.error("Exception during migration process. Got "+t,this._internals.state.userId),this._internals.state.eventsCache.reset().then(t=>Object(p.a)(this._internals.state.setPermutiveData("query_states",null),t=>this.filterCacheAndFlush(e)))}filterCacheAndFlush(e){const t=Object(m.b)(e,"web",window.location.hostname),n=t.length;return t.forEach((e,t)=>this._internals.state.eventsCache.add(e,{persistOnDisk:t===n-1})),t}trackTransition(e,t,n){const r=Object.assign({segment_id:t,segment_number:n},{});e?this.segmentEntryQueryCodes.add(n):this.segmentExitQueryCodes.add(n),this.permutive.track(e?"SegmentEntry":"SegmentExit",r,{isMemoryOnly:this.segmentTransitionEdgeOnly})}reset(){this._internals.removeExternalData(this.CACHED_SEGMENTS_STORAGE_KEY),this._internals.state.setPermutiveData("internal_query_states",{}),this._internals.state.setPermutiveData("external_query_states",{}),this.userSegments=[],this.userSegmentsMap={},this.stateMap={value:{},promise:Promise.resolve({})},this.extStateMap={}}setAsReady(){this.isWorkerReady=!0,this.onStateChangeReady(this.stateMap.value),this._internals.messages.emit("permutive:queries:initialised")}getStateSizeInBytes(){return 2*JSON.stringify(this.stateMap.value).length}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(5);class i{constructor(e,t){this.userId=e,this.aliases=t,this.resource="userTPD",this.query=()=>{const e=this.aliases.map(({id:e,tag:t,priority:n})=>`{id: "${e}", tag: "${t}", priority: ${n}}`).join(",");return`\n      userTPD: user(user_id: "${this.userId}") {\n        identity(aliases: [${e}]) {\n          tpd {\n            name\n            segments\n          }\n        }\n      }\n    `}}}var s=n(11),o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const a={permutive:"1",eyeota:"2",skimlinks:"4",comscore:"5",eyeota_bombora:"6",eyeota_aimmatic:"7",eyeota_alc:"8",eyeota_amberdata:"9",eyeota_caci:"10",eyeota_corelogic:"11",eyeota_dlg:"12",eyeota_dataxpand:"13",eyeota_dunbradstreet:"14",eyeota_experian:"15",eyeota_gbgtransactis:"16",eyeota_gfk:"17",eyeota_rdaresearch:"18",eyeota_kantarmedia:"19",eyeota_mastercard:"20",eyeota_meritdirect:"21",eyeota_netsprint:"22",eyeota_nri:"23",eyeota_onaudience:"24",eyeota_pacificdatapartners:"25",eyeota_plungedigital:"26",eyeota_roymorgan:"27",eyeota_schober:"28",eyeota_sharethis:"30",eyeota_skimlinks:"31",eyeota_specialists:"32",eyeota_statsocial:"33",eyeota_stirista:"34",eyeota_yougov:"36"};class u{constructor(e,t,n){this._internals=e,this.permutive=t,this.network=n;const r=this._internals.state.getPermutiveData("third-party-data");this.userSegments=this.isValidState(r)?r:{},this.lastCheckedSession=this._internals.state.getPermutiveData("third-party-data-session-id")||""}segments(){if(this.segmentsPromise)return this.segmentsPromise;const e=this._internals.sessionManager.getSessionId();if(this.lastCheckedSession===e)return Promise.resolve(this.userSegments);const t=Object(r.b)();this.lastCheckedSession=e;const n=this._internals.metrics.startTimer("sdk_get_third_party_data_task_duration_seconds",{}),o=Object.assign(Object.assign({},this._internals.identities.getIdentities(!0)),this._internals.identities.aliases);if(Object.keys(o).length>0){const e=new i(this._internals.state.userId||Object(r.o)(),this._internals.identities.aliasMapToPrioritizedList(o));this._internals.graphql.register(e).then(e=>{const n=this.graphQLTPDResponseToSegmentMap(e);this.updateCache(n),t.resolve(n)}).catch(e=>{this.network.error("Third Party Data segments retrieval failed with reason: "+e,this._internals.state.userId),t.resolve({})})}else t.resolve({});const a=this._internals.promises.getPromisesByCategory("tpd"),u=Promise.all(a.map(e=>e.promise)).then(e=>t.promise).then(e=>this.userSegments);return u.then(t=>{this._internals.state.setPermutiveData("third-party-data-session-id",e),this._internals.metrics.stopTimer("sdk_get_third_party_data_task_duration_seconds",n);const i=this._internals.state.getPermutiveData("third-party-data");i&&Object(r.c)(Object(r.c)(s.b)).equals(i,t)||(this._internals.state.setPermutiveData("third-party-data",this.userSegments),Object.entries(t||{}).forEach(([e,t])=>{i&&Object(r.c)(s.b).equals(i[e],t)||this.fireSegments(e,Object.keys(t))}))}),this.segmentsPromise=u,this.segmentsPromise}addSegments(e,t){this.updateCache({[e]:this.listToSegmentMap(t)})}getActivationMetadata(){const e=this.tpdUsage(this._internals.queryManager.stateMap.value),t={};for(const n in e)if(e.hasOwnProperty(n)){const r=[],i=Object.assign({},e[n]);Object.keys(i).forEach(e=>{i[e].forEach(t=>{r.push([n,a[e],t].join("-"))})}),t[n]=r}return t}updateCache(e){this.userSegments=Object(r.k)(this.userSegments,e)}fireSegments(e,t){this.permutive.track("ThirdPartySegments",{data_provider:e,segments:t},{isAnalyticsOnly:!0})}reportUsage(){const e=this.tpdUsage(this._internals.queryManager.stateMap.value),t=Object(r.f)(JSON.stringify(e));if(this._internals.state.getPermutiveData("third-party-data-usage")!==t&&Object.keys(e).length>0){this._internals.state.setPermutiveData("third-party-data-usage",t);const n={user_id:this._internals.state.userId,time:new Date,tpd_segments:e};this._internals.api.tpdUsage(n)}}graphQLTPDResponseToSegmentMap(e){return e.identity.tpd.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:this.listToSegmentMap(t.segments)}),{})}listToSegmentMap(e){return e.reduce((e,t)=>(e[t]=!0,e),{})}isValidState(e){return void 0===(null==e?void 0:e.expiry_time)}tpdUsage(e){const t={},n=Object.keys(e),r=n.length;for(let i=0;i<r;i++){const r=n[i],s=e[r],{activations:a}=s;o(s,["activations"]);Object.keys(a).length>0&&(t[r]=a)}return t}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"canRun",(function(){return canRun})),__webpack_require__.d(__webpack_exports__,"getTag",(function(){return getTag})),__webpack_require__.d(__webpack_exports__,"makeConfig",(function(){return makeConfig})),__webpack_require__.d(__webpack_exports__,"hasConsent",(function(){return hasConsent}));var _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(20),_core_state_PermutiveState__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(28),_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5),_core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(15),_core_internals_PermutiveInternals__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(29),_core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(17),_PermutiveMethods__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(30),_http_graphql_GraphQLIdentify__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(21),_Config__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(22),_core_queries_QueryManager__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(31),fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(0),fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(3),fp_ts_es6_Apply__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(27),fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6),fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(7),fp_ts_es6_Eq__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(11),fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9),fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(10),fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(4),_core_third_party_PermutiveThirdParty__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(32),_core_state_PermutiveStateSync__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(25),_http_graphql_GraphQLOutOfSDKEvents__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(26);const sdkInitTimestamp=window.performance.now(),canRun=e=>{const t="function"==typeof e.Map?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(new e.Map([["a",1]])):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Maps not supported"),n="function"==typeof e.Set?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(new e.Set([1,2])):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Sets not supported"),r=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.d)(e=>1===e.size?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Iterable Maps not supported"))(t),i=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.d)(e=>2===e.size?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("Iterable Sets not supported"))(n),s=e.Worker&&e.Blob?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(null):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("WebWorkers not supported"),o=["QuotaExceededError","QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED"],a=Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.t)(()=>{e.localStorage.setItem("_permutive_ls_test","_permutive_ls_test"),e.localStorage.removeItem("_permutive_ls_test")},t=>e.localStorage&&0===e.localStorage.remainingSpace||o.some(e=>-1!==String(t).indexOf(e))?"localStorage quota exceeded":"localStorage not supported");return Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_Apply__WEBPACK_IMPORTED_MODULE_12__.a)(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.e)(r,i,a,s),t=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.f)(t=>e)(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.b)(t)))},getTag=e=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.g)("Can't find permutive tag on the page")(e.permutive),fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.b),makeConfig=e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(Object.assign(Object.assign({},e),{config:Object(_Config__WEBPACK_IMPORTED_MODULE_8__.a)(e.config)})),makeNetwork=e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)([e,new _http_PermutiveNetwork__WEBPACK_IMPORTED_MODULE_0__.a(e.config)]),validateConsentThenCache=e=>"object"==typeof e&&Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(window.localStorage.setItem("permutive-consent",JSON.stringify(e)),t=>{var n;return e.opt_in&&(null===(n=e.token)||void 0===n?void 0:n.length)>0}),consentThenInit=e=>t=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(validateConsentThenCache(t),t=>t?init(e)():null),hasConsent=e=>{const[t,n]=e;window.permutive.consent=consentThenInit(e);const r=Object(fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__.f)(fp_ts_es6_Eq__WEBPACK_IMPORTED_MODULE_15__.d)("e488cdb0-e7cb-4d91-9648-60d437d8e491",["fe68d1f7-c9f4-45b3-8905-7cda73d3fd74"]),i=Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(e=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.d)(e=>Object(fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__.h)(!1))(r?Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.h)(()=>n.req({url:n.getEndpointUrl("/geoip"),method:"GET"},!1).then(e=>"Israel"===Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.i)(e,"geo_info","country")&&validateConsentThenCache({opt_in:!0,token:"whitelisted-geo"})),e=>n.error("Failed to retrieve geo location information required for consent. Got "+e)):Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(!t.config.consentRequired)))(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.c)(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c)((()=>{const e=JSON.parse(window.localStorage.getItem("permutive-consent"));return e?Object(fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.o)(validateConsentThenCache(e)):fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.n})())))(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.c)(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c)((()=>{const e=Object(fp_ts_es6_Array__WEBPACK_IMPORTED_MODULE_14__.g)(e=>"consent"===e.functionName)(t.q);return Object(fp_ts_es6_Option__WEBPACK_IMPORTED_MODULE_10__.m)(e=>validateConsentThenCache(e.arguments[0]))(e)})()));return Object(fp_ts_es6_Task__WEBPACK_IMPORTED_MODULE_17__.g)(e=>e?Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.r)(Object(fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.g)(t,n)):Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.o)("No consent to run on the page"))(i)},init=tagAndNetwork=>Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.h)(()=>{window.permutive.consent=validateConsentThenCache;const[tag,network]=tagAndNetwork,context=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)(tag.context||{},{path:window.location.pathname,url:window.location.href,referrer:document.referrer}),_internals=new _core_internals_PermutiveInternals__WEBPACK_IMPORTED_MODULE_4__.a(tag.config,network),permutiveMethods=new _PermutiveMethods__WEBPACK_IMPORTED_MODULE_6__.a(_internals,network,context);_internals.state=new _core_state_PermutiveState__WEBPACK_IMPORTED_MODULE_1__.a(_internals,permutiveMethods,context),_internals.stateSync=new _core_state_PermutiveStateSync__WEBPACK_IMPORTED_MODULE_20__.a(_internals),_internals.queryManager=new _core_queries_QueryManager__WEBPACK_IMPORTED_MODULE_9__.a(_internals,permutiveMethods),_internals.thirdParty=new _core_third_party_PermutiveThirdParty__WEBPACK_IMPORTED_MODULE_19__.a(_internals,permutiveMethods,network),_internals.identities=new _core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__.a(_internals,permutiveMethods,network);const isMetricsUser=_internals.state.getPermutiveData("metricsEnabled");_internals.metrics=!0===isMetricsUser?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.a(sdkInitTimestamp,_internals,permutiveMethods):!1===isMetricsUser?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.b:Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Math.random()<=_internals.config.metricsSamplingPercentage/100,e=>[_internals.state.setPermutiveData("metricsEnabled",e),e],([e,t])=>t?new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.a(sdkInitTimestamp,_internals,permutiveMethods):new _core_metrics_PermutiveMetrics__WEBPACK_IMPORTED_MODULE_5__.b);const permutiveShell=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)(tag,{consent:window.permutive.consent},{q:window.permutive.q},{context:context},{addons:_internals.addons});[].forEach(s=>{try{eval(s)}catch(e){network.error(Object.assign(Object.assign({},e),{message:"Error running custom script "+s}),_internals.state.userId)}}),_internals.addBlocker("permutive:queries:initialised"),_internals.messages.on("permutive:blockers:empty",()=>{const e=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)(permutiveShell,{identify:permutiveMethods.identify.bind(permutiveMethods),on:permutiveMethods.on.bind(permutiveMethods),once:permutiveMethods.once.bind(permutiveMethods),track:permutiveMethods.track.bind(permutiveMethods),trigger:permutiveMethods.trigger.bind(permutiveMethods),query:permutiveMethods.query.bind(permutiveMethods),segment:permutiveMethods.segment.bind(permutiveMethods),segments:permutiveMethods.segments.bind(permutiveMethods),reset:permutiveMethods.reset.bind(permutiveMethods),ready:permutiveMethods.ready.bind(permutiveMethods),addon:permutiveMethods.addon.bind(permutiveMethods)});window.permutive=Object.assign(Object.assign({},e),{q:[]}),_internals.setAsReady();const t=["identify","trigger","addon","track"];permutiveShell.q.filter(e=>"consent"!==e.functionName).sort((e,n)=>{const r=t.indexOf(e.functionName),i=t.indexOf(n.functionName);return-1===r?-1===i?0:1:-1===i?-1:r-i}).forEach(t=>{t.functionName in e?e[t.functionName].apply(permutiveMethods,t.arguments):network.error(`Function "permutive.${t.functionName}" does not exist.`,_internals.state.userId)})});const loadAddon=e=>e.load(permutiveShell.q,permutiveMethods,_internals,network),addons=[Promise.resolve().then(__webpack_require__.bind(null,34)),Promise.resolve().then(__webpack_require__.bind(null,35)),Promise.resolve().then(__webpack_require__.bind(null,36)),Promise.resolve().then(__webpack_require__.bind(null,37))];addons.forEach(e=>e.then(loadAddon));const registerEnricher=e=>e.register(_internals,permutiveShell.context,permutiveShell.config),enrichers=[Promise.resolve().then(__webpack_require__.bind(null,38))];enrichers.forEach(e=>e.then(registerEnricher));const registerCloudSegments=e=>e.register(_internals,permutiveShell.context,permutiveShell.config),cloudSegmentsModules=[];cloudSegmentsModules.forEach(e=>e.then(registerCloudSegments));const aliasesMap=_internals.identities.aliases,graphQLIdentify=()=>{const e=Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.b)(),t=()=>permutiveShell.q.findIndex(e=>"identify"===e.functionName);let n=t();for(;n>-1;){const e=permutiveShell.q.splice(n,1)[0];_internals.identities.getAliasesFromIdentifyArg(e.arguments[0]).forEach(e=>_internals.identities.setAlias(e.id,e.tag)),n=t()}const r=_internals.state.userId,i=new _http_graphql_GraphQLIdentify__WEBPACK_IMPORTED_MODULE_7__.a(r,_internals.identities.aliasMapToPrioritizedList(aliasesMap));return _internals.graphql.register(i).then(t=>(t=>{const n=_internals.identities.aliases,i=t.user_id;i!==r?(_internals.log("Got different user id from API: "+i),_internals.state.reset().then(e=>Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(_internals.state.setUserId(i),e=>Object.entries(n).forEach(([e,t])=>_internals.identities.setAlias(t,e)),e=>_internals.state.eventsCache.reset())).then(t=>e.resolve({identityChanged:!0,userId:i}))):e.resolve({identityChanged:!1})})({user_id:t.identity.identify.id})).catch(t=>{network.error(`Couldn't set identity for user ${r}. Got ${t}`,r),e.resolve({identityChanged:!1})}),_internals.log("Starting identification... Current aliases are:",aliasesMap),e.promise.then(e=>{_internals.messages.emit("permutive:user:ready"),_internals.log("<done> init identity ",e)}),e.promise},onIdentityChanged=()=>(_internals.log("Identity has changed"),_internals.stateSync.resetSync()),onIdentityRemained=e=>(_internals.log("Identity hasn't changed, got these unseen out-of-SDK events",e),_internals.state.eventsCache.loadFromDisk().then(t=>{_internals.log("Loaded local event cache",t);const n=_internals.state.eventsCache.processUnseenEvents(e);return _internals.queryManager.bootstrap(t).then(()=>_internals.queryManager.process(n))})),resetOrDoNothing=()=>Object(_core_identity_PermutiveIdentities__WEBPACK_IMPORTED_MODULE_3__.b)("e488cdb0-e7cb-4d91-9648-60d437d8e491",_internals.identities.aliasMapToPrioritizedList(aliasesMap).map(e=>e.id),window.location.hostname,_internals.state.userId)?permutiveMethods.reset():Promise.resolve();return resetOrDoNothing().then(()=>_internals.identities.prepareThirdPartyIdentities()).then(e=>{_internals.thirdParty.segments();const t=graphQLIdentify(),n=_internals.graphql.register(new _http_graphql_GraphQLOutOfSDKEvents__WEBPACK_IMPORTED_MODULE_21__.a(_internals.state.userId));return _internals.graphql.run(),Promise.all([t,n]).catch(e=>[{identityChanged:!1},{out_of_sdk_events:[]}]).then(([e,t])=>e.identityChanged?onIdentityChanged():onIdentityRemained(t.out_of_sdk_events))}).then(()=>(permutiveShell.context.user_id=_internals.state.userId,Promise.all([_internals.thirdParty.segments(),_internals.models.getModels()]).then(([e,t])=>(_internals.log("Loaded TPD segments and lookalike models",e,t),_internals.queryManager.updateEnvironment({segments:Object(_utils_PermutiveUtils__WEBPACK_IMPORTED_MODULE_2__.k)({"1p":_internals.queryManager.userSegmentsMap},e),lookalikeModels:t}))))).then(()=>{_internals.queryManager.setAsReady(),_internals.messages.emit("permutive:api:ready"),_internals.metrics.track({name:"sdk_local_storage_byte_total",value:_internals.state.getStateSizeInBytes(),labels:{}}),_internals.metrics.track({name:"sdk_query_states_byte_total",value:_internals.queryManager.getStateSizeInBytes(),labels:{}})})},e=>"Exception during initialisation. Got "+e),initialisationSequence=Object(fp_ts_es6_pipeable__WEBPACK_IMPORTED_MODULE_13__.a)(Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.g)(window),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(canRun),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(getTag),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(makeConfig),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(makeNetwork),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(hasConsent),Object(fp_ts_es6_TaskEither__WEBPACK_IMPORTED_MODULE_16__.a)(init));initialisationSequence().then(Object(fp_ts_es6_Either__WEBPACK_IMPORTED_MODULE_11__.f)(e=>console.warn("Permutive was not initialized. "+e),fp_ts_es6_function__WEBPACK_IMPORTED_MODULE_18__.c))},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return a})),n.d(t,"DFPAddon",(function(){return u}));var r=n(5),i=n(7),s=n(11);const o={},a=(e,t,n)=>{e.push({functionName:"addon",arguments:["dfp",{}]}),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push((function(){t.ready(n.makeSafe(()=>{let e=0;googletag.pubads&&googletag.pubads().getSlots&&googletag.pubads().getSlots().length>0&&googletag.pubads().getSlots().forEach((function(t){t.getResponseInformation()&&e++}));const t=0===e?"sdk_targeting_realtime_success_count":"sdk_targeting_realtime_fail_count";n.metrics.track({name:t,value:1,labels:{target:"dfp"}})}),"realtime");const e=function(){const e=n.getExternalData("_pdfps");return e?JSON.parse(e):[]}();googletag.cmd.push((function(){googletag.pubads().setTargeting("permutive",e.map(String))}));const i=function(e){const t={ad_unit_path:e.getAdUnitPath(),slot_element_id:e.getSlotElementId(),targeting_keys:[]},n={},r=e.getTargetingKeys();for(let i=0;i<r.length;i++){const s=r[i],o=[],a=e.getTargeting(s);for(let e=0;e<a.length;e++)o.push(a[e].toString());o.length>0&&(n[s]=1,t.targeting_keys.push({key:s,value:o}))}const i=googletag.pubads().getTargetingKeys();for(let e=0;e<i.length;e++){const r=i[e],s=[];if(void 0===n[r]){const n=googletag.pubads().getTargeting(i[e]);for(let e=0;e<n.length;e++)s.push(n[e].toString());s.length>0&&t.targeting_keys.push({key:r,value:s})}}return t},s=function(e){try{let n=!1;window.addEventListener("blur",(function(){if(n){const n=o[e];n&&t.track("SlotClicked",n)}})),document.getElementById(e).addEventListener("mouseover",(function(){n=!0})),document.getElementById(e).addEventListener("mouseout",(function(){n=!1}))}catch(e){}};googletag.pubads&&googletag.pubads().getSlots&&googletag.pubads().getSlots().forEach((function(e){const t=e.getResponseInformation();if(t){const n=e.getSlotElementId(),a={advertiser_id:Object(r.l)(t.advertiserId),campaign_id:Object(r.l)(t.campaignId),line_item_id:Object(r.l)(t.lineItemId),creative_id:Object(r.l)(t.creativeId),is_empty:!1,service_name:"publisher_ads",slot:i(e)};o[n]=a,s(n)}})),googletag.cmd.push((function(){googletag.pubads().addEventListener("slotRenderEnded",(function(e){const t=e,n=t.slot.getSlotElementId(),a={advertiser_id:Object(r.l)(t.advertiserId),campaign_id:Object(r.l)(t.campaignId),line_item_id:Object(r.l)(t.lineItemId),creative_id:Object(r.l)(t.creativeId),is_empty:t.isEmpty,service_name:t.serviceName,slot:i(e.slot)};if(t.size){const[e,n,...r]=t.size;"number"==typeof e&&"number"==typeof n&&(a.width=e,a.height=n)}o[n]=a,s(n)})),googletag.pubads().addEventListener("impressionViewable",(function(e){const n=e.slot.getResponseInformation();n&&t.track("SlotViewable",{advertiser_id:Object(r.l)(n.advertiserId),campaign_id:Object(r.l)(n.campaignId),line_item_id:Object(r.l)(n.lineItemId),creative_id:Object(r.l)(n.creativeId),service_name:e.serviceName,slot:i(e.slot)})}))})),window.addEventListener("message",(function(e){try{const n=JSON.parse(e.data);if(n.permutive_type&&"google_ad_click"===n.permutive_type){const e=n.data.ad_unit_path,i=Object(r.l)(n.data.creative_id);let s=void 0;Object.keys(o).forEach(t=>{void 0!==o[t].slot&&o[t].slot.ad_unit_path===e&&o[t].creative_id===i&&(s=o[t])}),s=s||{line_item_id:Object(r.l)(n.data.line_item_id),advertiser_id:Object(r.l)(n.data.advertiser_id),campaign_id:Object(r.l)(n.data.order_id),creative_id:Object(r.l)(i),is_empty:!1},t.track("SlotClicked",s)}}catch(e){}}),!1)}))};class u{constructor(e){this.trackedTargetingLimitMetric=!1,this._internals=e._internals;const t=this._internals.getExternalData("_pdfps");this.liveSegments=t?JSON.parse(t):[],this.eligibleSegments={};const n=this._internals.state.activationManager.getSpecializedActivations("dfp");for(let e=0;e<n.dfp.length;e++){const t=n.dfp[e];this.eligibleSegments[t]=t}for(const e in n.dfp_legacy)if(n.dfp_legacy.hasOwnProperty(e)){const t=n.dfp_legacy[e];this.eligibleSegments[e]=t}const r=this._internals.queryManager.userSegments;this.updateSegments(this.filterSegments(r)),this._internals.messages.emit("permutive:dfp:ready"),this._internals.messages.on("permutive:segments:updated",this._internals.makeSafe(()=>{const e=this._internals.queryManager.userSegments;this.updateIfNecessary(e)})),this._internals.messages.on("permutive:reset",this._internals.makeSafe(()=>{this._internals.removeExternalData("_pdfps"),this._internals.deleteCookie("_pdfps"),this.liveSegments=[]}))}updateIfNecessary(e){const t=this.filterSegments(e);this._internals.arraysEqual(t,this.liveSegments)||this.updateSegments(t)}updateSegments(e){const t=Object(i.f)(s.d)("e488cdb0-e7cb-4d91-9648-60d437d8e491",["5d79bce7-5d2b-427e-a6c4-b89b6c7bf048","99db7a95-b06a-4ea9-857c-f73ba0a25c19","f5b3be27-f789-4ef1-8867-37c67da5b361","3aba5292-ba75-422b-8715-bd21146f7836","bd1cec50-00d1-4ce9-9572-785857419a1e"])?this.processActivations(this._internals.thirdParty.getActivationMetadata()):[];let n=e.concat(t);encodeURIComponent(JSON.stringify(n)).length>1500&&(n=e,this.trackedTargetingLimitMetric||(this._internals.metrics.track({name:"sdk_targeting_size_limit_exceeded_count",value:1,labels:{target:"dfp"}}),this.trackedTargetingLimitMetric=!0)),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],window.googletag.cmd.push(()=>googletag.pubads().setTargeting("permutive",n.map(String).concat(["rts"])));const r=JSON.stringify(n.map(String));this._internals.setExternalData("_pdfps",r),"boolean"==typeof{workspaces:[{activations:[],networks:[{name:"BBC.COM - World - DFP EMEA",network_code:"4817"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0}],auto_init:!0,networks:[{name:"BBC.COM - World - DFP EMEA",network_code:"4817"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,activationConfigs:[]}.sync_segments_cookie&&{workspaces:[{activations:[],networks:[{name:"BBC.COM - World - DFP EMEA",network_code:"4817"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0}],auto_init:!0,networks:[{name:"BBC.COM - World - DFP EMEA",network_code:"4817"}],track_slot_clicked:!0,track_slot_rendered:!1,track_slot_viewable:!0,activationConfigs:[]}.sync_segments_cookie&&this._internals.api.segmentSync("_pdfps",r),this.liveSegments=e}filterSegments(e){return e.filter(e=>e in this.eligibleSegments).map(e=>this.eligibleSegments[e])}processActivations(e){const t=[];for(const n in e)if(e.hasOwnProperty(n)&&n in this.eligibleSegments)for(let r=0;r<e[n].length;r++)t.push(e[n][r]);return t}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return r})),n.d(t,"OverlaysAddon",(function(){return i}));const r=(e,t,n)=>{e.unshift({functionName:"addon",arguments:["overlays",{}]})};class i{constructor(e){const t=this;this.permutive=e.permutive,this._internals=e._internals,this.activations=this._internals.state.activationManager.getActivations("overlays"),this.loadedImageCounts={};for(let e=0;e<this.activations.length;e++){const n=this.activations[e],r=n.config,i=this.buildOverlayCss(r,e);document.head.insertAdjacentHTML("beforeend",i);const s=this.buildOverlayBody(r,e);document.body.insertAdjacentHTML("beforeend",s);const o="permutive-overlay-"+e,a=document.getElementById(o),u=a.getElementsByClassName("close")[0],c=a.getElementsByClassName("content")[0],l=()=>{a.style.visibility="hidden",a.style.opacity="0"},d=e=>{c.contains(e.target)||(l(),a.removeEventListener("click",d))};u.addEventListener("click",l),a.addEventListener("click",d),[].slice.call(a.getElementsByTagName("a")).slice(1).forEach(e=>{e.addEventListener("click",(function(){n.trackConversion({useBeacon:!0})}))});const f=a.getElementsByTagName("form")[0];f&&f.addEventListener("submit",(function(e){e.preventDefault(),n.trackConversion({success:function(){f.submit()}})}));const _=function(e,n){t.showOverlay(e),n.trackImpression()};n.activateEveryTime()?this.permutive.segment(n.segmentCode,this._internals.makeSafe(e=>{e?_(o,n):this.permutive.trigger(n.segmentCode,"result",(function(e){e.result&&_(o,n)}))})):n.activateOnEntry()?this.permutive.trigger(n.segmentCode,"result",this._internals.makeSafe((function(e){e.result&&_(o,n)}))):n.activateOnExit()&&this.permutive.trigger(n.segmentCode,"result",this._internals.makeSafe((function(e){e.result||_(o,n)})))}}buildOverlayCss(e,t){return'<style type="text/css">.${overlay_class}{position:fixed;top:0;bottom:0;left:0;right:0;width:100%;height:100%;background:rgba(0,0,0,0.${opacity_percentage});transition:opacity ${opacity_transition_ms}ms;visibility:hidden;opacity:0;z-index:1000000;}.${modal_class}{position:fixed;padding:10px;background:#fff;border-radius:5px;z-index:1000001}.${modal_class} .content{overflow:auto;z-index:1000002;}.${modal_class} .close{position:absolute;top:20px;right:30px;transition:all 200ms;font-size:30px;font-weight:bold;text-decoration:none;color:#333;z-index:1000003}.${modal_class} .close:hover{color:orange;}</style>'.replace(/\${overlay_class}/g,"permutive-overlay-"+t).replace(/\${modal_class}/g,"permutive-modal-"+t).replace("${opacity_percentage}",e.opacity_percentage.toString()).replace("${opacity_transition_ms}",e.opacity_transition_ms.toString())}buildOverlayBody(e,t){let n="";return!function(e){return void 0!==e.html}(e)?function(e){return void 0!==e.image_url&&void 0!==e.image_link}(e)&&(n='<a href="'+e.image_link+'"><img src="'+e.image_url+'"/></a>'):n=e.html,'<div id="${overlay_class}" class="${overlay_class}"><div id="${modal_class}" class="${modal_class}"><a class="close" href="javascript:;">&times;</a><div class="content">${content}</div></div></div>'.replace(/\${overlay_class}/g,"permutive-overlay-"+t).replace(/\${modal_class}/g,"permutive-modal-"+t).replace("${content}",n).replace(/<img /g,"<img onload='window.permutive.addons.overlays.loadedImage(\"permutive-overlay-"+t+"\")' ")}showOverlay(e){const t=document.getElementById(""+e),n=()=>{const e=t.getElementsByTagName("div")[0],n=e.getBoundingClientRect().height,r=e.getBoundingClientRect().width;e.style.left=window.innerWidth/2-r/2+"px",e.style.top=window.innerHeight/2-n/2+"px",t.style.visibility="visible",t.style.opacity="1"},r=t.getElementsByTagName("img");if(r.length>0){let t=0;const i=()=>{t<10&&(!(e in this.loadedImageCounts)||this.loadedImageCounts[e]<r.length)?(t+=1,setTimeout(i,500)):n()};i()}else n()}loadedImage(e){e in this.loadedImageCounts?this.loadedImageCounts[e]=this.loadedImageCounts[e]+1:this.loadedImageCounts[e]=1}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"load",(function(){return load})),__webpack_require__.d(__webpack_exports__,"ScriptRunnerAddon",(function(){return ScriptRunnerAddon}));const load=(e,t,n)=>{e.unshift({functionName:"addon",arguments:["scriptrunner",{}]})};class ScriptRunnerAddon{constructor(options){this.permutive=options.permutive,this._internals=options._internals,this.network=options.network,this.activations=this._internals.state.activationManager.getActivations("scriptrunner");for(let i=0;i<this.activations.length;i++){const activation=this.activations[i],run=activation=>{const script=activation.config.script.replace(/impression\(\)/g,"activation.trackImpression();").replace(/conversion\(\)/g,"activation.trackConversion();");try{eval(script)}catch(e){e.message="Error running custom script: "+e.message,this.network.error(e,this._internals.state.userId)}};activation.activateEveryTime()?this.permutive.segment(activation.segmentCode,e=>{e?run(activation):this.permutive.trigger(activation.segmentCode,"result",(function(e){e.result&&run(activation)}))}):activation.activateOnEntry()?this.permutive.trigger(activation.segmentCode,"result",(function(e){e.result&&run(activation)})):activation.activateOnExit()&&this.permutive.trigger(activation.segmentCode,"result",(function(e){e.result||run(activation)}))}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"load",(function(){return a})),n.d(t,"WebAddon",(function(){return u}));var r=n(5),i=n(0);const s=["mousemove","click","scroll"],o=["email","tel","submit","reset","button","file","password","radio","checkbox"],a=(e,t,n)=>{0};class u{constructor(e){this.dirtyState=!1,this.initialised=!1,this.totalCompletion=0,this.totalEngagedTime=0,this.engagementEdgeOnly="boolean"==typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.engagement_edge_only&&{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.engagement_edge_only,this.segmentTransitionEdgeOnly="boolean"==typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only&&{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.segment_transition_edge_only,this.trackPageviewEngagement="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_engagement||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_engagement,this.trackPageviewComplete="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_complete||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_pageview_complete,this.trackFormSubmission="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_form_submission||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_form_submission,this.trackLinkClick="boolean"!=typeof{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_link_click||{workspaces:[{activations:[],add_alchemy_entities:!1,add_alchemy_taxonomy:!1}],auto_init:!1,add_alchemy_entities:!1,add_alchemy_taxonomy:!1,activationConfigs:[]}.track_link_click,this.pageviewCompleteTimeoutDuration=6e5,this.hasPageviewCompleteFired=!1,this.permutive=e.permutive,this._internals=e._internals,this.context=e.context,this.eventInterval=e.eventInterval||5,this.page=e.page||{},this.sendPageviewEvent(),(e.dirtyEvents||s).map(e=>{window.addEventListener(e,()=>{this.dirtyState=!0,this.trackPageviewComplete&&this.resetTimeout()})}),"loading"!==document.readyState?this.attachListeners():window.addEventListener("DOMContentLoaded",this.attachListeners,!1),this.trackPageviewEngagement&&(this.timerHandle=this.registerEngagementInterval(this.eventInterval)),this.trackPageviewComplete&&(this.setPageviewCompleteTimeout(this.pageviewCompleteTimeoutDuration),Object(r.n)(()=>this.hasPageviewCompleteFired?null:this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion),navigator.userAgent)),this.initialised=!0}sendPageviewEvent(){const e=Object.assign(Object.assign(Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},{}),{}),this.enrichmentProperties(this.context.isArticle)),this.page?this.page:{}),t={success:()=>{this.initialised||this._internals.metrics.trackTimeSinceInit("sdk_first_event_tracked_task_duration_seconds",{})}};this.permutive.track("Pageview",e,t).then(e=>{this._internals.messages.emit("permutive:event:pageview",e)})}sendLinkClickEvent(e,t){if(window.location.href&&e.href){const n=0===e.href.indexOf("data:")?"NOT_URL":e.href;this.permutive.track("LinkClick",{dest_url:n},{useBeacon:t})}}sendFormSubmissionEvent(e){const t=e.currentTarget,n={form:Object.assign(Object.assign(Object.assign({method:t.method||"GET",properties:this.serializeForm(t)},"string"==typeof t.id?{id:t.id}:{}),t.name&&"string"==typeof t.name?{name:t.name}:{}),t.action&&"string"==typeof t.action?{action:t.action}:{})};this.permutive.track("FormSubmission",n)}sendEngagementEvent(e){const{engaged_time:t,total_engaged_time:n,completion:r,total_completion:i}=this.updateState(e),s=Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info",engaged_time:t,total_engaged_time:n},this.page),{completion:r,total_completion:i});this.permutive.track("PageviewEngagement",s,{isMemoryOnly:this.engagementEdgeOnly})}sendPageviewCompleteEvent(e,t,n=!0){const r=Object.assign(Object.assign(Object.assign({isp_info:"$ip_isp_info",geo_info:"$ip_geo_info"},this.enrichmentProperties(this.context.isArticle)),this.page),{aggregations:Object.assign({PageviewEngagement:Object.assign({engaged_time:e},{completion:t})},this.segmentTransitionEdgeOnly?{SegmentEntry:Array.from(this._internals.queryManager.segmentEntryQueryCodes),SegmentExit:Array.from(this._internals.queryManager.segmentExitQueryCodes)}:{})});this.permutive.track("PageviewComplete",r,{useBeacon:n}),this.hasPageviewCompleteFired=!0}reset(e){this._internals.state.viewId=Object(r.o)(),this.page=e.page||null,this.trackPageviewComplete&&(this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion,!1),this.hasPageviewCompleteFired=!1),this.totalCompletion=0,this.totalEngagedTime=0,this.sendPageviewEvent(),this.trackPageviewEngagement&&(clearInterval(this.timerHandle),this.timerHandle=this.registerEngagementInterval(this.eventInterval))}serializeForm(e){return[].slice.call(e.getElementsByTagName("input"),0).filter(e=>!(!e.type||!e.id||e.disabled||e.checked||"fieldset"===e.nodeName.toLowerCase()||-1!==o.indexOf(e.type.toLowerCase()))).map(e=>({name:e.name||e.id,value:e.value})).filter(e=>e.value.length<120)}enrichmentProperties(e){return Object.assign(Object.assign(Object.assign({},{}),{}),{})}registerEngagementInterval(e){return setInterval(()=>{this.dirtyState&&this.sendEngagementEvent(e)},1e3*e)}attachListeners(){const e=e=>"a"===e.tagName.toLowerCase(),t=n=>e(n)?Object(i.o)(n):n.parentElement?e(n.parentElement)?Object(i.o)(n.parentElement):t(n.parentElement):i.n;this.trackFormSubmission&&[].slice.call(document.getElementsByTagName("form"),0).forEach(e=>{e.addEventListener("submit",this._internals.makeSafe(this.sendFormSubmissionEvent.bind(this)))}),this.trackLinkClick&&document.body.addEventListener("click",e=>{if(e.target instanceof Element){const n=t(e.target);return Object(i.b)(()=>{},t=>this.sendLinkClickEvent(t,((e,t)=>!("_blank"===t.target||e.metaKey||e.ctrlKey||e.shiftKey||2===e.which||3===e.which))(e,t)))(n)}})}updateState(e){const t=Math.max(this.totalCompletion,this.getCurrentCompletion()),n=t-this.totalCompletion;return this.totalEngagedTime+=e,this.totalCompletion=t,this.dirtyState=!1,{engaged_time:e,total_engaged_time:this.totalEngagedTime,completion:n,total_completion:this.totalCompletion}}getCurrentCompletion(){const e=document.documentElement.scrollHeight,t=window.pageYOffset+window.innerHeight;return t<=0?0:t>=e?1:t/e}setPageviewCompleteTimeout(e){return window.setTimeout(()=>this.sendPageviewCompleteEvent(this.totalEngagedTime,this.totalCompletion,!1),e)}resetTimeout(){clearTimeout(this.pageviewCompleteTimeoutHandle),this.pageviewCompleteTimeoutHandle=this.setPageviewCompleteTimeout(this.pageviewCompleteTimeoutDuration)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GraphQLGeoIP",(function(){return o})),n.d(t,"register",(function(){return a}));var r=n(5),i=n(19);class s extends i.b{constructor(e){super(),this.replacementMap={$ip_geo_info:e.geo,$ip_isp_info:e.isp,$ip_address:e.ip,$ip_address_hash:e.ip_hash}}}class o{constructor(e){this.resource="geoip",this.query=()=>`geoip { ${[this.config.includeGeo?"geo { continent country city province postal_code }":"",this.config.includeISP?"isp { isp organization autonomous_system_number autonomous_system_organization }":"",this.config.includeIP?"ip":"",this.config.includeIPHash?"ip_hash":""].join(" ")} }`,this.config=e}}const a=(e,t)=>{const n=e=>{e.isp&&(t.isp=e.isp.isp,t.organization=e.isp.organization,t.autonomous_system_number=e.isp.autonomous_system_number,t.autonomous_system_organization=e.isp.autonomous_system_organization),e.geo&&(t.continent=e.geo.continent,t.country=e.geo.country,t.city=e.geo.city,t.province=e.geo.province,t.postal_code=e.geo.postal_code)},i=e.state.getPermutiveData("enricher:geoip");if(i&&i.session_id===e.sessionManager.getSessionId())n(i.data),e.enrichers.register(new s(i.data));else{const t={includeGeo:Object(r.i)({geoip:{}},"geoip","include_geo")||!0,includeISP:Object(r.i)({geoip:{}},"geoip","include_isp")||!0,includeIPHash:Object(r.i)({geoip:{}},"geoip","include_ip_hash")||!0,includeIP:Object(r.i)({geoip:{}},"geoip","include_ip")||!1};e.graphql.register(new o(t)).then(t=>{n(t),e.state.setPermutiveData("enricher:geoip",{session_id:e.sessionManager.getSessionId(),data:t}),e.enrichers.register(new s(t))}).catch(t=>e.network.error("Error while registering the geoip enricher: got "+t))}}}]);